/*!
 * @license
 * TradingView Lightweight Charts™ v4.1.2-dev+202306082153
 * Copyright (c) 2023 TradingView, Inc.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(){"use strict";var t,i;function n(t,i){const n={0:[],1:[t.lineWidth,t.lineWidth],2:[2*t.lineWidth,2*t.lineWidth],3:[6*t.lineWidth,6*t.lineWidth],4:[t.lineWidth,4*t.lineWidth]}[i];t.setLineDash(n)}function s(t,i,n,s){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(n,i+e),t.lineTo(s,i+e),t.stroke()}function e(t,i){if(!t)throw new Error("Assertion failed"+(i?": "+i:""))}function r(t){if(void 0===t)throw new Error("Value is undefined");return t}function h(t){if(null===t)throw new Error("Value is null");return t}function l(t){return h(r(t))}!function(t){t[t.Simple=0]="Simple",t[t.WithSteps=1]="WithSteps",t[t.Curved=2]="Curved"}(t||(t={})),function(t){t[t.Solid=0]="Solid",t[t.Dotted=1]="Dotted",t[t.Dashed=2]="Dashed",t[t.LargeDashed=3]="LargeDashed",t[t.SparseDotted=4]="SparseDotted"}(i||(i={}));const a={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function o(t){return t<0?0:t>255?255:Math.round(t)||0}function _(t){return t<=0||t>0?t<0?0:t>1?1:Math.round(1e4*t)/1e4:0}const u=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,c=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,d=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,f=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?[\d]{0,10}(?:\.\d+)?)\s*\)$/;function p(t){(t=t.toLowerCase())in a&&(t=a[t]);{const i=f.exec(t)||d.exec(t);if(i)return[o(parseInt(i[1],10)),o(parseInt(i[2],10)),o(parseInt(i[3],10)),_(i.length<5?1:parseFloat(i[4]))]}{const i=c.exec(t);if(i)return[o(parseInt(i[1],16)),o(parseInt(i[2],16)),o(parseInt(i[3],16)),1]}{const i=u.exec(t);if(i)return[o(17*parseInt(i[1],16)),o(17*parseInt(i[2],16)),o(17*parseInt(i[3],16)),1]}throw new Error(`Cannot parse color: ${t}`)}function v(t){const i=p(t);return{t:`rgb(${i[0]}, ${i[1]}, ${i[2]})`,i:(n=i,.199*n[0]+.687*n[1]+.114*n[2]>160?"black":"white")};var n}class m{constructor(){this.h=[]}l(t,i,n){const s={o:t,_:i,u:!0===n};this.h.push(s)}p(t){const i=this.h.findIndex((i=>t===i.o));i>-1&&this.h.splice(i,1)}v(t){this.h=this.h.filter((i=>i._!==t))}m(t,i,n){const s=[...this.h];this.h=this.h.filter((t=>!t.u)),s.forEach((s=>s.o(t,i,n)))}g(){return this.h.length>0}M(){this.h=[]}}function b(t,...i){for(const n of i)for(const i in n)void 0!==n[i]&&("object"!=typeof n[i]||void 0===t[i]?t[i]=n[i]:b(t[i],n[i]));return t}function g(t){return"number"==typeof t&&isFinite(t)}function w(t){return"number"==typeof t&&t%1==0}function M(t){return"string"==typeof t}function S(t){return"boolean"==typeof t}function x(t){const i=t;if(!i||"object"!=typeof i)return i;let n,s,e;for(s in n=Array.isArray(i)?[]:{},i)i.hasOwnProperty(s)&&(e=i[s],n[s]=e&&"object"==typeof e?x(e):e);return n}function y(t){return null!==t}function k(t){return null===t?void 0:t}const C="-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";function T(t,i,n){return void 0===i&&(i=C),`${n=void 0!==n?`${n} `:""}${t}px ${i}`}class P{constructor(t){this.S={k:1,C:5,T:NaN,P:"",R:"",D:"",O:"",B:0,A:0,L:0,I:0,N:0,V:0},this.F=t}W(){const t=this.S,i=this.j(),n=this.$();return t.T===i&&t.R===n||(t.T=i,t.R=n,t.P=T(i,n),t.I=2.5/12*i,t.B=t.I,t.A=i/12*t.C,t.L=i/12*t.C,t.N=0),t.D=this.H(),t.O=this.U(),t.V=this.q(),this.S}q(){return this.F.W().rightPriceScale.width}H(){return this.F.W().layout.textColor}U(){return this.F.Y()}j(){return this.F.W().layout.fontSize}$(){return this.F.W().layout.fontFamily}}class R{constructor(){this.X=[]}Z(t){this.X=t}K(t,i,n){this.X.forEach((s=>{s.K(t,i,n)}))}}class D{K(t,i,n){t.useMediaCoordinateSpace((t=>this.G(t,i,n)))}J(t,i,n){t.useMediaCoordinateSpace((t=>this.tt(t,i,n)))}tt(t,i,n){}}class O extends D{constructor(){super(...arguments),this.it=null}nt(t){this.it=t}G({context:t}){if(null===this.it||null===this.it.st)return;const i=this.it.st,n=this.it,s=s=>{t.beginPath();for(let e=i.to-1;e>=i.from;--e){const i=n.et[e];t.moveTo(i.rt,i.ht),t.arc(i.rt,i.ht,s,0,2*Math.PI)}t.fill()};n.lt>0&&(t.fillStyle=n.ot,s(n._t+n.lt)),t.fillStyle=n.ut,s(n._t)}}function B(){return{et:[{rt:0,ht:0,ct:0,dt:0}],ut:"",ot:"",_t:0,lt:0,st:null}}const E={from:0,to:1};class A{constructor(t,i){this.ft=new R,this.vt=[],this.bt=[],this.gt=!0,this.F=t,this.wt=i,this.ft.Z(this.vt)}Mt(t){const i=this.F.St();i.length!==this.vt.length&&(this.bt=i.map(B),this.vt=this.bt.map((t=>{const i=new O;return i.nt(t),i})),this.ft.Z(this.vt)),this.gt=!0}xt(){return this.gt&&(this.yt(),this.gt=!1),this.ft}yt(){const t=this.F.St(),i=this.wt.kt(),n=this.F.Ct();t.forEach(((t,s)=>{var e;const r=this.bt[s],l=t.Tt(i);if(null===l||!t.Pt())return void(r.st=null);const a=h(t.Rt());r.ut=l.Dt,r._t=l._t,r.lt=l.Ot,r.et[0].dt=l.dt,r.et[0].ht=t.Et().Bt(l.dt,a.At),r.ot=null!==(e=l.Lt)&&void 0!==e?e:this.F.zt(r.et[0].ht/t.Et().It()),r.et[0].ct=i,r.et[0].rt=n.Nt(i),r.st=E}))}}class L{K(t,i,n){t.useBitmapCoordinateSpace((t=>this.G(t,i,n)))}}class z extends L{constructor(t){super(),this.Vt=t}G({context:t,bitmapSize:i,horizontalPixelRatio:e,verticalPixelRatio:r}){if(null===this.Vt)return;const h=this.Vt.Ft.Pt,l=this.Vt.Wt.Pt;if(!h&&!l)return;const a=Math.round(this.Vt.rt*e),o=Math.round(this.Vt.ht*r);t.lineCap="butt",h&&a>=0&&(t.lineWidth=Math.floor(this.Vt.Ft.lt*e),t.strokeStyle=this.Vt.Ft.D,t.fillStyle=this.Vt.Ft.D,n(t,this.Vt.Ft.jt),function(t,i,n,s){t.beginPath();const e=t.lineWidth%2?.5:0;t.moveTo(i+e,n),t.lineTo(i+e,s),t.stroke()}(t,a,0,i.height)),l&&o>=0&&(t.lineWidth=Math.floor(this.Vt.Wt.lt*r),t.strokeStyle=this.Vt.Wt.D,t.fillStyle=this.Vt.Wt.D,n(t,this.Vt.Wt.jt),s(t,o,0,i.width))}}class I{constructor(t){this.gt=!0,this.$t={Ft:{lt:1,jt:0,D:"",Pt:!1},Wt:{lt:1,jt:0,D:"",Pt:!1},rt:0,ht:0},this.Ht=new z(this.$t),this.Ut=t}Mt(){this.gt=!0}xt(){return this.gt&&(this.yt(),this.gt=!1),this.Ht}yt(){const t=this.Ut.Pt(),i=h(this.Ut.qt()),n=i.Yt().W().crosshair,s=this.$t;s.Wt.Pt=t&&this.Ut.Xt(i),s.Ft.Pt=t&&this.Ut.Zt(),s.Wt.lt=n.horzLine.width,s.Wt.jt=n.horzLine.style,s.Wt.D=n.horzLine.color,s.Ft.lt=n.vertLine.width,s.Ft.jt=n.vertLine.style,s.Ft.D=n.vertLine.color,s.rt=this.Ut.Kt(),s.ht=this.Ut.Gt()}}function N(t,i,n,s,e,r){t.fillRect(i+r,n,s-2*r,r),t.fillRect(i+r,n+e-r,s-2*r,r),t.fillRect(i,n,r,e),t.fillRect(i+s-r,n,r,e)}function V(t,i,n,s,e,r){t.save(),t.globalCompositeOperation="copy",t.fillStyle=r,t.fillRect(i,n,s,e),t.restore()}function F(t,i){return Array.isArray(t)?t.map((t=>0===t?t:t+i)):t+i}function W(t,i,n,s,e,r){let h,l,a,o;if(Array.isArray(r))if(2===r.length){const t=Math.max(0,r[0]),i=Math.max(0,r[1]);h=t,l=t,a=i,o=i}else{if(4!==r.length)throw new Error("Wrong border radius - it should be like css border radius");h=Math.max(0,r[0]),l=Math.max(0,r[1]),a=Math.max(0,r[2]),o=Math.max(0,r[3])}else{const t=Math.max(0,r);h=t,l=t,a=t,o=t}t.beginPath(),t.moveTo(i+h,n),t.lineTo(i+s-l,n),0!==l&&t.arcTo(i+s,n,i+s,n+l,l),t.lineTo(i+s,n+e-a),0!==a&&t.arcTo(i+s,n+e,i+s-a,n+e,a),t.lineTo(i+o,n+e),0!==o&&t.arcTo(i,n+e,i,n+e-o,o),t.lineTo(i,n+h),0!==h&&t.arcTo(i,n,i+h,n,h)}function j(t,i,n,s,e,r,h=0,l=0,a=""){if(t.save(),!h||!a||a===r)return W(t,i,n,s,e,l),t.fillStyle=r,t.fill(),void t.restore();const o=h/2;if("transparent"!==r){W(t,i+h,n+h,s-2*h,e-2*h,F(l,-h)),t.fillStyle=r,t.fill()}if("transparent"!==a){W(t,i+o,n+o,s-h,e-h,F(l,-o)),t.lineWidth=h,t.strokeStyle=a,t.closePath(),t.stroke()}t.restore()}function $(t,i,n,s,e,r,h){t.save(),t.globalCompositeOperation="copy";const l=t.createLinearGradient(0,0,0,e);l.addColorStop(0,r),l.addColorStop(1,h),t.fillStyle=l,t.fillRect(i,n,s,e),t.restore()}class H{constructor(t,i){this.nt(t,i)}nt(t,i){this.Vt=t,this.Jt=i}It(t,i){return this.Vt.Pt?t.T+t.I+t.B:0}K(t,i,n,s){if(!this.Vt.Pt||0===this.Vt.Qt.length)return;const e=this.Vt.D,r=this.Jt.t,h=t.useBitmapCoordinateSpace((t=>{const h=t.context;h.font=i.P;const l=this.ti(t,i,n,s),a=l.ii,o=(t,i)=>{l.ni?j(h,a.si,a.ei,a.ri,a.hi,t,a.li,[a._t,0,0,a._t],i):j(h,a.ai,a.ei,a.ri,a.hi,t,a.li,[0,a._t,a._t,0],i)};return o(r,"transparent"),this.Vt.oi&&(h.fillStyle=e,h.fillRect(a.ai,a._i,a.ui-a.ai,a.ci)),o("transparent",r),this.Vt.di&&(h.fillStyle=i.O,h.fillRect(l.ni?a.fi-a.li:0,a.ei,a.li,a.pi-a.ei)),l}));t.useMediaCoordinateSpace((({context:t})=>{const n=h.vi;t.font=i.P,t.textAlign=h.ni?"right":"left",t.textBaseline="middle",t.fillStyle=e,t.fillText(this.Vt.Qt,n.mi,(n.ei+n.pi)/2+n.bi)}))}ti(t,i,n,s){var e;const{context:r,bitmapSize:h,mediaSize:l,horizontalPixelRatio:a,verticalPixelRatio:o}=t,_=this.Vt.oi||!this.Vt.gi?i.C:0,u=this.Vt.wi?i.k:0,c=i.I+this.Jt.Mi,d=i.B+this.Jt.Si,f=i.A,p=i.L,v=this.Vt.Qt,m=i.T,b=n.xi(r,v),g=Math.ceil(n.yi(r,v)),w=m+c+d,M=i.k+f+p+g+_,S=Math.max(1,Math.floor(o));let x=Math.round(w*o);x%2!=S%2&&(x+=1);const y=u>0?Math.max(1,Math.floor(u*a)):0,k=Math.round(M*a),C=Math.round(_*a),T=null!==(e=this.Jt.ki)&&void 0!==e?e:this.Jt.Ci,P=Math.round(T*o)-Math.floor(.5*o),R=Math.floor(P+S/2-x/2),D=R+x,O="right"===s,B=O?l.width-u:u,E=O?h.width-y:y;let A,L,z;return O?(A=E-k,L=E-C,z=B-_-f-u):(A=E+k,L=E+C,z=B+_+f),{ni:O,ii:{ei:R,_i:P,pi:D,ri:k,hi:x,_t:2*a,li:y,si:A,ai:E,ui:L,ci:S,fi:h.width},vi:{ei:R/o,pi:D/o,mi:z,bi:b}}}}class U{constructor(t){this.Ti={Ci:0,t:"#000",Si:0,Mi:0},this.Pi={Qt:"",Pt:!1,oi:!0,gi:!1,Lt:"",D:"#FFF",di:!1,wi:!1},this.Ri={Qt:"",Pt:!1,oi:!1,gi:!0,Lt:"",D:"#FFF",di:!0,wi:!0},this.gt=!0,this.Di=new(t||H)(this.Pi,this.Ti),this.Oi=new(t||H)(this.Ri,this.Ti)}Qt(){return this.Bi(),this.Pi.Qt}Ci(){return this.Bi(),this.Ti.Ci}Mt(){this.gt=!0}It(t,i=!1){return Math.max(this.Di.It(t,i),this.Oi.It(t,i))}Ei(){return this.Ti.ki||0}Ai(t){this.Ti.ki=t}Li(){return this.Bi(),this.Pi.Pt||this.Ri.Pt}zi(){return this.Bi(),this.Pi.Pt}xt(t){return this.Bi(),this.Pi.oi=this.Pi.oi&&t.W().ticksVisible,this.Ri.oi=this.Ri.oi&&t.W().ticksVisible,this.Di.nt(this.Pi,this.Ti),this.Oi.nt(this.Ri,this.Ti),this.Di}Ii(){return this.Bi(),this.Di.nt(this.Pi,this.Ti),this.Oi.nt(this.Ri,this.Ti),this.Oi}Bi(){this.gt&&(this.Pi.oi=!0,this.Ri.oi=!1,this.Ni(this.Pi,this.Ri,this.Ti))}}class q extends U{constructor(t,i,n){super(),this.Ut=t,this.Vi=i,this.Fi=n}Ni(t,i,n){t.Pt=!1;const s=this.Ut.W().horzLine;if(!s.labelVisible)return;const e=this.Vi.Rt();if(!this.Ut.Pt()||this.Vi.Wi()||null===e)return;const r=v(s.labelBackgroundColor);n.t=r.t,t.D=r.i;const h=2/12*this.Vi.T();n.Mi=h,n.Si=h;const l=this.Fi(this.Vi);n.Ci=l.Ci,t.Qt=this.Vi.ji(l.dt,e),t.Pt=!0}}const Y=/[1-9]/g;class X{constructor(){this.Vt=null}nt(t){this.Vt=t}K(t,i){if(null===this.Vt||!1===this.Vt.Pt||0===this.Vt.Qt.length)return;const n=t.useMediaCoordinateSpace((({context:t})=>(t.font=i.P,Math.round(i.$i.yi(t,h(this.Vt).Qt,Y)))));if(n<=0)return;const s=i.Hi,e=n+2*s,r=e/2,l=this.Vt.V;let a=this.Vt.Ci,o=Math.floor(a-r)+.5;o<0?(a+=Math.abs(0-o),o=Math.floor(a-r)+.5):o+e>l&&(a-=Math.abs(l-(o+e)),o=Math.floor(a-r)+.5);const _=o+e,u=Math.ceil(0+i.k+i.C+i.I+i.T+i.B);t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:n,verticalPixelRatio:s})=>{const e=h(this.Vt);t.fillStyle=e.t;const r=Math.round(o*n),l=Math.round(0*s),a=Math.round(_*n),c=Math.round(u*s),d=Math.round(2*n);if(t.beginPath(),t.moveTo(r,l),t.lineTo(r,c-d),t.arcTo(r,c,r+d,c,d),t.lineTo(a-d,c),t.arcTo(a,c,a,c-d,d),t.lineTo(a,l),t.fill(),e.oi){const r=Math.round(e.Ci*n),h=l,a=Math.round((h+i.C)*s);t.fillStyle=e.D;const o=Math.max(1,Math.floor(n)),_=Math.floor(.5*n);t.fillRect(r-_,h,o,a-h)}})),t.useMediaCoordinateSpace((({context:t})=>{const n=h(this.Vt),e=0+i.k+i.C+i.I+i.T/2;t.font=i.P,t.textAlign="left",t.textBaseline="middle",t.fillStyle=n.D;const r=i.$i.xi(t,"Apr0");t.translate(o+s,e+r),t.fillText(n.Qt,0,0)}))}}class Z{constructor(t,i,n){this.gt=!0,this.Ht=new X,this.$t={Pt:!1,t:"#4c525e",D:"white",Qt:"",V:0,Ci:NaN,oi:!0},this.wt=t,this.Ui=i,this.Fi=n}Mt(){this.gt=!0}xt(){return this.gt&&(this.yt(),this.gt=!1),this.Ht.nt(this.$t),this.Ht}yt(){const t=this.$t;t.Pt=!1;const i=this.wt.W().vertLine;if(!i.labelVisible)return;const n=this.Ui.Ct();if(n.Wi())return;t.V=n.V();const s=this.Fi();if(null===s)return;t.Ci=s.Ci;const e=n.qi(this.wt.kt());t.Qt=n.Yi(h(e)),t.Pt=!0;const r=v(i.labelBackgroundColor);t.t=r.t,t.D=r.i,t.oi=n.W().ticksVisible}}class K{constructor(){this.Xi=null,this.Zi=0}Ki(){return this.Zi}Gi(t){this.Zi=t}Et(){return this.Xi}Ji(t){this.Xi=t}Qi(t){return[]}tn(){return[]}Pt(){return!0}}var G;!function(t){t[t.Normal=0]="Normal",t[t.Magnet=1]="Magnet"}(G||(G={}));class J extends K{constructor(t,i){super(),this.nn=null,this.sn=NaN,this.en=0,this.rn=!0,this.hn=new Map,this.ln=!1,this.an=NaN,this.on=NaN,this._n=NaN,this.un=NaN,this.Ui=t,this.cn=i,this.dn=new A(t,this);this.fn=((t,i)=>n=>{const s=i(),e=t();if(n===h(this.nn).pn())return{dt:e,Ci:s};{const t=h(n.Rt());return{dt:n.vn(s,t),Ci:s}}})((()=>this.sn),(()=>this.on));const n=((t,i)=>()=>{const n=this.Ui.Ct().mn(t()),s=i();return n&&Number.isFinite(s)?{ct:n,Ci:s}:null})((()=>this.en),(()=>this.Kt()));this.bn=new Z(this,t,n),this.gn=new I(this)}W(){return this.cn}wn(t,i){this._n=t,this.un=i}Mn(){this._n=NaN,this.un=NaN}Sn(){return this._n}xn(){return this.un}yn(t,i,n){this.ln||(this.ln=!0),this.rn=!0,this.kn(t,i,n)}kt(){return this.en}Kt(){return this.an}Gt(){return this.on}Pt(){return this.rn}Cn(){this.rn=!1,this.Tn(),this.sn=NaN,this.an=NaN,this.on=NaN,this.nn=null,this.Mn()}Pn(t){return null!==this.nn?[this.gn,this.dn]:[]}Xt(t){return t===this.nn&&this.cn.horzLine.visible}Zt(){return this.cn.vertLine.visible}Rn(t,i){this.rn&&this.nn===t||this.hn.clear();const n=[];return this.nn===t&&n.push(this.Dn(this.hn,i,this.fn)),n}tn(){return this.rn?[this.bn]:[]}qt(){return this.nn}On(){this.gn.Mt(),this.hn.forEach((t=>t.Mt())),this.bn.Mt(),this.dn.Mt()}Bn(t){return t&&!t.pn().Wi()?t.pn():null}kn(t,i,n){this.En(t,i,n)&&this.On()}En(t,i,n){const s=this.an,e=this.on,r=this.sn,h=this.en,l=this.nn,a=this.Bn(n);this.en=t,this.an=isNaN(t)?NaN:this.Ui.Ct().Nt(t),this.nn=n;const o=null!==a?a.Rt():null;return null!==a&&null!==o?(this.sn=i,this.on=a.Bt(i,o)):(this.sn=NaN,this.on=NaN),s!==this.an||e!==this.on||h!==this.en||r!==this.sn||l!==this.nn}Tn(){const t=this.Ui.St().map((t=>t.Ln().An())).filter(y),i=0===t.length?null:Math.max(...t);this.en=null!==i?i:NaN}Dn(t,i,n){let s=t.get(i);return void 0===s&&(s=new q(this,i,n),t.set(i,s)),s}}function Q(t){return"left"===t||"right"===t}class tt{constructor(t){this.zn=new Map,this.In=[],this.Nn=t}Vn(t,i){const n=function(t,i){return void 0===t?i:{Fn:Math.max(t.Fn,i.Fn),Wn:t.Wn||i.Wn}}(this.zn.get(t),i);this.zn.set(t,n)}jn(){return this.Nn}$n(t){const i=this.zn.get(t);return void 0===i?{Fn:this.Nn}:{Fn:Math.max(this.Nn,i.Fn),Wn:i.Wn}}Hn(){this.Un(),this.In=[{qn:0}]}Yn(t){this.Un(),this.In=[{qn:1,At:t}]}Xn(t){this.Zn(),this.In.push({qn:5,At:t})}Un(){this.Zn(),this.In.push({qn:6})}Kn(){this.Un(),this.In=[{qn:4}]}Gn(t){this.Un(),this.In.push({qn:2,At:t})}Jn(t){this.Un(),this.In.push({qn:3,At:t})}Qn(){return this.In}ts(t){for(const i of t.In)this.ns(i);this.Nn=Math.max(this.Nn,t.Nn),t.zn.forEach(((t,i)=>{this.Vn(i,t)}))}static ss(){return new tt(2)}static es(){return new tt(3)}ns(t){switch(t.qn){case 0:this.Hn();break;case 1:this.Yn(t.At);break;case 2:this.Gn(t.At);break;case 3:this.Jn(t.At);break;case 4:this.Kn();break;case 5:this.Xn(t.At);break;case 6:this.Zn()}}Zn(){const t=this.In.findIndex((t=>5===t.qn));-1!==t&&this.In.splice(t,1)}}const it=".";function nt(t,i){if(!g(t))return"n/a";if(!w(i))throw new TypeError("invalid length");if(i<0||i>16)throw new TypeError("invalid length");if(0===i)return t.toString();return("0000000000000000"+t.toString()).slice(-i)}class st{constructor(t,i){if(i||(i=1),g(t)&&w(t)||(t=100),t<0)throw new TypeError("invalid base");this.Vi=t,this.rs=i,this.hs()}format(t){const i=t<0?"−":"";return t=Math.abs(t),i+this.ls(t)}hs(){if(this.os=0,this.Vi>0&&this.rs>0){let t=this.Vi;for(;t>1;)t/=10,this.os++}}ls(t){const i=this.Vi/this.rs;let n=Math.floor(t),s="";const e=void 0!==this.os?this.os:NaN;if(i>1){let r=+(Math.round(t*i)-n*i).toFixed(this.os);r>=i&&(r-=i,n+=1),s=it+nt(+r.toFixed(this.os)*this.rs,e)}else n=Math.round(n*i)/i,e>0&&(s=it+nt(0,e));return n.toFixed(0)+s}}class et extends st{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}}class rt{constructor(t){this._s=t}format(t){let i="";return t<0&&(i="-",t=-t),t<995?i+this.us(t):t<999995?i+this.us(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),i+this.us(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),i+this.us(t/1e9)+"B")}us(t){let i;const n=Math.pow(10,this._s);return i=(t=Math.round(t*n)/n)>=1e-15&&t<1?t.toFixed(this._s).replace(/\.?0+$/,""):String(t),i.replace(/(\.[1-9]*)0+$/,((t,i)=>i))}}function ht(t,i,n,s,e,r,h){if(0===i.length||s.from>=i.length||s.to<=0)return;const l=t.context,a=i[s.from];let o=r(t,a),_=a;if(s.to-s.from<2){const t=e/2;l.beginPath();const i={rt:a.rt-t,ht:a.ht},n={rt:a.rt+t,ht:a.ht};return l.moveTo(i.rt,i.ht),l.lineTo(n.rt,n.ht),void h(l,o,i,n)}const u=(t,i)=>{h(l,o,_,i),l.beginPath(),o=t,_=i};let c=_;l.beginPath(),l.moveTo(a.rt,a.ht);for(let e=s.from+1;e<s.to;++e){c=i[e];const s=r(t,c);switch(n){case 0:l.lineTo(c.rt,c.ht);break;case 1:l.lineTo(c.rt,i[e-1].ht),s!==o&&(u(s,c),l.lineTo(c.rt,i[e-1].ht)),l.lineTo(c.rt,c.ht);break;case 2:{const[t,n]=_t(i,e-1,e);l.bezierCurveTo(t.rt,t.ht,n.rt,n.ht,c.rt,c.ht);break}}1!==n&&s!==o&&(u(s,c),l.moveTo(c.rt,c.ht))}(_!==c||_===c&&1===n)&&h(l,o,_,c)}const lt=6;function at(t,i){return{rt:t.rt-i.rt,ht:t.ht-i.ht}}function ot(t,i){return{rt:t.rt/i,ht:t.ht/i}}function _t(t,i,n){const s=Math.max(0,i-1),e=Math.min(t.length-1,n+1);var r,h;return[(r=t[i],h=ot(at(t[n],t[s]),lt),{rt:r.rt+h.rt,ht:r.ht+h.ht}),at(t[n],ot(at(t[e],t[i]),lt))]}function ut(t,i,n,s,e){i.lineTo(e.rt,t),i.lineTo(s.rt,t),i.closePath(),i.fillStyle=n,i.fill()}class ct extends D{constructor(){super(...arguments),this.it=null}nt(t){this.it=t}G(t){var i;if(null===this.it)return;const{et:s,st:e,cs:r,lt:h,jt:l,ds:a}=this.it,o=null!==(i=this.it.fs)&&void 0!==i?i:this.it.ps?0:t.mediaSize.height;if(null===e)return;const _=t.context;_.lineCap="butt",_.lineJoin="round",_.lineWidth=h,n(_,l),_.lineWidth=1,ht(t,s,a,e,r,this.vs.bind(this),ut.bind(null,o))}}class dt extends ct{constructor(){super(...arguments),this.bs=null}vs(t,i){const{context:n,mediaSize:s}=t,{gs:e,ws:r}=i,h=s.height;if(null!==this.bs&&this.bs.topColor===e&&this.bs.bottomColor===r&&this.bs.bottom===h)return this.bs.fillStyle;const l=n.createLinearGradient(0,0,0,h);return l.addColorStop(0,e),l.addColorStop(1,r),this.bs={topColor:e,bottomColor:r,fillStyle:l,bottom:h},l}}function ft(t,i){t.strokeStyle=i,t.stroke()}class pt extends D{constructor(){super(...arguments),this.it=null}nt(t){this.it=t}G(t){if(null===this.it)return;const{et:i,st:s,cs:e,ds:r,lt:h,jt:l}=this.it;if(null===s)return;const a=t.context;a.lineCap="butt",a.lineWidth=h,n(a,l),a.lineJoin="round",ht(t,i,r,s,e,this.Ms.bind(this),ft)}}class vt extends pt{Ms(t,i){return i.ut}}function mt(t,i,n,s=0,e=t.length){let r=e-s;for(;0<r;){const e=r>>1,h=s+e;n(t[h],i)?(s=h+1,r-=e+1):r=e}return s}function bt(t,i,n,s=0,e=t.length){let r=e-s;for(;0<r;){const e=r>>1,h=s+e;n(i,t[h])?r=e:(s=h+1,r-=e+1)}return s}function gt(t,i){return t.ct<i}function wt(t,i){return t<i.ct}function Mt(t,i,n){const s=i.Ss(),e=i.fi(),r=mt(t,s,gt),h=bt(t,e,wt);if(!n)return{from:r,to:h};let l=r,a=h;return r>0&&r<t.length&&t[r].ct>=s&&(l=r-1),h>0&&h<t.length&&t[h-1].ct<=e&&(a=h+1),{from:l,to:a}}class St{constructor(t,i,n){this.xs=!0,this.ys=!0,this.ks=!0,this.Cs=[],this.Ts=null,this.Ps=t,this.Rs=i,this.Ds=n}Mt(t){this.xs=!0,"data"===t&&(this.ys=!0),"options"===t&&(this.ks=!0)}xt(){return this.Ps.Pt()?(this.Os(),null===this.Ts?null:this.Bs):null}Es(){this.Cs=this.Cs.map((t=>Object.assign(Object.assign({},t),this.Ps.Ls().As(t.ct))))}zs(){this.Ts=null}Os(){this.ys&&(this.Is(),this.ys=!1),this.ks&&(this.Es(),this.ks=!1),this.xs&&(this.Ns(),this.xs=!1)}Ns(){const t=this.Ps.Et(),i=this.Rs.Ct();if(this.zs(),i.Wi()||t.Wi())return;const n=i.Vs();if(null===n)return;if(0===this.Ps.Ln().Fs())return;const s=this.Ps.Rt();null!==s&&(this.Ts=Mt(this.Cs,n,this.Ds),this.Ws(t,i,s.At),this.js())}}class xt extends St{constructor(t,i){super(t,i,!0)}Ws(t,i,n){i.$s(this.Cs,k(this.Ts)),t.Hs(this.Cs,n,k(this.Ts))}Us(t,i){return{ct:t,dt:i,rt:NaN,ht:NaN}}Is(){const t=this.Ps.Ls();this.Cs=this.Ps.Ln().qs().map((i=>{const n=i.At[3];return this.Ys(i.Xs,n,t)}))}}class yt extends xt{constructor(t,i){super(t,i),this.Bs=new R,this.Zs=new dt,this.Ks=new vt,this.Bs.Z([this.Zs,this.Ks])}Ys(t,i,n){return Object.assign(Object.assign({},this.Us(t,i)),n.As(t))}js(){const t=this.Ps.W();this.Zs.nt({ds:t.lineType,et:this.Cs,jt:t.lineStyle,lt:t.lineWidth,fs:null,ps:t.invertFilledArea,st:this.Ts,cs:this.Rs.Ct().Gs()}),this.Ks.nt({ds:t.lineType,et:this.Cs,jt:t.lineStyle,lt:t.lineWidth,st:this.Ts,cs:this.Rs.Ct().Gs()})}}class kt extends L{constructor(){super(...arguments),this.Vt=null,this.Js=0,this.Qs=0}nt(t){this.Vt=t}G({context:t,horizontalPixelRatio:i,verticalPixelRatio:n}){if(null===this.Vt||0===this.Vt.Ln.length||null===this.Vt.st)return;if(this.Js=this.te(i),this.Js>=2){Math.max(1,Math.floor(i))%2!=this.Js%2&&this.Js--}this.Qs=this.Vt.ie?Math.min(this.Js,Math.floor(i)):this.Js;let s=null;const e=this.Qs<=this.Js&&this.Vt.Gs>=Math.floor(1.5*i);for(let r=this.Vt.st.from;r<this.Vt.st.to;++r){const h=this.Vt.Ln[r];s!==h.ne&&(t.fillStyle=h.ne,s=h.ne);const l=Math.floor(.5*this.Qs),a=Math.round(h.rt*i),o=a-l,_=this.Qs,u=o+_-1,c=Math.min(h.se,h.ee),d=Math.max(h.se,h.ee),f=Math.round(c*n)-l,p=Math.round(d*n)+l,v=Math.max(p-f,this.Qs);t.fillRect(o,f,_,v);const m=Math.ceil(1.5*this.Js);if(e){if(this.Vt.re){const i=a-m;let s=Math.max(f,Math.round(h.he*n)-l),e=s+_-1;e>f+v-1&&(e=f+v-1,s=e-_+1),t.fillRect(i,s,o-i,e-s+1)}const i=a+m;let s=Math.max(f,Math.round(h.le*n)-l),e=s+_-1;e>f+v-1&&(e=f+v-1,s=e-_+1),t.fillRect(u+1,s,i-u,e-s+1)}}}te(t){const i=Math.floor(t);return Math.max(i,Math.floor(function(t,i){return Math.floor(.3*t*i)}(h(this.Vt).Gs,t)))}}class Ct extends St{constructor(t,i){super(t,i,!1)}Ws(t,i,n){i.$s(this.Cs,k(this.Ts)),t.ae(this.Cs,n,k(this.Ts))}oe(t,i,n){return{ct:t,_e:i.At[0],ue:i.At[1],ce:i.At[2],de:i.At[3],rt:NaN,he:NaN,se:NaN,ee:NaN,le:NaN}}Is(){const t=this.Ps.Ls();this.Cs=this.Ps.Ln().qs().map((i=>this.Ys(i.Xs,i,t)))}}class Tt extends Ct{constructor(){super(...arguments),this.Bs=new kt}Ys(t,i,n){return Object.assign(Object.assign({},this.oe(t,i,n)),n.As(t))}js(){const t=this.Ps.W();this.Bs.nt({Ln:this.Cs,Gs:this.Rs.Ct().Gs(),re:t.openVisible,ie:t.thinBars,st:this.Ts})}}function Pt(t,i,n){return Math.min(Math.max(t,i),n)}function Rt(t,i,n){return i-t<=n}function Dt(t){return t<=0?NaN:Math.log(t)/Math.log(10)}function Ot(t){const i=Math.ceil(t);return i%2==0?i-1:i}class Bt extends ct{constructor(){super(...arguments),this.bs=null}vs(t,i){var n;const{context:s,mediaSize:e}=t,r=this.it,{fe:h,pe:l,ve:a,me:o}=i,_=null!==(n=r.fs)&&void 0!==n?n:e.height,u=e.height;if(null!==this.bs&&this.bs.topFillColor1===h&&this.bs.topFillColor2===l&&this.bs.bottomFillColor1===a&&this.bs.bottomFillColor2===o&&this.bs.baseLevelCoordinate===_&&this.bs.bottom===u)return this.bs.fillStyle;const c=s.createLinearGradient(0,0,0,u),d=Pt(_/u,0,1);return c.addColorStop(0,h),c.addColorStop(d,l),c.addColorStop(d,a),c.addColorStop(1,o),this.bs={topFillColor1:h,topFillColor2:l,bottomFillColor1:a,bottomFillColor2:o,fillStyle:c,baseLevelCoordinate:_,bottom:u},c}}class Et extends pt{constructor(){super(...arguments),this.be=null}Ms(t,i){const{context:n,mediaSize:s}=t,e=this.it,{ge:r,we:h}=i,{fs:l}=e,a=s.height;if(null!==this.be&&this.be.topLineColor===r&&this.be.bottomLineColor===h&&this.be.baseLevelCoordinate===l&&this.be.bottom===a)return this.be.strokeStyle;const o=n.createLinearGradient(0,0,0,a),_=Pt(l/a,0,1);return o.addColorStop(0,r),o.addColorStop(_,r),o.addColorStop(_,h),o.addColorStop(1,h),this.be={topLineColor:r,bottomLineColor:h,strokeStyle:o,baseLevelCoordinate:l,bottom:a},o}}class At extends xt{constructor(t,i){super(t,i),this.Bs=new R,this.Me=new Bt,this.Se=new Et,this.Bs.Z([this.Me,this.Se])}Ys(t,i,n){return Object.assign(Object.assign({},this.Us(t,i)),n.As(t))}js(){const t=this.Ps.Rt();if(null===t)return;const i=this.Ps.W(),n=this.Ps.Et().Bt(i.baseValue.price,t.At),s=this.Rs.Ct().Gs();this.Me.nt({et:this.Cs,lt:i.lineWidth,jt:i.lineStyle,ds:i.lineType,fs:n,ps:!1,st:this.Ts,cs:s}),this.Se.nt({et:this.Cs,lt:i.lineWidth,jt:i.lineStyle,ds:i.lineType,fs:n,st:this.Ts,cs:s})}}class Lt extends L{constructor(){super(...arguments),this.Vt=null,this.Js=0}nt(t){this.Vt=t}G(t){if(null===this.Vt||0===this.Vt.Ln.length||null===this.Vt.st)return;const{horizontalPixelRatio:i}=t;if(this.Js=function(t,i){if(t>=2.5&&t<=4)return Math.floor(3*i);const n=1-.2*Math.atan(Math.max(4,t)-4)/(.5*Math.PI),s=Math.floor(t*n*i),e=Math.floor(t*i),r=Math.min(s,e);return Math.max(Math.floor(i),r)}(this.Vt.Gs,i),this.Js>=2){Math.floor(i)%2!=this.Js%2&&this.Js--}const n=this.Vt.Ln;this.Vt.xe&&this.ye(t,n,this.Vt.st),this.Vt.di&&this.ke(t,n,this.Vt.st);const s=this.Ce(i);(!this.Vt.di||this.Js>2*s)&&this.Te(t,n,this.Vt.st)}ye(t,i,n){if(null===this.Vt)return;const{context:s,horizontalPixelRatio:e,verticalPixelRatio:r}=t;let h="",l=Math.min(Math.floor(e),Math.floor(this.Vt.Gs*e));l=Math.max(Math.floor(e),Math.min(l,this.Js));const a=Math.floor(.5*l);let o=null;for(let t=n.from;t<n.to;t++){const n=i[t];n.Pe!==h&&(s.fillStyle=n.Pe,h=n.Pe);const _=Math.round(Math.min(n.he,n.le)*r),u=Math.round(Math.max(n.he,n.le)*r),c=Math.round(n.se*r),d=Math.round(n.ee*r);let f=Math.round(e*n.rt)-a;const p=f+l-1;null!==o&&(f=Math.max(o+1,f),f=Math.min(f,p));const v=p-f+1;s.fillRect(f,c,v,_-c),s.fillRect(f,u+1,v,d-u),o=p}}Ce(t){let i=Math.floor(1*t);this.Js<=2*i&&(i=Math.floor(.5*(this.Js-1)));const n=Math.max(Math.floor(t),i);return this.Js<=2*n?Math.max(Math.floor(t),Math.floor(1*t)):n}ke(t,i,n){if(null===this.Vt)return;const{context:s,horizontalPixelRatio:e,verticalPixelRatio:r}=t;let h="";const l=this.Ce(e);let a=null;for(let t=n.from;t<n.to;t++){const n=i[t];n.Re!==h&&(s.fillStyle=n.Re,h=n.Re);let o=Math.round(n.rt*e)-Math.floor(.5*this.Js);const _=o+this.Js-1,u=Math.round(Math.min(n.he,n.le)*r),c=Math.round(Math.max(n.he,n.le)*r);if(null!==a&&(o=Math.max(a+1,o),o=Math.min(o,_)),this.Vt.Gs*e>2*l)N(s,o,u,_-o+1,c-u+1,l);else{const t=_-o+1;s.fillRect(o,u,t,c-u+1)}a=_}}Te(t,i,n){if(null===this.Vt)return;const{context:s,horizontalPixelRatio:e,verticalPixelRatio:r}=t;let h="";const l=this.Ce(e);for(let t=n.from;t<n.to;t++){const n=i[t];let a=Math.round(Math.min(n.he,n.le)*r),o=Math.round(Math.max(n.he,n.le)*r),_=Math.round(n.rt*e)-Math.floor(.5*this.Js),u=_+this.Js-1;if(n.ne!==h){const t=n.ne;s.fillStyle=t,h=t}this.Vt.di&&(_+=l,a+=l,u-=l,o-=l),a>o||s.fillRect(_,a,u-_+1,o-a+1)}}}class zt extends Ct{constructor(){super(...arguments),this.Bs=new Lt}Ys(t,i,n){return Object.assign(Object.assign({},this.oe(t,i,n)),n.As(t))}js(){const t=this.Ps.W();this.Bs.nt({Ln:this.Cs,Gs:this.Rs.Ct().Gs(),xe:t.wickVisible,di:t.borderVisible,st:this.Ts})}}class It extends L{constructor(){super(...arguments),this.Vt=null,this.De=[]}nt(t){this.Vt=t,this.De=[]}G({context:t,horizontalPixelRatio:i,verticalPixelRatio:n}){if(null===this.Vt||0===this.Vt.et.length||null===this.Vt.st)return;this.De.length||this.Oe(i);const s=Math.max(1,Math.floor(n)),e=Math.round(this.Vt.Be*n)-Math.floor(s/2),r=e+s;for(let i=this.Vt.st.from;i<this.Vt.st.to;i++){const h=this.Vt.et[i],l=this.De[i-this.Vt.st.from],a=Math.round(h.ht*n);let o,_;t.fillStyle=h.ne,a<=e?(o=a,_=r):(o=e,_=a-Math.floor(s/2)+s),t.fillRect(l.Ss,o,l.fi-l.Ss+1,_-o)}}Oe(t){if(null===this.Vt||0===this.Vt.et.length||null===this.Vt.st)return void(this.De=[]);const i=Math.ceil(this.Vt.Gs*t)<=1?0:Math.max(1,Math.floor(t)),n=Math.round(this.Vt.Gs*t)-i;this.De=new Array(this.Vt.st.to-this.Vt.st.from);for(let i=this.Vt.st.from;i<this.Vt.st.to;i++){const s=this.Vt.et[i],e=Math.round(s.rt*t);let r,h;if(n%2){const t=(n-1)/2;r=e-t,h=e+t}else{const t=n/2;r=e-t,h=e+t-1}this.De[i-this.Vt.st.from]={Ss:r,fi:h,Ee:e,Ae:s.rt*t,ct:s.ct}}for(let t=this.Vt.st.from+1;t<this.Vt.st.to;t++){const n=this.De[t-this.Vt.st.from],s=this.De[t-this.Vt.st.from-1];n.ct===s.ct+1&&(n.Ss-s.fi!==i+1&&(s.Ee>s.Ae?s.fi=n.Ss-i-1:n.Ss=s.fi+i+1))}let s=Math.ceil(this.Vt.Gs*t);for(let t=this.Vt.st.from;t<this.Vt.st.to;t++){const i=this.De[t-this.Vt.st.from];i.fi<i.Ss&&(i.fi=i.Ss);const n=i.fi-i.Ss+1;s=Math.min(n,s)}if(i>0&&s<4)for(let t=this.Vt.st.from;t<this.Vt.st.to;t++){const i=this.De[t-this.Vt.st.from];i.fi-i.Ss+1>s&&(i.Ee>i.Ae?i.fi-=1:i.Ss+=1)}}}class Nt extends xt{constructor(){super(...arguments),this.Bs=new It}Ys(t,i,n){return Object.assign(Object.assign({},this.Us(t,i)),n.As(t))}js(){const t={et:this.Cs,Gs:this.Rs.Ct().Gs(),st:this.Ts,Be:this.Ps.Et().Bt(this.Ps.W().base,h(this.Ps.Rt()).At)};this.Bs.nt(t)}}class Vt extends xt{constructor(){super(...arguments),this.Bs=new vt}Ys(t,i,n){return Object.assign(Object.assign({},this.Us(t,i)),n.As(t))}js(){const t=this.Ps.W(),i={et:this.Cs,jt:t.lineStyle,ds:t.lineType,lt:t.lineWidth,st:this.Ts,cs:this.Rs.Ct().Gs()};this.Bs.nt(i)}}const Ft=/[2-9]/g;class Wt{constructor(t=50){this.Le=0,this.ze=1,this.Ie=1,this.Ne={},this.Ve=new Map,this.Fe=t}We(){this.Le=0,this.Ve.clear(),this.ze=1,this.Ie=1,this.Ne={}}yi(t,i,n){return this.je(t,i,n).width}xi(t,i,n){const s=this.je(t,i,n);return((s.actualBoundingBoxAscent||0)-(s.actualBoundingBoxDescent||0))/2}je(t,i,n){const s=n||Ft,e=String(i).replace(s,"0");if(this.Ve.has(e))return r(this.Ve.get(e)).$e;if(this.Le===this.Fe){const t=this.Ne[this.Ie];delete this.Ne[this.Ie],this.Ve.delete(t),this.Ie++,this.Le--}t.save(),t.textBaseline="middle";const h=t.measureText(e);return t.restore(),0===h.width&&i.length||(this.Ve.set(e,{$e:h,He:this.ze}),this.Ne[this.ze]=e,this.Le++,this.ze++),h}}class jt{constructor(t){this.Ue=null,this.S=null,this.qe="right",this.Ye=t}Xe(t,i,n){this.Ue=t,this.S=i,this.qe=n}K(t){null!==this.S&&null!==this.Ue&&this.Ue.K(t,this.S,this.Ye,this.qe)}}class $t{constructor(t,i,n){this.Ze=t,this.Ye=new Wt(50),this.Ke=i,this.F=n,this.j=-1,this.Ht=new jt(this.Ye)}xt(){const t=this.F.Ge(this.Ke);if(null===t)return null;const i=t.Je(this.Ke)?t.Qe():this.Ke.Et();if(null===i)return null;const n=t.tr(i);if("overlay"===n)return null;const s=this.F.ir();return s.T!==this.j&&(this.j=s.T,this.Ye.We()),this.Ht.Xe(this.Ze.Ii(),s,n),this.Ht}}class Ht extends L{constructor(){super(...arguments),this.Vt=null}nt(t){this.Vt=t}nr(t,i){var n;if(!(null===(n=this.Vt)||void 0===n?void 0:n.Pt))return null;const{ht:s,lt:e,sr:r}=this.Vt;return i>=s-e-7&&i<=s+e+7?{er:this.Vt,sr:r}:null}G({context:t,bitmapSize:i,horizontalPixelRatio:e,verticalPixelRatio:r}){if(null===this.Vt)return;if(!1===this.Vt.Pt)return;const h=Math.round(this.Vt.ht*r);h<0||h>i.height||(t.lineCap="butt",t.strokeStyle=this.Vt.D,t.lineWidth=Math.floor(this.Vt.lt*e),n(t,this.Vt.jt),s(t,h,0,i.width))}}class Ut{constructor(t){this.rr={ht:0,D:"rgba(0, 0, 0, 0)",lt:1,jt:0,Pt:!1},this.hr=new Ht,this.gt=!0,this.Ps=t,this.Rs=t.Yt(),this.hr.nt(this.rr)}Mt(){this.gt=!0}xt(){return this.Ps.Pt()?(this.gt&&(this.lr(),this.gt=!1),this.hr):null}}class qt extends Ut{constructor(t){super(t)}lr(){this.rr.Pt=!1;const t=this.Ps.Et(),i=t.ar().ar;if(2!==i&&3!==i)return;const n=this.Ps.W();if(!n.baseLineVisible||!this.Ps.Pt())return;const s=this.Ps.Rt();null!==s&&(this.rr.Pt=!0,this.rr.ht=t.Bt(s.At,s.At),this.rr.D=n.baseLineColor,this.rr.lt=n.baseLineWidth,this.rr.jt=n.baseLineStyle)}}class Yt extends L{constructor(){super(...arguments),this.Vt=null}nt(t){this.Vt=t}_r(){return this.Vt}G({context:t,horizontalPixelRatio:i,verticalPixelRatio:n}){const s=this.Vt;if(null===s)return;const e=Math.max(1,Math.floor(i)),r=e%2/2,h=Math.round(s.Ae.x*i)+r,l=s.Ae.y*n;t.fillStyle=s.ur,t.beginPath();const a=Math.max(2,1.5*s.cr)*i;t.arc(h,l,a,0,2*Math.PI,!1),t.fill(),t.fillStyle=s.dr,t.beginPath(),t.arc(h,l,s._t*i,0,2*Math.PI,!1),t.fill(),t.lineWidth=e,t.strokeStyle=s.pr,t.beginPath(),t.arc(h,l,s._t*i+e/2,0,2*Math.PI,!1),t.stroke()}}const Xt=[{vr:0,mr:.25,br:4,gr:10,wr:.25,Mr:0,Sr:.4,yr:.8},{vr:.25,mr:.525,br:10,gr:14,wr:0,Mr:0,Sr:.8,yr:0},{vr:.525,mr:1,br:14,gr:14,wr:0,Mr:0,Sr:0,yr:0}];function Zt(t,i,n,s){return function(t,i){if("transparent"===t)return t;const n=p(t),s=n[3];return`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${i*s})`}(t,n+(s-n)*i)}function Kt(t,i){const n=t%2600/2600;let s;for(const t of Xt)if(n>=t.vr&&n<=t.mr){s=t;break}e(void 0!==s,"Last price animation internal logic error");const r=(n-s.vr)/(s.mr-s.vr);return{dr:Zt(i,r,s.wr,s.Mr),pr:Zt(i,r,s.Sr,s.yr),_t:(h=r,l=s.br,a=s.gr,l+(a-l)*h)};var h,l,a}class Gt{constructor(t){this.Ht=new Yt,this.gt=!0,this.kr=!0,this.Cr=performance.now(),this.Tr=this.Cr-1,this.Pr=t}Rr(){this.Tr=this.Cr-1,this.Mt()}Dr(){if(this.Mt(),2===this.Pr.W().lastPriceAnimation){const t=performance.now(),i=this.Tr-t;if(i>0)return void(i<650&&(this.Tr+=2600));this.Cr=t,this.Tr=t+2600}}Mt(){this.gt=!0}Or(){this.kr=!0}Pt(){return 0!==this.Pr.W().lastPriceAnimation}Br(){switch(this.Pr.W().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.Tr}}xt(){return this.gt?(this.yt(),this.gt=!1,this.kr=!1):this.kr&&(this.Er(),this.kr=!1),this.Ht}yt(){this.Ht.nt(null);const t=this.Pr.Yt().Ct(),i=t.Vs(),n=this.Pr.Rt();if(null===i||null===n)return;const s=this.Pr.Ar(!0);if(s.Lr||!i.zr(s.Xs))return;const e={x:t.Nt(s.Xs),y:this.Pr.Et().Bt(s.dt,n.At)},r=s.D,h=this.Pr.W().lineWidth,l=Kt(this.Ir(),r);this.Ht.nt({ur:r,cr:h,dr:l.dr,pr:l.pr,_t:l._t,Ae:e})}Er(){const t=this.Ht._r();if(null!==t){const i=Kt(this.Ir(),t.ur);t.dr=i.dr,t.pr=i.pr,t._t=i._t}}Ir(){return this.Br()?performance.now()-this.Cr:2599}}function Jt(t,i){return Ot(Math.min(Math.max(t,12),30)*i)}function Qt(t,i){switch(t){case"arrowDown":case"arrowUp":return Jt(i,1);case"circle":return Jt(i,.8);case"square":return Jt(i,.7)}}function ti(t){return function(t){const i=Math.ceil(t);return i%2!=0?i-1:i}(Jt(t,1))}function ii(t){return Math.max(Jt(t,.1),3)}function ni(t,i,n,s,e){const r=Qt("square",n),h=(r-1)/2,l=t-h,a=i-h;return s>=l&&s<=l+r&&e>=a&&e<=a+r}function si(t,i,n,s,e){const r=(Qt("arrowUp",e)-1)/2,h=(Ot(e/2)-1)/2;i.beginPath(),t?(i.moveTo(n-r,s),i.lineTo(n,s-r),i.lineTo(n+r,s),i.lineTo(n+h,s),i.lineTo(n+h,s+r),i.lineTo(n-h,s+r),i.lineTo(n-h,s)):(i.moveTo(n-r,s),i.lineTo(n,s+r),i.lineTo(n+r,s),i.lineTo(n+h,s),i.lineTo(n+h,s-r),i.lineTo(n-h,s-r),i.lineTo(n-h,s)),i.fill()}function ei(t,i,n,s,e,r){return ni(i,n,s,e,r)}class ri extends D{constructor(){super(...arguments),this.Vt=null,this.Ye=new Wt,this.j=-1,this.$="",this.Nr=""}nt(t){this.Vt=t}Xe(t,i){this.j===t&&this.$===i||(this.j=t,this.$=i,this.Nr=T(t,i),this.Ye.We())}nr(t,i){if(null===this.Vt||null===this.Vt.st)return null;for(let n=this.Vt.st.from;n<this.Vt.st.to;n++){const s=this.Vt.et[n];if(li(s,t,i))return{er:s.Vr,sr:s.sr}}return null}G({context:t},i,n){if(null!==this.Vt&&null!==this.Vt.st){t.textBaseline="middle",t.font=this.Nr;for(let i=this.Vt.st.from;i<this.Vt.st.to;i++){const n=this.Vt.et[i];void 0!==n.Qt&&(n.Qt.V=this.Ye.yi(t,n.Qt.Fr),n.Qt.It=this.j,n.Qt.rt=n.rt-n.Qt.V/2),hi(n,t)}}}}function hi(t,i){i.fillStyle=t.D,void 0!==t.Qt&&function(t,i,n,s){t.fillText(i,n,s)}(i,t.Qt.Fr,t.Qt.rt,t.Qt.ht),function(t,i){if(0===t.Fs)return;switch(t.Wr){case"arrowDown":return void si(!1,i,t.rt,t.ht,t.Fs);case"arrowUp":return void si(!0,i,t.rt,t.ht,t.Fs);case"circle":return void function(t,i,n,s){const e=(Qt("circle",s)-1)/2;t.beginPath(),t.arc(i,n,e,0,2*Math.PI,!1),t.fill()}(i,t.rt,t.ht,t.Fs);case"square":return void function(t,i,n,s){const e=Qt("square",s),r=(e-1)/2,h=i-r,l=n-r;t.fillRect(h,l,e,e)}(i,t.rt,t.ht,t.Fs)}t.Wr}(t,i)}function li(t,i,n){return!(void 0===t.Qt||!function(t,i,n,s,e,r){const h=s/2;return e>=t&&e<=t+n&&r>=i-h&&r<=i+h}(t.Qt.rt,t.Qt.ht,t.Qt.V,t.Qt.It,i,n))||function(t,i,n){if(0===t.Fs)return!1;switch(t.Wr){case"arrowDown":case"arrowUp":return ei(0,t.rt,t.ht,t.Fs,i,n);case"circle":return function(t,i,n,s,e){const r=2+Qt("circle",n)/2,h=t-s,l=i-e;return Math.sqrt(h*h+l*l)<=r}(t.rt,t.ht,t.Fs,i,n);case"square":return ni(t.rt,t.ht,t.Fs,i,n)}}(t,i,n)}function ai(t,i,n,s,e,r,h,l,a){const o=g(n)?n:n.de,_=g(n)?n:n.ue,u=g(n)?n:n.ce,c=g(i.size)?Math.max(i.size,0):1,d=ti(l.Gs())*c,f=d/2;switch(t.Fs=d,i.position){case"inBar":return t.ht=h.Bt(o,a),void(void 0!==t.Qt&&(t.Qt.ht=t.ht+f+r+.6*e));case"aboveBar":return t.ht=h.Bt(_,a)-f-s.jr,void 0!==t.Qt&&(t.Qt.ht=t.ht-f-.6*e,s.jr+=1.2*e),void(s.jr+=d+r);case"belowBar":return t.ht=h.Bt(u,a)+f+s.$r,void 0!==t.Qt&&(t.Qt.ht=t.ht+f+r+.6*e,s.$r+=1.2*e),void(s.$r+=d+r)}i.position}class oi{constructor(t,i){this.gt=!0,this.Hr=!0,this.Ur=!0,this.qr=null,this.Ht=new ri,this.Pr=t,this.Ui=i,this.Vt={et:[],st:null}}Mt(t){this.gt=!0,this.Ur=!0,"data"===t&&(this.Hr=!0)}xt(t){if(!this.Pr.Pt())return null;this.gt&&this.Yr();const i=this.Ui.W().layout;return this.Ht.Xe(i.fontSize,i.fontFamily),this.Ht.nt(this.Vt),this.Ht}Xr(){if(this.Ur){if(this.Pr.Zr().length>0){const t=this.Ui.Ct().Gs(),i=ii(t),n=1.5*ti(t)+2*i;this.qr={above:n,below:n}}else this.qr=null;this.Ur=!1}return this.qr}Yr(){const t=this.Pr.Et(),i=this.Ui.Ct(),n=this.Pr.Zr();this.Hr&&(this.Vt.et=n.map((t=>({ct:t.time,rt:0,ht:0,Fs:0,Wr:t.shape,D:t.color,Vr:t.internalId,sr:t.id,Qt:void 0}))),this.Hr=!1);const s=this.Ui.W().layout;this.Vt.st=null;const e=i.Vs();if(null===e)return;const r=this.Pr.Rt();if(null===r)return;if(0===this.Vt.et.length)return;let h=NaN;const l=ii(i.Gs()),a={jr:l,$r:l};this.Vt.st=Mt(this.Vt.et,e,!0);for(let e=this.Vt.st.from;e<this.Vt.st.to;e++){const o=n[e];o.time!==h&&(a.jr=l,a.$r=l,h=o.time);const _=this.Vt.et[e];_.rt=i.Nt(o.time),void 0!==o.text&&o.text.length>0&&(_.Qt={Fr:o.text,rt:0,ht:0,V:0,It:0});const u=this.Pr.Kr(o.time);null!==u&&ai(_,o,u,a,s.fontSize,l,t,i,r.At)}this.gt=!1}}class _i extends Ut{constructor(t){super(t)}lr(){const t=this.rr;t.Pt=!1;const i=this.Ps.W();if(!i.priceLineVisible||!this.Ps.Pt())return;const n=this.Ps.Ar(0===i.priceLineSource);n.Lr||(t.Pt=!0,t.ht=n.Ci,t.D=this.Ps.Gr(n.D),t.lt=i.priceLineWidth,t.jt=i.priceLineStyle)}}class ui extends U{constructor(t){super(),this.Ut=t}Ni(t,i,n){t.Pt=!1,i.Pt=!1;const s=this.Ut;if(!s.Pt())return;const e=s.W(),r=e.lastValueVisible,h=""!==s.Jr(),l=0===e.seriesLastValueMode,a=s.Ar(!1);if(a.Lr)return;r&&(t.Qt=this.Qr(a,r,l),t.Pt=0!==t.Qt.length),(h||l)&&(i.Qt=this.th(a,r,h,l),i.Pt=i.Qt.length>0);const o=s.Gr(a.D),_=v(o);n.t=_.t,n.Ci=a.Ci,i.Lt=s.Yt().zt(a.Ci/s.Et().It()),t.Lt=o,t.D=_.i,i.D=_.i}th(t,i,n,s){let e="";const r=this.Ut.Jr();return n&&0!==r.length&&(e+=`${r} `),i&&s&&(e+=this.Ut.Et().ih()?t.nh:t.sh),e.trim()}Qr(t,i,n){return i?n?this.Ut.Et().ih()?t.sh:t.nh:t.Qt:""}}class ci{constructor(t,i){this.eh=t,this.rh=i}hh(t){return null!==t&&(this.eh===t.eh&&this.rh===t.rh)}lh(){return new ci(this.eh,this.rh)}ah(){return this.eh}oh(){return this.rh}_h(){return this.rh-this.eh}Wi(){return this.rh===this.eh||Number.isNaN(this.rh)||Number.isNaN(this.eh)}ts(t){return null===t?this:new ci(Math.min(this.ah(),t.ah()),Math.max(this.oh(),t.oh()))}uh(t){if(!g(t))return;if(0===this.rh-this.eh)return;const i=.5*(this.rh+this.eh);let n=this.rh-i,s=this.eh-i;n*=t,s*=t,this.rh=i+n,this.eh=i+s}dh(t){g(t)&&(this.rh+=t,this.eh+=t)}fh(){return{minValue:this.eh,maxValue:this.rh}}static ph(t){return null===t?null:new ci(t.minValue,t.maxValue)}}class di{constructor(t,i){this.mh=t,this.bh=i||null}gh(){return this.mh}wh(){return this.bh}fh(){return null===this.mh?null:{priceRange:this.mh.fh(),margins:this.bh||void 0}}static ph(t){return null===t?null:new di(ci.ph(t.priceRange),t.margins)}}class fi extends Ut{constructor(t,i){super(t),this.Mh=i}lr(){const t=this.rr;t.Pt=!1;const i=this.Mh.W();if(!this.Ps.Pt()||!i.lineVisible)return;const n=this.Mh.Sh();null!==n&&(t.Pt=!0,t.ht=n,t.D=i.color,t.lt=i.lineWidth,t.jt=i.lineStyle,t.sr=this.Mh.W().id)}}class pi extends U{constructor(t,i){super(),this.Pr=t,this.Mh=i}Ni(t,i,n){t.Pt=!1,i.Pt=!1;const s=this.Mh.W(),e=s.axisLabelVisible,r=""!==s.title,h=this.Pr;if(!e||!h.Pt())return;const l=this.Mh.Sh();if(null===l)return;r&&(i.Qt=s.title,i.Pt=!0),i.Lt=h.Yt().zt(l/h.Et().It()),t.Qt=this.xh(s.price),t.Pt=!0;const a=v(s.axisLabelColor||s.color);n.t=a.t;const o=s.axisLabelTextColor||a.i;t.D=o,i.D=o,n.Ci=l}xh(t){const i=this.Pr.Rt();return null===i?"":this.Pr.Et().ji(t,i.At)}}class vi{constructor(t,i){this.Pr=t,this.cn=i,this.yh=new fi(t,this),this.Ze=new pi(t,this),this.kh=new $t(this.Ze,t,t.Yt())}Ch(t){b(this.cn,t),this.Mt(),this.Pr.Yt().Th()}W(){return this.cn}Ph(){return this.yh}Rh(){return this.kh}Dh(){return this.Ze}Mt(){this.yh.Mt(),this.Ze.Mt()}Sh(){const t=this.Pr,i=t.Et();if(t.Yt().Ct().Wi()||i.Wi())return null;const n=t.Rt();return null===n?null:i.Bt(this.cn.price,n.At)}}class mi extends K{constructor(t){super(),this.Ui=t}Yt(){return this.Ui}}const bi={Bar:(t,i,n,s)=>{var e;const r=i.upColor,a=i.downColor,o=h(t(n,s)),_=l(o.At[0])<=l(o.At[3]);return{ne:null!==(e=o.D)&&void 0!==e?e:_?r:a}},Candlestick:(t,i,n,s)=>{var e,r,a;const o=i.upColor,_=i.downColor,u=i.borderUpColor,c=i.borderDownColor,d=i.wickUpColor,f=i.wickDownColor,p=h(t(n,s)),v=l(p.At[0])<=l(p.At[3]);return{ne:null!==(e=p.D)&&void 0!==e?e:v?o:_,Re:null!==(r=p.Lt)&&void 0!==r?r:v?u:c,Pe:null!==(a=p.Oh)&&void 0!==a?a:v?d:f}},Area:(t,i,n,s)=>{var e,r,l,a;const o=h(t(n,s));return{ne:null!==(e=o.ut)&&void 0!==e?e:i.lineColor,ut:null!==(r=o.ut)&&void 0!==r?r:i.lineColor,gs:null!==(l=o.gs)&&void 0!==l?l:i.topColor,ws:null!==(a=o.ws)&&void 0!==a?a:i.bottomColor}},Baseline:(t,i,n,s)=>{var e,r,l,a,o,_;const u=h(t(n,s));return{ne:u.At[3]>=i.baseValue.price?i.topLineColor:i.bottomLineColor,ge:null!==(e=u.ge)&&void 0!==e?e:i.topLineColor,we:null!==(r=u.we)&&void 0!==r?r:i.bottomLineColor,fe:null!==(l=u.fe)&&void 0!==l?l:i.topFillColor1,pe:null!==(a=u.pe)&&void 0!==a?a:i.topFillColor2,ve:null!==(o=u.ve)&&void 0!==o?o:i.bottomFillColor1,me:null!==(_=u.me)&&void 0!==_?_:i.bottomFillColor2}},Line:(t,i,n,s)=>{var e,r;const l=h(t(n,s));return{ne:null!==(e=l.D)&&void 0!==e?e:i.color,ut:null!==(r=l.D)&&void 0!==r?r:i.color}},Histogram:(t,i,n,s)=>{var e;return{ne:null!==(e=h(t(n,s)).D)&&void 0!==e?e:i.color}}};class gi{constructor(t){this.Bh=(t,i)=>void 0!==i?i.At:this.Pr.Ln().Eh(t),this.Pr=t,this.Ah=bi[t.Lh()]}As(t,i){return this.Ah(this.Bh,this.Pr.W(),t,i)}}var wi;!function(t){t[t.NearestLeft=-1]="NearestLeft",t[t.None=0]="None",t[t.NearestRight=1]="NearestRight"}(wi||(wi={}));const Mi=30;class Si{constructor(){this.zh=[],this.Ih=new Map,this.Nh=new Map}Vh(){return this.Fs()>0?this.zh[this.zh.length-1]:null}Fh(){return this.Fs()>0?this.Wh(0):null}An(){return this.Fs()>0?this.Wh(this.zh.length-1):null}Fs(){return this.zh.length}Wi(){return 0===this.Fs()}zr(t){return null!==this.jh(t,0)}Eh(t){return this.$h(t)}$h(t,i=0){const n=this.jh(t,i);return null===n?null:Object.assign(Object.assign({},this.Hh(n)),{Xs:this.Wh(n)})}qs(){return this.zh}Uh(t,i,n){if(this.Wi())return null;let s=null;for(const e of n){s=xi(s,this.qh(t,i,e))}return s}nt(t){this.Nh.clear(),this.Ih.clear(),this.zh=t}Wh(t){return this.zh[t].Xs}Hh(t){return this.zh[t]}jh(t,i){const n=this.Yh(t);if(null===n&&0!==i)switch(i){case-1:return this.Xh(t);case 1:return this.Zh(t);default:throw new TypeError("Unknown search mode")}return n}Xh(t){let i=this.Kh(t);return i>0&&(i-=1),i!==this.zh.length&&this.Wh(i)<t?i:null}Zh(t){const i=this.Gh(t);return i!==this.zh.length&&t<this.Wh(i)?i:null}Yh(t){const i=this.Kh(t);return i===this.zh.length||t<this.zh[i].Xs?null:i}Kh(t){return mt(this.zh,t,((t,i)=>t.Xs<i))}Gh(t){return bt(this.zh,t,((t,i)=>i.Xs>t))}Jh(t,i,n){let s=null;for(let e=t;e<i;e++){const t=this.zh[e].At[n];Number.isNaN(t)||(null===s?s={Qh:t,tl:t}:(t<s.Qh&&(s.Qh=t),t>s.tl&&(s.tl=t)))}return s}qh(t,i,n){if(this.Wi())return null;let s=null;const e=h(this.Fh()),r=h(this.An()),l=Math.max(t,e),a=Math.min(i,r),o=Math.ceil(l/Mi)*Mi,_=Math.max(o,Math.floor(a/Mi)*Mi);{const t=this.Kh(l),e=this.Gh(Math.min(a,o,i));s=xi(s,this.Jh(t,e,n))}let u=this.Ih.get(n);void 0===u&&(u=new Map,this.Ih.set(n,u));for(let t=Math.max(o+1,l);t<_;t+=Mi){const i=Math.floor(t/Mi);let e=u.get(i);if(void 0===e){const t=this.Kh(i*Mi),s=this.Gh((i+1)*Mi-1);e=this.Jh(t,s,n),u.set(i,e)}s=xi(s,e)}{const t=this.Kh(_),i=this.Gh(a);s=xi(s,this.Jh(t,i,n))}return s}}function xi(t,i){if(null===t)return i;if(null===i)return t;return{Qh:Math.min(t.Qh,i.Qh),tl:Math.max(t.tl,i.tl)}}class yi extends mi{constructor(t,i,n){super(t),this.Vt=new Si,this.yh=new _i(this),this.il=[],this.nl=new qt(this),this.sl=null,this.el=null,this.rl=[],this.hl=[],this.ll=null,this.cn=i,this.al=n;const s=new ui(this);this.hn=[s],this.kh=new $t(s,this,t),"Area"!==n&&"Line"!==n&&"Baseline"!==n||(this.sl=new Gt(this)),this.ol(),this._l()}M(){null!==this.ll&&clearTimeout(this.ll)}Gr(t){return this.cn.priceLineColor||t}Ar(t){const i={Lr:!0},n=this.Et();if(this.Yt().Ct().Wi()||n.Wi()||this.Vt.Wi())return i;const s=this.Yt().Ct().Vs(),e=this.Rt();if(null===s||null===e)return i;let r,h;if(t){const t=this.Vt.Vh();if(null===t)return i;r=t,h=t.Xs}else{const t=this.Vt.$h(s.fi(),-1);if(null===t)return i;if(r=this.Vt.Eh(t.Xs),null===r)return i;h=t.Xs}const l=r.At[3],a=this.Ls().As(h,{At:r}),o=n.Bt(l,e.At);return{Lr:!1,dt:l,Qt:n.ji(l,e.At),nh:n.ul(l),sh:n.cl(l,e.At),D:a.ne,Ci:o,Xs:h}}Ls(){return null!==this.el||(this.el=new gi(this)),this.el}W(){return this.cn}Ch(t){const i=t.priceScaleId;void 0!==i&&i!==this.cn.priceScaleId&&this.Yt().dl(this,i),b(this.cn,t),void 0!==t.priceFormat&&(this.ol(),this.Yt().fl()),this.Yt().pl(this),this.Yt().vl(),this.gn.Mt("options")}nt(t,i){this.Vt.nt(t),this.ml(),this.gn.Mt("data"),this.dn.Mt("data"),null!==this.sl&&(i&&i.bl?this.sl.Dr():0===t.length&&this.sl.Rr());const n=this.Yt().Ge(this);this.Yt().gl(n),this.Yt().pl(this),this.Yt().vl(),this.Yt().Th()}wl(t){this.rl=t,this.ml();const i=this.Yt().Ge(this);this.dn.Mt("data"),this.Yt().gl(i),this.Yt().pl(this),this.Yt().vl(),this.Yt().Th()}Ml(){return this.rl}Zr(){return this.hl}Sl(t){const i=new vi(this,t);return this.il.push(i),this.Yt().pl(this),i}xl(t){const i=this.il.indexOf(t);-1!==i&&this.il.splice(i,1),this.Yt().pl(this)}Lh(){return this.al}Rt(){const t=this.yl();return null===t?null:{At:t.At[3],kl:t.ct}}yl(){const t=this.Yt().Ct().Vs();if(null===t)return null;const i=t.Ss();return this.Vt.$h(i,1)}Ln(){return this.Vt}Kr(t){const i=this.Vt.Eh(t);return null===i?null:"Bar"===this.al||"Candlestick"===this.al?{_e:i.At[0],ue:i.At[1],ce:i.At[2],de:i.At[3]}:i.At[3]}Cl(t){const i=this.sl;return null!==i&&i.Pt()?(null===this.ll&&i.Br()&&(this.ll=setTimeout((()=>{this.ll=null,this.Yt().Tl()}),0)),i.Or(),[i]):[]}Pn(){const t=[];this.Pl()||t.push(this.nl),t.push(this.gn,this.yh,this.dn);const i=this.il.map((t=>t.Ph()));return t.push(...i),t}Qi(t){return[this.kh,...this.il.map((t=>t.Rh()))]}Rn(t,i){if(i!==this.Xi&&!this.Pl())return[];const n=[...this.hn];for(const t of this.il)n.push(t.Dh());return n}Rl(t,i){if(void 0!==this.cn.autoscaleInfoProvider){const n=this.cn.autoscaleInfoProvider((()=>{const n=this.Dl(t,i);return null===n?null:n.fh()}));return di.ph(n)}return this.Dl(t,i)}Ol(){return this.cn.priceFormat.minMove}Bl(){return this.El}On(){var t;this.gn.Mt(),this.dn.Mt();for(const t of this.hn)t.Mt();for(const t of this.il)t.Mt();this.yh.Mt(),this.nl.Mt(),null===(t=this.sl)||void 0===t||t.Mt()}Et(){return h(super.Et())}Tt(t){if(!(("Line"===this.al||"Area"===this.al||"Baseline"===this.al)&&this.cn.crosshairMarkerVisible))return null;const i=this.Vt.Eh(t);if(null===i)return null;return{dt:i.At[3],_t:this.Al(),Lt:this.Ll(),Ot:this.zl(),Dt:this.Il(t)}}Jr(){return this.cn.title}Pt(){return this.cn.visible}Pl(){return!Q(this.Et().Nl())}Dl(t,i){if(!w(t)||!w(i)||this.Vt.Wi())return null;const n="Line"===this.al||"Area"===this.al||"Baseline"===this.al||"Histogram"===this.al?[3]:[2,1],s=this.Vt.Uh(t,i,n);let e=null!==s?new ci(s.Qh,s.tl):null;if("Histogram"===this.Lh()){const t=this.cn.base,i=new ci(t,t);e=null!==e?e.ts(i):i}return new di(e,this.dn.Xr())}Al(){switch(this.al){case"Line":case"Area":case"Baseline":return this.cn.crosshairMarkerRadius}return 0}Ll(){switch(this.al){case"Line":case"Area":case"Baseline":{const t=this.cn.crosshairMarkerBorderColor;if(0!==t.length)return t}}return null}zl(){switch(this.al){case"Line":case"Area":case"Baseline":return this.cn.crosshairMarkerBorderWidth}return 0}Il(t){switch(this.al){case"Line":case"Area":case"Baseline":{const t=this.cn.crosshairMarkerBackgroundColor;if(0!==t.length)return t}}return this.Ls().As(t).ne}ol(){switch(this.cn.priceFormat.type){case"custom":this.El={format:this.cn.priceFormat.formatter};break;case"volume":this.El=new rt(this.cn.priceFormat.precision);break;case"percent":this.El=new et(this.cn.priceFormat.precision);break;default:{const t=Math.pow(10,this.cn.priceFormat.precision);this.El=new st(t,this.cn.priceFormat.minMove*t)}}null!==this.Xi&&this.Xi.Vl()}ml(){const t=this.Yt().Ct();if(!t.Fl()||this.Vt.Wi())return void(this.hl=[]);const i=h(this.Vt.Fh());this.hl=this.rl.map(((n,s)=>{const e=h(t.Wl(n.time,!0)),r=e<i?1:-1;return{time:h(this.Vt.$h(e,r)).Xs,position:n.position,shape:n.shape,color:n.color,id:n.id,internalId:s,text:n.text,size:n.size}}))}_l(){switch(this.dn=new oi(this,this.Yt()),this.al){case"Bar":this.gn=new Tt(this,this.Yt());break;case"Candlestick":this.gn=new zt(this,this.Yt());break;case"Line":this.gn=new Vt(this,this.Yt());break;case"Area":this.gn=new yt(this,this.Yt());break;case"Baseline":this.gn=new At(this,this.Yt());break;case"Histogram":this.gn=new Nt(this,this.Yt());break;default:throw Error("Unknown chart style assigned: "+this.al)}}}class ki{constructor(t){this.cn=t}jl(t,i,n){let s=t;if(0===this.cn.mode)return s;const e=n.pn(),r=e.Rt();if(null===r)return s;const h=e.Bt(t,r),a=n.$l().filter((t=>t instanceof yi)).reduce(((t,s)=>{if(n.Je(s)||!s.Pt())return t;const e=s.Et(),r=s.Ln();if(e.Wi()||!r.zr(i))return t;const h=r.Eh(i);if(null===h)return t;const a=l(s.Rt());return t.concat([e.Bt(h.At[3],a.At)])}),[]);if(0===a.length)return s;a.sort(((t,i)=>Math.abs(t-h)-Math.abs(i-h)));const o=a[0];return s=e.vn(o,r),s}}class Ci extends L{constructor(){super(...arguments),this.Vt=null}nt(t){this.Vt=t}G({context:t,bitmapSize:i,horizontalPixelRatio:s,verticalPixelRatio:e}){if(null===this.Vt)return;const r=Math.max(1,Math.floor(s));t.lineWidth=r,function(t,i){t.save(),t.lineWidth%2&&t.translate(.5,.5),i(),t.restore()}(t,(()=>{const l=h(this.Vt);if(l.Hl){t.strokeStyle=l.Ul,n(t,l.ql),t.beginPath();for(const n of l.Yl){const e=Math.round(n.Xl*s);t.moveTo(e,-r),t.lineTo(e,i.height+r)}t.stroke()}if(l.Zl){t.strokeStyle=l.Kl,n(t,l.Gl),t.beginPath();for(const n of l.Jl){const s=Math.round(n.Xl*e);t.moveTo(-r,s),t.lineTo(i.width+r,s)}t.stroke()}}))}}class Ti{constructor(t){this.Ht=new Ci,this.gt=!0,this.nn=t}Mt(){this.gt=!0}xt(){if(this.gt){const t=this.nn.Yt().W().grid,i={Zl:t.horzLines.visible,Hl:t.vertLines.visible,Kl:t.horzLines.color,Ul:t.vertLines.color,Gl:t.horzLines.style,ql:t.vertLines.style,Jl:this.nn.pn().Ql(),Yl:this.nn.Yt().Ct().Ql()||[]};this.Ht.nt(i),this.gt=!1}return this.Ht}}class Pi{constructor(t){this.gn=new Ti(t)}Ph(){return this.gn}}const Ri={ta:4,ia:1e-4};function Di(t,i){const n=100*(t-i)/i;return i<0?-n:n}function Oi(t,i){const n=Di(t.ah(),i),s=Di(t.oh(),i);return new ci(n,s)}function Bi(t,i){const n=100*(t-i)/i+100;return i<0?-n:n}function Ei(t,i){const n=Bi(t.ah(),i),s=Bi(t.oh(),i);return new ci(n,s)}function Ai(t,i){const n=Math.abs(t);if(n<1e-15)return 0;const s=Dt(n+i.ia)+i.ta;return t<0?-s:s}function Li(t,i){const n=Math.abs(t);if(n<1e-15)return 0;const s=Math.pow(10,n-i.ta)-i.ia;return t<0?-s:s}function zi(t,i){if(null===t)return null;const n=Ai(t.ah(),i),s=Ai(t.oh(),i);return new ci(n,s)}function Ii(t,i){if(null===t)return null;const n=Li(t.ah(),i),s=Li(t.oh(),i);return new ci(n,s)}function Ni(t){if(null===t)return Ri;const i=Math.abs(t.oh()-t.ah());if(i>=1||i<1e-15)return Ri;const n=Math.ceil(Math.abs(Math.log10(i))),s=Ri.ta+n;return{ta:s,ia:1/Math.pow(10,s)}}class Vi{constructor(t,i){if(this.na=t,this.sa=i,function(t){if(t<0)return!1;for(let i=t;i>1;i/=10)if(i%10!=0)return!1;return!0}(this.na))this.ea=[2,2.5,2];else{this.ea=[];for(let t=this.na;1!==t;){if(t%2==0)this.ea.push(2),t/=2;else{if(t%5!=0)throw new Error("unexpected base");this.ea.push(2,2.5),t/=5}if(this.ea.length>100)throw new Error("something wrong with base")}}}ra(t,i,n){const s=0===this.na?0:1/this.na;let e=Math.pow(10,Math.max(0,Math.ceil(Dt(t-i)))),r=0,h=this.sa[0];for(;;){const t=Rt(e,s,1e-14)&&e>s+1e-14,i=Rt(e,n*h,1e-14),l=Rt(e,1,1e-14);if(!(t&&i&&l))break;e/=h,h=this.sa[++r%this.sa.length]}if(e<=s+1e-14&&(e=s),e=Math.max(1,e),this.ea.length>0&&(l=e,a=1,o=1e-14,Math.abs(l-a)<o))for(r=0,h=this.ea[0];Rt(e,n*h,1e-14)&&e>s+1e-14;)e/=h,h=this.ea[++r%this.ea.length];var l,a,o;return e}}class Fi{constructor(t,i,n,s){this.ha=[],this.Vi=t,this.na=i,this.la=n,this.aa=s}ra(t,i){if(t<i)throw new Error("high < low");const n=this.Vi.It(),s=(t-i)*this.oa()/n,e=new Vi(this.na,[2,2.5,2]),r=new Vi(this.na,[2,2,2.5]),h=new Vi(this.na,[2.5,2,2]),l=[];return l.push(e.ra(t,i,s),r.ra(t,i,s),h.ra(t,i,s)),function(t){if(t.length<1)throw Error("array is empty");let i=t[0];for(let n=1;n<t.length;++n)t[n]<i&&(i=t[n]);return i}(l)}_a(){const t=this.Vi,i=t.Rt();if(null===i)return void(this.ha=[]);const n=t.It(),s=this.la(n-1,i),e=this.la(0,i),r=this.Vi.W().entireTextOnly?this.ua()/2:0,h=r,l=n-1-r,a=Math.max(s,e),o=Math.min(s,e);if(a===o)return void(this.ha=[]);let _=this.ra(a,o),u=a%_;u+=u<0?_:0;const c=a>=o?1:-1;let d=null,f=0;for(let n=a-u;n>o;n-=_){const s=this.aa(n,i,!0);null!==d&&Math.abs(s-d)<this.oa()||(s<h||s>l||(f<this.ha.length?(this.ha[f].Xl=s,this.ha[f].ca=t.da(n)):this.ha.push({Xl:s,ca:t.da(n)}),f++,d=s,t.fa()&&(_=this.ra(n*c,o))))}this.ha.length=f}Ql(){return this.ha}ua(){return this.Vi.T()}oa(){return Math.ceil(2.5*this.ua())}}function Wi(t){return t.slice().sort(((t,i)=>h(t.Ki())-h(i.Ki())))}var ji;!function(t){t[t.Normal=0]="Normal",t[t.Logarithmic=1]="Logarithmic",t[t.Percentage=2]="Percentage",t[t.IndexedTo100=3]="IndexedTo100"}(ji||(ji={}));const $i=new et,Hi=new st(100,1);class Ui{constructor(t,i,n,s){this.pa=0,this.va=null,this.mh=null,this.ma=null,this.ba={ga:!1,wa:null},this.Ma=0,this.Sa=0,this.xa=new m,this.ya=new m,this.ka=[],this.Ca=null,this.Ta=null,this.Pa=null,this.Ra=null,this.El=Hi,this.Da=Ni(null),this.Oa=t,this.cn=i,this.Ba=n,this.Ea=s,this.Aa=new Fi(this,100,this.La.bind(this),this.za.bind(this))}Nl(){return this.Oa}W(){return this.cn}Ch(t){if(b(this.cn,t),this.Vl(),void 0!==t.mode&&this.Ia({ar:t.mode}),void 0!==t.scaleMargins){const i=r(t.scaleMargins.top),n=r(t.scaleMargins.bottom);if(i<0||i>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${i}`);if(n<0||n>1||i+n>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${n}`);if(i+n>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${i+n}`);this.Na(),this.Ta=null}}Va(){return this.cn.autoScale}fa(){return 1===this.cn.mode}ih(){return 2===this.cn.mode}Fa(){return 3===this.cn.mode}ar(){return{Wn:this.cn.autoScale,Wa:this.cn.invertScale,ar:this.cn.mode}}Ia(t){const i=this.ar();let n=null;void 0!==t.Wn&&(this.cn.autoScale=t.Wn),void 0!==t.ar&&(this.cn.mode=t.ar,2!==t.ar&&3!==t.ar||(this.cn.autoScale=!0),this.ba.ga=!1),1===i.ar&&t.ar!==i.ar&&(!function(t,i){if(null===t)return!1;const n=Li(t.ah(),i),s=Li(t.oh(),i);return isFinite(n)&&isFinite(s)}(this.mh,this.Da)?this.cn.autoScale=!0:(n=Ii(this.mh,this.Da),null!==n&&this.ja(n))),1===t.ar&&t.ar!==i.ar&&(n=zi(this.mh,this.Da),null!==n&&this.ja(n));const s=i.ar!==this.cn.mode;s&&(2===i.ar||this.ih())&&this.Vl(),s&&(3===i.ar||this.Fa())&&this.Vl(),void 0!==t.Wa&&i.Wa!==t.Wa&&(this.cn.invertScale=t.Wa,this.$a()),this.ya.m(i,this.ar())}Ha(){return this.ya}T(){return this.Ba.fontSize}It(){return this.pa}Ua(t){this.pa!==t&&(this.pa=t,this.Na(),this.Ta=null)}qa(){if(this.va)return this.va;const t=this.It()-this.Ya()-this.Xa();return this.va=t,t}gh(){return this.Za(),this.mh}ja(t,i){const n=this.mh;(i||null===n&&null!==t||null!==n&&!n.hh(t))&&(this.Ta=null,this.mh=t)}Wi(){return this.Za(),0===this.pa||!this.mh||this.mh.Wi()}Ka(t){return this.Wa()?t:this.It()-1-t}Bt(t,i){return this.ih()?t=Di(t,i):this.Fa()&&(t=Bi(t,i)),this.za(t,i)}Hs(t,i,n){this.Za();const s=this.Xa(),e=h(this.gh()),r=e.ah(),l=e.oh(),a=this.qa()-1,o=this.Wa(),_=a/(l-r),u=void 0===n?0:n.from,c=void 0===n?t.length:n.to,d=this.Ga();for(let n=u;n<c;n++){const e=t[n],h=e.dt;if(isNaN(h))continue;let l=h;null!==d&&(l=d(e.dt,i));const a=s+_*(l-r),u=o?a:this.pa-1-a;e.ht=u}}ae(t,i,n){this.Za();const s=this.Xa(),e=h(this.gh()),r=e.ah(),l=e.oh(),a=this.qa()-1,o=this.Wa(),_=a/(l-r),u=void 0===n?0:n.from,c=void 0===n?t.length:n.to,d=this.Ga();for(let n=u;n<c;n++){const e=t[n];let h=e._e,l=e.ue,a=e.ce,u=e.de;null!==d&&(h=d(e._e,i),l=d(e.ue,i),a=d(e.ce,i),u=d(e.de,i));let c=s+_*(h-r),f=o?c:this.pa-1-c;e.he=f,c=s+_*(l-r),f=o?c:this.pa-1-c,e.se=f,c=s+_*(a-r),f=o?c:this.pa-1-c,e.ee=f,c=s+_*(u-r),f=o?c:this.pa-1-c,e.le=f}}vn(t,i){const n=this.La(t,i);return this.Ja(n,i)}Ja(t,i){let n=t;return this.ih()?n=function(t,i){return i<0&&(t=-t),t/100*i+i}(n,i):this.Fa()&&(n=function(t,i){return t-=100,i<0&&(t=-t),t/100*i+i}(n,i)),n}$l(){return this.ka}Qa(){if(this.Ca)return this.Ca;let t=[];for(let i=0;i<this.ka.length;i++){const n=this.ka[i];null===n.Ki()&&n.Gi(i+1),t.push(n)}return t=Wi(t),this.Ca=t,this.Ca}io(t){-1===this.ka.indexOf(t)&&(this.ka.push(t),this.Vl(),this.no())}so(t){const i=this.ka.indexOf(t);if(-1===i)throw new Error("source is not attached to scale");this.ka.splice(i,1),0===this.ka.length&&(this.Ia({Wn:!0}),this.ja(null)),this.Vl(),this.no()}Rt(){let t=null;for(const i of this.ka){const n=i.Rt();null!==n&&((null===t||n.kl<t.kl)&&(t=n))}return null===t?null:t.At}Wa(){return this.cn.invertScale}Ql(){const t=null===this.Rt();if(null!==this.Ta&&(t||this.Ta.eo===t))return this.Ta.Ql;this.Aa._a();const i=this.Aa.Ql();return this.Ta={Ql:i,eo:t},this.xa.m(),i}ro(){return this.xa}ho(t){this.ih()||this.Fa()||null===this.Pa&&null===this.ma&&(this.Wi()||(this.Pa=this.pa-t,this.ma=h(this.gh()).lh()))}lo(t){if(this.ih()||this.Fa())return;if(null===this.Pa)return;this.Ia({Wn:!1}),(t=this.pa-t)<0&&(t=0);let i=(this.Pa+.2*(this.pa-1))/(t+.2*(this.pa-1));const n=h(this.ma).lh();i=Math.max(i,.1),n.uh(i),this.ja(n)}ao(){this.ih()||this.Fa()||(this.Pa=null,this.ma=null)}oo(t){this.Va()||null===this.Ra&&null===this.ma&&(this.Wi()||(this.Ra=t,this.ma=h(this.gh()).lh()))}_o(t){if(this.Va())return;if(null===this.Ra)return;const i=h(this.gh())._h()/(this.qa()-1);let n=t-this.Ra;this.Wa()&&(n*=-1);const s=n*i,e=h(this.ma).lh();e.dh(s),this.ja(e,!0),this.Ta=null}uo(){this.Va()||null!==this.Ra&&(this.Ra=null,this.ma=null)}Bl(){return this.El||this.Vl(),this.El}ji(t,i){switch(this.cn.mode){case 2:return this.co(Di(t,i));case 3:return this.Bl().format(Bi(t,i));default:return this.xh(t)}}da(t){switch(this.cn.mode){case 2:return this.co(t);case 3:return this.Bl().format(t);default:return this.xh(t)}}ul(t){return this.xh(t,h(this.do()).Bl())}cl(t,i){return t=Di(t,i),this.co(t,$i)}fo(){return this.ka}po(t){this.ba={wa:t,ga:!1}}On(){this.ka.forEach((t=>t.On()))}Vl(){this.Ta=null;const t=this.do();let i=100;null!==t&&(i=Math.round(1/t.Ol())),this.El=Hi,this.ih()?(this.El=$i,i=100):this.Fa()?(this.El=new st(100,1),i=100):null!==t&&(this.El=t.Bl()),this.Aa=new Fi(this,i,this.La.bind(this),this.za.bind(this)),this.Aa._a()}no(){this.Ca=null}do(){return this.ka[0]||null}Ya(){return this.Wa()?this.cn.scaleMargins.bottom*this.It()+this.Sa:this.cn.scaleMargins.top*this.It()+this.Ma}Xa(){return this.Wa()?this.cn.scaleMargins.top*this.It()+this.Ma:this.cn.scaleMargins.bottom*this.It()+this.Sa}Za(){this.ba.ga||(this.ba.ga=!0,this.vo())}Na(){this.va=null}za(t,i){if(this.Za(),this.Wi())return 0;t=this.fa()&&t?Ai(t,this.Da):t;const n=h(this.gh()),s=this.Xa()+(this.qa()-1)*(t-n.ah())/n._h();return this.Ka(s)}La(t,i){if(this.Za(),this.Wi())return 0;const n=this.Ka(t),s=h(this.gh()),e=s.ah()+s._h()*((n-this.Xa())/(this.qa()-1));return this.fa()?Li(e,this.Da):e}$a(){this.Ta=null,this.Aa._a()}vo(){const t=this.ba.wa;if(null===t)return;let i=null;const n=this.fo();let s=0,e=0;for(const r of n){if(!r.Pt())continue;const n=r.Rt();if(null===n)continue;const l=r.Rl(t.Ss(),t.fi());let a=l&&l.gh();if(null!==a){switch(this.cn.mode){case 1:a=zi(a,this.Da);break;case 2:a=Oi(a,n.At);break;case 3:a=Ei(a,n.At)}if(i=null===i?a:i.ts(h(a)),null!==l){const t=l.wh();null!==t&&(s=Math.max(s,t.above),e=Math.max(s,t.below))}}}if(s===this.Ma&&e===this.Sa||(this.Ma=s,this.Sa=e,this.Ta=null,this.Na()),null!==i){if(i.ah()===i.oh()){const t=this.do(),n=5*(null===t||this.ih()||this.Fa()?1:t.Ol());this.fa()&&(i=Ii(i,this.Da)),i=new ci(i.ah()-n,i.oh()+n),this.fa()&&(i=zi(i,this.Da))}if(this.fa()){const t=Ii(i,this.Da),n=Ni(t);if(r=n,l=this.Da,r.ta!==l.ta||r.ia!==l.ia){const s=null!==this.ma?Ii(this.ma,this.Da):null;this.Da=n,i=zi(t,n),null!==s&&(this.ma=zi(s,n))}}this.ja(i)}else null===this.mh&&(this.ja(new ci(-.5,.5)),this.Da=Ni(null));var r,l;this.ba.ga=!0}Ga(){return this.ih()?Di:this.Fa()?Bi:this.fa()?t=>Ai(t,this.Da):null}mo(t,i,n){return void 0===i?(void 0===n&&(n=this.Bl()),n.format(t)):i(t)}xh(t,i){return this.mo(t,this.Ea.priceFormatter,i)}co(t,i){return this.mo(t,this.Ea.percentageFormatter,i)}}class qi{constructor(t,i){this.ka=[],this.bo=new Map,this.pa=0,this.q=0,this.wo=1e3,this.Ca=null,this.Mo=new m,this.So=t,this.Ui=i,this.xo=new Pi(this);const n=i.W();this.yo=this.ko("left",n.leftPriceScale),this.Co=this.ko("right",n.rightPriceScale),this.yo.Ha().l(this.To.bind(this,this.yo),this),this.Co.Ha().l(this.To.bind(this,this.Co),this),this.Po(n)}Po(t){if(t.leftPriceScale&&this.yo.Ch(t.leftPriceScale),t.rightPriceScale&&this.Co.Ch(t.rightPriceScale),t.localization&&(this.yo.Vl(),this.Co.Vl()),t.overlayPriceScales){const i=Array.from(this.bo.values());for(const n of i){const i=h(n[0].Et());i.Ch(t.overlayPriceScales),t.localization&&i.Vl()}}}Ro(t){switch(t){case"left":return this.yo;case"right":return this.Co}return this.bo.has(t)?r(this.bo.get(t))[0].Et():null}M(){this.Yt().Do().v(this),this.yo.Ha().v(this),this.Co.Ha().v(this),this.ka.forEach((t=>{t.M&&t.M()})),this.Mo.m()}Oo(){return this.wo}Bo(t){this.wo=t}Yt(){return this.Ui}V(){return this.q}It(){return this.pa}Eo(t){this.q=t,this.Ao()}Ua(t){this.pa=t,this.yo.Ua(t),this.Co.Ua(t),this.ka.forEach((i=>{if(this.Je(i)){const n=i.Et();null!==n&&n.Ua(t)}})),this.Ao()}$l(){return this.ka}Je(t){const i=t.Et();return null===i||this.yo!==i&&this.Co!==i}io(t,i,n){const s=void 0!==n?n:this.zo().Lo+1;this.Io(t,i,s)}so(t){const i=this.ka.indexOf(t);e(-1!==i,"removeDataSource: invalid data source"),this.ka.splice(i,1);const n=h(t.Et()).Nl();if(this.bo.has(n)){const i=r(this.bo.get(n)),s=i.indexOf(t);-1!==s&&(i.splice(s,1),0===i.length&&this.bo.delete(n))}const s=t.Et();s&&s.$l().indexOf(t)>=0&&s.so(t),null!==s&&(s.no(),this.No(s)),this.Ca=null}tr(t){return t===this.yo?"left":t===this.Co?"right":"overlay"}Vo(){return this.yo}Fo(){return this.Co}Wo(t,i){t.ho(i)}jo(t,i){t.lo(i),this.Ao()}$o(t){t.ao()}Ho(t,i){t.oo(i)}Uo(t,i){t._o(i),this.Ao()}qo(t){t.uo()}Ao(){this.ka.forEach((t=>{t.On()}))}pn(){let t=null;return this.Ui.W().rightPriceScale.visible&&0!==this.Co.$l().length?t=this.Co:this.Ui.W().leftPriceScale.visible&&0!==this.yo.$l().length?t=this.yo:0!==this.ka.length&&(t=this.ka[0].Et()),null===t&&(t=this.Co),t}Qe(){let t=null;return this.Ui.W().rightPriceScale.visible?t=this.Co:this.Ui.W().leftPriceScale.visible&&(t=this.yo),t}No(t){null!==t&&t.Va()&&this.Yo(t)}Xo(t){const i=this.So.Vs();t.Ia({Wn:!0}),null!==i&&t.po(i),this.Ao()}Zo(){this.Yo(this.yo),this.Yo(this.Co)}Ko(){this.No(this.yo),this.No(this.Co),this.ka.forEach((t=>{this.Je(t)&&this.No(t.Et())})),this.Ao(),this.Ui.Th()}Qa(){return null===this.Ca&&(this.Ca=Wi(this.ka)),this.Ca}Go(){return this.Mo}Jo(){return this.xo}Yo(t){const i=t.fo();if(i&&i.length>0&&!this.So.Wi()){const i=this.So.Vs();null!==i&&t.po(i)}t.On()}zo(){const t=this.Qa();if(0===t.length)return{Qo:0,Lo:0};let i=0,n=0;for(let s=0;s<t.length;s++){const e=t[s].Ki();null!==e&&(e<i&&(i=e),e>n&&(n=e))}return{Qo:i,Lo:n}}Io(t,i,n){let s=this.Ro(i);if(null===s&&(s=this.ko(i,this.Ui.W().overlayPriceScales)),this.ka.push(t),!Q(i)){const n=this.bo.get(i)||[];n.push(t),this.bo.set(i,n)}s.io(t),t.Ji(s),t.Gi(n),this.No(s),this.Ca=null}To(t,i,n){i.ar!==n.ar&&this.Yo(t)}ko(t,i){const n=Object.assign({visible:!0,autoScale:!0},x(i)),s=new Ui(t,n,this.Ui.W().layout,this.Ui.W().localization);return s.Ua(this.It()),s}}const Yi=t=>t.getUTCFullYear();function Xi(t,i,n){return i.replace(/yyyy/g,(t=>nt(Yi(t),4))(t)).replace(/yy/g,(t=>nt(Yi(t)%100,2))(t)).replace(/MMMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"long"}))(t,n)).replace(/MMM/g,((t,i)=>new Date(t.getUTCFullYear(),t.getUTCMonth(),1).toLocaleString(i,{month:"short"}))(t,n)).replace(/MM/g,(t=>nt((t=>t.getUTCMonth()+1)(t),2))(t)).replace(/dd/g,(t=>nt((t=>t.getUTCDate())(t),2))(t))}class Zi{constructor(t="yyyy-MM-dd",i="default"){this.t_=t,this.i_=i}n_(t){return Xi(t,this.t_,this.i_)}}class Ki{constructor(t){this.s_=t||"%h:%m:%s"}n_(t){return this.s_.replace("%h",nt(t.getUTCHours(),2)).replace("%m",nt(t.getUTCMinutes(),2)).replace("%s",nt(t.getUTCSeconds(),2))}}const Gi={e_:"yyyy-MM-dd",r_:"%h:%m:%s",h_:" ",l_:"default"};class Ji{constructor(t={}){const i=Object.assign(Object.assign({},Gi),t);this.a_=new Zi(i.e_,i.l_),this.o_=new Ki(i.r_),this.__=i.h_}n_(t){return`${this.a_.n_(t)}${this.__}${this.o_.n_(t)}`}}class Qi{constructor(t,i=50){this.Le=0,this.ze=1,this.Ie=1,this.Ve=new Map,this.Ne=new Map,this.u_=t,this.Fe=i}n_(t){const i=t.ct,n=void 0===i.c_?new Date(1e3*i.d_).getTime():new Date(Date.UTC(i.c_.year,i.c_.month-1,i.c_.day)).getTime(),s=this.Ve.get(n);if(void 0!==s)return s.f_;if(this.Le===this.Fe){const t=this.Ne.get(this.Ie);this.Ne.delete(this.Ie),this.Ve.delete(r(t)),this.Ie++,this.Le--}const e=this.u_(t);return this.Ve.set(n,{f_:e,He:this.ze}),this.Ne.set(this.ze,n),this.Le++,this.ze++,e}}class tn{constructor(t,i){e(t<=i,"right should be >= left"),this.p_=t,this.v_=i}Ss(){return this.p_}fi(){return this.v_}m_(){return this.v_-this.p_+1}zr(t){return this.p_<=t&&t<=this.v_}hh(t){return this.p_===t.Ss()&&this.v_===t.fi()}}function nn(t,i){return null===t||null===i?t===i:t.hh(i)}class sn{constructor(){this.b_=new Map,this.Ve=null}g_(t,i){this.w_(i),this.Ve=null;for(let n=i;n<t.length;++n){const i=t[n];let s=this.b_.get(i.M_);void 0===s&&(s=[],this.b_.set(i.M_,s)),s.push({Xs:n,ct:i.ct,S_:i.M_,x_:i.x_})}}y_(t,i){const n=Math.ceil(i/t);return null!==this.Ve&&this.Ve.k_===n||(this.Ve={Ql:this.C_(n),k_:n}),this.Ve.Ql}w_(t){if(0===t)return void this.b_.clear();const i=[];this.b_.forEach(((n,s)=>{t<=n[0].Xs?i.push(s):n.splice(mt(n,t,(i=>i.Xs<t)),1/0)}));for(const t of i)this.b_.delete(t)}C_(t){let i=[];for(const n of Array.from(this.b_.keys()).sort(((t,i)=>i-t))){if(!this.b_.get(n))continue;const s=i;i=[];const e=s.length;let h=0;const l=r(this.b_.get(n)),a=l.length;let o=1/0,_=-1/0;for(let n=0;n<a;n++){const r=l[n],a=r.Xs;for(;h<e;){const t=s[h],n=t.Xs;if(!(n<a)){o=n;break}h++,i.push(t),_=n,o=1/0}o-a>=t&&a-_>=t&&(i.push(r),_=a)}for(;h<e;h++)i.push(s[h])}return i}}class en{constructor(t){this.T_=t}P_(){return null===this.T_?null:new tn(Math.floor(this.T_.Ss()),Math.ceil(this.T_.fi()))}R_(){return this.T_}static D_(){return new en(null)}}var rn,hn,ln,an,on;!function(t){t[t.Year=0]="Year",t[t.Month=1]="Month",t[t.DayOfMonth=2]="DayOfMonth",t[t.Time=3]="Time",t[t.TimeWithSeconds=4]="TimeWithSeconds"}(rn||(rn={}));class _n{constructor(t,i,n){this.q=0,this.O_=null,this.B_=[],this.Ra=null,this.Pa=null,this.E_=new sn,this.A_=new Map,this.L_=en.D_(),this.z_=!0,this.I_=new m,this.N_=new m,this.V_=new m,this.F_=null,this.W_=null,this.j_=[],this.cn=i,this.Ea=n,this.H_=i.rightOffset,this.U_=i.barSpacing,this.Ui=t,this.q_()}W(){return this.cn}Y_(t){b(this.Ea,t),this.X_(),this.q_()}Ch(t,i){var n;b(this.cn,t),this.cn.fixLeftEdge&&this.Z_(),this.cn.fixRightEdge&&this.K_(),void 0!==t.barSpacing&&this.Ui.Gn(t.barSpacing),void 0!==t.rightOffset&&this.Ui.Jn(t.rightOffset),void 0!==t.minBarSpacing&&this.Ui.Gn(null!==(n=t.barSpacing)&&void 0!==n?n:this.U_),this.X_(),this.q_(),this.V_.m()}mn(t){var i,n;return null!==(n=null===(i=this.B_[t])||void 0===i?void 0:i.ct)&&void 0!==n?n:null}qi(t){var i;return null!==(i=this.B_[t])&&void 0!==i?i:null}Wl(t,i){if(this.B_.length<1)return null;if(t.d_>this.B_[this.B_.length-1].ct.d_)return i?this.B_.length-1:null;const n=mt(this.B_,t.d_,((t,i)=>t.ct.d_<i));return t.d_<this.B_[n].ct.d_?i?n:null:n}Wi(){return 0===this.q||0===this.B_.length||null===this.O_}Fl(){return this.B_.length>0}Vs(){return this.G_(),this.L_.P_()}J_(){return this.G_(),this.L_.R_()}Q_(){const t=this.Vs();if(null===t)return null;const i={from:t.Ss(),to:t.fi()};return this.tu(i)}tu(t){const i=Math.round(t.from),n=Math.round(t.to),s=h(this.iu()),e=h(this.nu());return{from:h(this.mn(Math.max(s,i))),to:h(this.mn(Math.min(e,n)))}}su(t){return{from:h(this.Wl(t.from,!0)),to:h(this.Wl(t.to,!0))}}V(){return this.q}Eo(t){if(!isFinite(t)||t<=0)return;if(this.q===t)return;const i=this.J_(),n=this.q;if(this.q=t,this.z_=!0,this.cn.lockVisibleTimeRangeOnResize&&0!==n){const i=this.U_*t/n;this.U_=i}if(this.cn.fixLeftEdge&&null!==i&&i.Ss()<=0){const i=n-t;this.H_-=Math.round(i/this.U_)+1,this.z_=!0}this.eu(),this.ru()}Nt(t){if(this.Wi()||!w(t))return 0;const i=this.hu()+this.H_-t;return this.q-(i+.5)*this.U_-1}$s(t,i){const n=this.hu(),s=void 0===i?0:i.from,e=void 0===i?t.length:i.to;for(let i=s;i<e;i++){const s=t[i].ct,e=n+this.H_-s,r=this.q-(e+.5)*this.U_-1;t[i].rt=r}}lu(t){return Math.ceil(this.au(t))}Jn(t){this.z_=!0,this.H_=t,this.ru(),this.Ui.ou(),this.Ui.Th()}Gs(){return this.U_}Gn(t){this._u(t),this.ru(),this.Ui.ou(),this.Ui.Th()}uu(){return this.H_}Ql(){if(this.Wi())return null;if(null!==this.W_)return this.W_;const t=this.U_,i=5*(this.Ui.W().layout.fontSize+4),n=Math.round(i/t),s=h(this.Vs()),e=Math.max(s.Ss(),s.Ss()-n),r=Math.max(s.fi(),s.fi()-n),l=this.E_.y_(t,i),a=this.iu()+n,o=this.nu()-n,_=this.cu(),u=this.cn.fixLeftEdge||_,c=this.cn.fixRightEdge||_;let d=0;for(const t of l){if(!(e<=t.Xs&&t.Xs<=r))continue;let n;d<this.j_.length?(n=this.j_[d],n.Xl=this.Nt(t.Xs),n.ca=this.du(t),n.S_=t.S_):(n={fu:!1,Xl:this.Nt(t.Xs),ca:this.du(t),S_:t.S_},this.j_.push(n)),this.U_>i/2&&!_?n.fu=!1:n.fu=u&&t.Xs<=a||c&&t.Xs>=o,d++}return this.j_.length=d,this.W_=this.j_,this.j_}pu(){this.z_=!0,this.Gn(this.cn.barSpacing),this.Jn(this.cn.rightOffset)}vu(t){this.z_=!0,this.O_=t,this.ru(),this.Z_()}mu(t,i){const n=this.au(t),s=this.Gs(),e=s+i*(s/10);this.Gn(e),this.cn.rightBarStaysOnScroll||this.Jn(this.uu()+(n-this.au(t)))}ho(t){this.Ra&&this.uo(),null===this.Pa&&null===this.F_&&(this.Wi()||(this.Pa=t,this.bu()))}lo(t){if(null===this.F_)return;const i=Pt(this.q-t,0,this.q),n=Pt(this.q-h(this.Pa),0,this.q);0!==i&&0!==n&&this.Gn(this.F_.Gs*i/n)}ao(){null!==this.Pa&&(this.Pa=null,this.gu())}oo(t){null===this.Ra&&null===this.F_&&(this.Wi()||(this.Ra=t,this.bu()))}_o(t){if(null===this.Ra)return;const i=(this.Ra-t)/this.Gs();this.H_=h(this.F_).uu+i,this.z_=!0,this.ru()}uo(){null!==this.Ra&&(this.Ra=null,this.gu())}wu(){this.Mu(this.cn.rightOffset)}Mu(t,i=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(i)||i<=0)throw new RangeError("animationDuration (optional) must be finite positive number");const n=this.H_,s=performance.now();this.Ui.Xn({Su:t=>(t-s)/i>=1,xu:e=>{const r=(e-s)/i;return r>=1?t:n+(t-n)*r}})}Mt(t,i){this.z_=!0,this.B_=t,this.E_.g_(t,i),this.ru()}yu(){return this.I_}ku(){return this.N_}Cu(){return this.V_}hu(){return this.O_||0}Tu(t){const i=t.m_();this._u(this.q/i),this.H_=t.fi()-this.hu(),this.ru(),this.z_=!0,this.Ui.ou(),this.Ui.Th()}Pu(){const t=this.iu(),i=this.nu();null!==t&&null!==i&&this.Tu(new tn(t,i+this.cn.rightOffset))}Ru(t){const i=new tn(t.from,t.to);this.Tu(i)}Yi(t){return void 0!==this.Ea.timeFormatter?this.Ea.timeFormatter(t.x_):this.Du.n_(new Date(1e3*t.ct.d_))}cu(){const{handleScroll:t,handleScale:i}=this.Ui.W();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||i.axisDoubleClickReset.time||i.axisPressedMouseMove.time||i.mouseWheel||i.pinch)}iu(){return 0===this.B_.length?null:0}nu(){return 0===this.B_.length?null:this.B_.length-1}Ou(t){return(this.q-1-t)/this.U_}au(t){const i=this.Ou(t),n=this.hu()+this.H_-i;return Math.round(1e6*n)/1e6}_u(t){const i=this.U_;this.U_=t,this.eu(),i!==this.U_&&(this.z_=!0,this.Bu())}G_(){if(!this.z_)return;if(this.z_=!1,this.Wi())return void this.Eu(en.D_());const t=this.hu(),i=this.q/this.U_,n=this.H_+t,s=new tn(n-i+1,n);this.Eu(new en(s))}eu(){const t=this.Au();if(this.U_<t&&(this.U_=t,this.z_=!0),0!==this.q){const t=.5*this.q;this.U_>t&&(this.U_=t,this.z_=!0)}}Au(){return this.cn.fixLeftEdge&&this.cn.fixRightEdge&&0!==this.B_.length?this.q/this.B_.length:this.cn.minBarSpacing}ru(){const t=this.Lu();this.H_>t&&(this.H_=t,this.z_=!0);const i=this.zu();null!==i&&this.H_<i&&(this.H_=i,this.z_=!0)}zu(){const t=this.iu(),i=this.O_;if(null===t||null===i)return null;return t-i-1+(this.cn.fixLeftEdge?this.q/this.U_:Math.min(2,this.B_.length))}Lu(){return this.cn.fixRightEdge?0:this.q/this.U_-Math.min(2,this.B_.length)}bu(){this.F_={Gs:this.Gs(),uu:this.uu()}}gu(){this.F_=null}du(t){let i=this.A_.get(t.S_);return void 0===i&&(i=new Qi((t=>this.Iu(t))),this.A_.set(t.S_,i)),i.n_(t)}Iu(t){const i=function(t,i,n){switch(t){case 0:case 10:return i?n?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return i?3:2;case 50:return 2;case 60:return 1;case 70:return 0}}(t.S_,this.cn.timeVisible,this.cn.secondsVisible);if(void 0!==this.cn.tickMarkFormatter){const n=this.cn.tickMarkFormatter(t.x_,i,this.Ea.locale);if(null!==n)return n}return function(t,i,n){const s={};switch(i){case 0:s.year="numeric";break;case 1:s.month="short";break;case 2:s.day="numeric";break;case 3:s.hour12=!1,s.hour="2-digit",s.minute="2-digit";break;case 4:s.hour12=!1,s.hour="2-digit",s.minute="2-digit",s.second="2-digit"}const e=void 0===t.c_?new Date(1e3*t.d_):new Date(Date.UTC(t.c_.year,t.c_.month-1,t.c_.day));return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()).toLocaleString(n,s)}(t.ct,i,this.Ea.locale)}Eu(t){const i=this.L_;this.L_=t,nn(i.P_(),this.L_.P_())||this.I_.m(),nn(i.R_(),this.L_.R_())||this.N_.m(),this.Bu()}Bu(){this.W_=null}X_(){this.Bu(),this.A_.clear()}q_(){const t=this.Ea.dateFormat;this.cn.timeVisible?this.Du=new Ji({e_:t,r_:this.cn.secondsVisible?"%h:%m:%s":"%h:%m",h_:"   ",l_:this.Ea.locale}):this.Du=new Zi(t,this.Ea.locale)}Z_(){if(!this.cn.fixLeftEdge)return;const t=this.iu();if(null===t)return;const i=this.Vs();if(null===i)return;const n=i.Ss()-t;if(n<0){const t=this.H_-n-1;this.Jn(t)}this.eu()}K_(){this.ru(),this.eu()}}class un extends D{constructor(t){super(),this.Nu=new Map,this.Vt=t}G(t){}tt(t){if(!this.Vt.Pt)return;const{context:i,mediaSize:n}=t;let s=0;for(const t of this.Vt.Vu){if(0===t.Qt.length)continue;i.font=t.P;const e=this.Fu(i,t.Qt);e>n.width?t.mu=n.width/e:t.mu=1,s+=t.Wu*t.mu}let e=0;switch(this.Vt.ju){case"top":e=0;break;case"center":e=Math.max((n.height-s)/2,0);break;case"bottom":e=Math.max(n.height-s,0)}i.fillStyle=this.Vt.D;for(const t of this.Vt.Vu){i.save();let s=0;switch(this.Vt.$u){case"left":i.textAlign="left",s=t.Wu/2;break;case"center":i.textAlign="center",s=n.width/2;break;case"right":i.textAlign="right",s=n.width-1-t.Wu/2}i.translate(s,e),i.textBaseline="top",i.font=t.P,i.scale(t.mu,t.mu),i.fillText(t.Qt,0,t.Hu),i.restore(),e+=t.Wu*t.mu}}Fu(t,i){const n=this.Uu(t.font);let s=n.get(i);return void 0===s&&(s=t.measureText(i).width,n.set(i,s)),s}Uu(t){let i=this.Nu.get(t);return void 0===i&&(i=new Map,this.Nu.set(t,i)),i}}class cn{constructor(t){this.gt=!0,this.$t={Pt:!1,D:"",Vu:[],ju:"center",$u:"center"},this.Ht=new un(this.$t),this.Ut=t}Mt(){this.gt=!0}xt(){return this.gt&&(this.yt(),this.gt=!1),this.Ht}yt(){const t=this.Ut.W(),i=this.$t;i.Pt=t.visible,i.Pt&&(i.D=t.color,i.$u=t.horzAlign,i.ju=t.vertAlign,i.Vu=[{Qt:t.text,P:T(t.fontSize,t.fontFamily,t.fontStyle),Wu:1.2*t.fontSize,Hu:0,mu:0}])}}class dn extends K{constructor(t,i){super(),this.cn=i,this.gn=new cn(this)}Rn(){return[]}Pn(){return[this.gn]}W(){return this.cn}On(){this.gn.Mt()}}!function(t){t[t.OnTouchEnd=0]="OnTouchEnd",t[t.OnNextTap=1]="OnNextTap"}(hn||(hn={}));class fn{constructor(t,i){this.qu=[],this.Yu=[],this.q=0,this.Xu=null,this.Zu=new m,this.Ku=new m,this.Gu=null,this.Ju=t,this.cn=i,this.Qu=new P(this),this.So=new _n(this,i.timeScale,this.cn.localization),this.wt=new J(this,i.crosshair),this.tc=new ki(i.crosshair),this.ic=new dn(this,i.watermark),this.nc(),this.qu[0].Bo(2e3),this.sc=this.ec(0),this.rc=this.ec(1)}fl(){this.hc(tt.es())}Th(){this.hc(tt.ss())}Tl(){this.hc(new tt(1))}pl(t){const i=this.lc(t);this.hc(i)}ac(){return this.Xu}oc(t){const i=this.Xu;this.Xu=t,null!==i&&this.pl(i._c),null!==t&&this.pl(t._c)}W(){return this.cn}Ch(t){b(this.cn,t),this.qu.forEach((i=>i.Po(t))),void 0!==t.timeScale&&this.So.Ch(t.timeScale),void 0!==t.localization&&this.So.Y_(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Zu.m(),this.sc=this.ec(0),this.rc=this.ec(1),this.fl()}uc(t,i){if("left"===t)return void this.Ch({leftPriceScale:i});if("right"===t)return void this.Ch({rightPriceScale:i});const n=this.cc(t);null!==n&&(n.Et.Ch(i),this.Zu.m())}cc(t){for(const i of this.qu){const n=i.Ro(t);if(null!==n)return{qt:i,Et:n}}return null}Ct(){return this.So}dc(){return this.qu}fc(){return this.ic}vc(){return this.wt}mc(){return this.Ku}bc(t,i){t.Ua(i),this.ou()}Eo(t){this.q=t,this.So.Eo(this.q),this.qu.forEach((i=>i.Eo(t))),this.ou()}nc(t){const i=new qi(this.So,this);void 0!==t?this.qu.splice(t,0,i):this.qu.push(i);const n=void 0===t?this.qu.length-1:t,s=tt.es();return s.Vn(n,{Fn:0,Wn:!0}),this.hc(s),i}Wo(t,i,n){t.Wo(i,n)}jo(t,i,n){t.jo(i,n),this.vl(),this.hc(this.gc(t,2))}$o(t,i){t.$o(i),this.hc(this.gc(t,2))}Ho(t,i,n){i.Va()||t.Ho(i,n)}Uo(t,i,n){i.Va()||(t.Uo(i,n),this.vl(),this.hc(this.gc(t,2)))}qo(t,i){i.Va()||(t.qo(i),this.hc(this.gc(t,2)))}Xo(t,i){t.Xo(i),this.hc(this.gc(t,2))}wc(t){this.So.ho(t)}Mc(t,i){const n=this.Ct();if(n.Wi()||0===i)return;const s=n.V();t=Math.max(1,Math.min(t,s)),n.mu(t,i),this.ou()}Sc(t){this.xc(0),this.yc(t),this.kc()}Cc(t){this.So.lo(t),this.ou()}Tc(){this.So.ao(),this.Th()}xc(t){this.So.oo(t)}yc(t){this.So._o(t),this.ou()}kc(){this.So.uo(),this.Th()}St(){return this.Yu}Pc(t,i,n,s){this.wt.wn(t,i);let e=NaN,r=this.So.lu(t);const h=this.So.Vs();null!==h&&(r=Math.min(Math.max(h.Ss(),r),h.fi()));const l=s.pn(),a=l.Rt();null!==a&&(e=l.vn(i,a)),e=this.tc.jl(e,r,s),this.wt.yn(r,e,s),this.Tl(),this.Ku.m(this.wt.kt(),{x:t,y:i},n)}Rc(t,i,n,s){this.wt.wn(t,i);let e=NaN,r=this.So.lu(t);const h=this.So.Vs();null!==h&&(r=Math.min(Math.max(h.Ss(),r),h.fi()));const l=s.pn(),a=l.Rt();null!==a&&(e=l.vn(i,a)),e=this.tc.jl(e,r,s),this.wt.yn(r,e,s),this.Tl(),n&&this.Ku.m(this.wt.kt(),{x:t,y:i},null)}Dc(){this.vc().Cn(),this.Tl(),this.Ku.m(null,null,null)}vl(){const t=this.wt.qt();if(null!==t){const i=this.wt.Sn(),n=this.wt.xn();this.Pc(i,n,null,t)}this.wt.On()}Oc(t,i,n){const s=this.So.mn(0);void 0!==i&&void 0!==n&&this.So.Mt(i,n);const e=this.So.mn(0),r=this.So.hu(),h=this.So.Vs();if(null!==h&&null!==s&&null!==e){const i=h.zr(r),n=s.d_>e.d_,l=null!==t&&t>r&&!n,a=i&&this.So.W().shiftVisibleRangeOnNewBar;if(l&&!a){const i=t-r;this.So.Jn(this.So.uu()-i)}}this.So.vu(t)}gl(t){null!==t&&t.Ko()}Ge(t){const i=this.qu.find((i=>i.Qa().includes(t)));return void 0===i?null:i}ou(){this.ic.On(),this.qu.forEach((t=>t.Ko())),this.vl()}M(){this.qu.forEach((t=>t.M())),this.qu.length=0,this.cn.localization.priceFormatter=void 0,this.cn.localization.percentageFormatter=void 0,this.cn.localization.timeFormatter=void 0}Bc(){return this.Qu}ir(){return this.Qu.W()}Do(){return this.Zu}Ec(t,i){const n=this.qu[0],s=this.Ac(i,t,n);return this.Yu.push(s),1===this.Yu.length?this.fl():this.Th(),s}Lc(t){const i=this.Ge(t),n=this.Yu.indexOf(t);e(-1!==n,"Series not found"),this.Yu.splice(n,1),h(i).so(t),t.M&&t.M()}dl(t,i){const n=h(this.Ge(t));n.so(t);const s=this.cc(i);if(null===s){const s=t.Ki();n.io(t,i,s)}else{const e=s.qt===n?t.Ki():void 0;s.qt.io(t,i,e)}}Pu(){const t=tt.ss();t.Hn(),this.hc(t)}zc(t){const i=tt.ss();i.Yn(t),this.hc(i)}Kn(){const t=tt.ss();t.Kn(),this.hc(t)}Gn(t){const i=tt.ss();i.Gn(t),this.hc(i)}Jn(t){const i=tt.ss();i.Jn(t),this.hc(i)}Xn(t){const i=tt.ss();i.Xn(t),this.hc(i)}Un(){const t=tt.ss();t.Un(),this.hc(t)}Ic(){return this.cn.rightPriceScale.visible?"right":"left"}Nc(){return this.rc}Y(){return this.sc}zt(t){const i=this.rc,n=this.sc;if(i===n)return i;if(t=Math.max(0,Math.min(100,Math.round(100*t))),null===this.Gu||this.Gu.gs!==n||this.Gu.ws!==i)this.Gu={gs:n,ws:i,Vc:new Map};else{const i=this.Gu.Vc.get(t);if(void 0!==i)return i}const s=function(t,i,n){const[s,e,r,h]=p(t),[l,a,u,c]=p(i),d=[o(s+n*(l-s)),o(e+n*(a-e)),o(r+n*(u-r)),_(h+n*(c-h))];return`rgba(${d[0]}, ${d[1]}, ${d[2]}, ${d[3]})`}(n,i,t/100);return this.Gu.Vc.set(t,s),s}gc(t,i){const n=new tt(i);if(null!==t){const s=this.qu.indexOf(t);n.Vn(s,{Fn:i})}return n}lc(t,i){return void 0===i&&(i=2),this.gc(this.Ge(t),i)}hc(t){this.Ju&&this.Ju(t),this.qu.forEach((t=>t.Jo().Ph().Mt()))}Ac(t,i,n){const s=new yi(this,t,i),e=void 0!==t.priceScaleId?t.priceScaleId:this.Ic();return n.io(s,e),Q(e)||s.Ch(t),s}ec(t){const i=this.cn.layout;return"gradient"===i.background.type?0===t?i.background.topColor:i.background.bottomColor:i.background.color}}function pn(t){return!g(t)&&!M(t)}function vn(t){return g(t)}function mn(t){var i=t.width,n=t.height;if(i<0)throw new Error("Negative width is not allowed for Size");if(n<0)throw new Error("Negative height is not allowed for Size");return{width:i,height:n}}function bn(t,i){return t.width===i.width&&t.height===i.height}!function(t){t[t.Disabled=0]="Disabled",t[t.Continuous=1]="Continuous",t[t.OnDataUpdate=2]="OnDataUpdate"}(ln||(ln={})),function(t){t[t.LastBar=0]="LastBar",t[t.LastVisible=1]="LastVisible"}(an||(an={})),function(t){t.Solid="solid",t.VerticalGradient="gradient"}(on||(on={}));var gn=function(){function t(t){var i=this;this._resolutionListener=function(){return i._onResolutionChanged()},this._resolutionMediaQueryList=null,this._observers=[],this._window=t,this._installResolutionListener()}return t.prototype.dispose=function(){this._uninstallResolutionListener(),this._window=null},Object.defineProperty(t.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),t.prototype.subscribe=function(t){var i=this,n={next:t};return this._observers.push(n),{unsubscribe:function(){i._observers=i._observers.filter((function(t){return t!==n}))}}},t.prototype._installResolutionListener=function(){if(null!==this._resolutionMediaQueryList)throw new Error("Resolution listener is already installed");var t=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(t,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},t.prototype._uninstallResolutionListener=function(){null!==this._resolutionMediaQueryList&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},t.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},t.prototype._onResolutionChanged=function(){var t=this;this._observers.forEach((function(i){return i.next(t._window.devicePixelRatio)})),this._reinstallResolutionListener()},t}();var wn=function(){function t(t,i,n){var s;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=t,this._canvasElementClientSize=mn({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=null!=i?i:function(t){return t},this._allowResizeObserver=null===(s=null==n?void 0:n.allowResizeObserver)||void 0===s||s,this._chooseAndInitObserver()}return t.prototype.dispose=function(){var t,i;if(null===this._canvasElement)throw new Error("Object is disposed");null===(t=this._canvasElementResizeObserver)||void 0===t||t.disconnect(),this._canvasElementResizeObserver=null,null===(i=this._devicePixelRatioObservable)||void 0===i||i.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(t.prototype,"canvasElement",{get:function(){if(null===this._canvasElement)throw new Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bitmapSize",{get:function(){return mn({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),t.prototype.resizeCanvasElement=function(t){this._canvasElementClientSize=mn(t),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},t.prototype.subscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners.push(t)},t.prototype.unsubscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners=this._bitmapSizeChangedListeners.filter((function(i){return i!==t}))},Object.defineProperty(t.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),t.prototype.subscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners.push(t)},t.prototype.unsubscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter((function(i){return i!==t}))},t.prototype.applySuggestedBitmapSize=function(){if(null!==this._suggestedBitmapSize){var t=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(t),this._emitSuggestedBitmapSizeChanged(t,this._suggestedBitmapSize)}},t.prototype._resizeBitmap=function(t){var i=this.bitmapSize;bn(i,t)||(this.canvasElement.width=t.width,this.canvasElement.height=t.height,this._emitBitmapSizeChanged(i,t))},t.prototype._emitBitmapSizeChanged=function(t,i){var n=this;this._bitmapSizeChangedListeners.forEach((function(s){return s.call(n,t,i)}))},t.prototype._suggestNewBitmapSize=function(t){var i=this._suggestedBitmapSize,n=mn(this._transformBitmapSize(t,this._canvasElementClientSize)),s=bn(this.bitmapSize,n)?null:n;null===i&&null===s||null!==i&&null!==s&&bn(i,s)||(this._suggestedBitmapSize=s,this._emitSuggestedBitmapSizeChanged(i,s))},t.prototype._emitSuggestedBitmapSizeChanged=function(t,i){var n=this;this._suggestedBitmapSizeChangedListeners.forEach((function(s){return s.call(n,t,i)}))},t.prototype._chooseAndInitObserver=function(){var t=this;this._allowResizeObserver?new Promise((function(t){var i=new ResizeObserver((function(n){t(n.every((function(t){return"devicePixelContentBoxSize"in t}))),i.disconnect()}));i.observe(document.body,{box:"device-pixel-content-box"})})).catch((function(){return!1})).then((function(i){return i?t._initResizeObserver():t._initDevicePixelRatioObservable()})):this._initDevicePixelRatioObservable()},t.prototype._initDevicePixelRatioObservable=function(){var t=this;if(null!==this._canvasElement){var i=Mn(this._canvasElement);if(null===i)throw new Error("No window is associated with the canvas");this._devicePixelRatioObservable=function(t){return new gn(t)}(i),this._devicePixelRatioObservable.subscribe((function(){return t._invalidateBitmapSize()})),this._invalidateBitmapSize()}},t.prototype._invalidateBitmapSize=function(){var t,i;if(null!==this._canvasElement){var n=Mn(this._canvasElement);if(null!==n){var s=null!==(i=null===(t=this._devicePixelRatioObservable)||void 0===t?void 0:t.value)&&void 0!==i?i:n.devicePixelRatio,e=this._canvasElement.getClientRects(),r=void 0!==e[0]?function(t,i){return mn({width:Math.round(t.left*i+t.width*i)-Math.round(t.left*i),height:Math.round(t.top*i+t.height*i)-Math.round(t.top*i)})}(e[0],s):mn({width:this._canvasElementClientSize.width*s,height:this._canvasElementClientSize.height*s});this._suggestNewBitmapSize(r)}}},t.prototype._initResizeObserver=function(){var t=this;null!==this._canvasElement&&(this._canvasElementResizeObserver=new ResizeObserver((function(i){var n=i.find((function(i){return i.target===t._canvasElement}));if(n&&n.devicePixelContentBoxSize&&n.devicePixelContentBoxSize[0]){var s=n.devicePixelContentBoxSize[0],e=mn({width:s.inlineSize,height:s.blockSize});t._suggestNewBitmapSize(e)}})),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},t}();function Mn(t){return t.ownerDocument.defaultView}var Sn=function(){function t(t,i,n){if(0===i.width||0===i.height)throw new TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=i,0===n.width||0===n.height)throw new TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=n,this._context=t}return t.prototype.useMediaCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),t({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},t.prototype.useBitmapCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),t({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(t.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),t}();function xn(t,i){var n=t.canvasElementClientSize;if(0===n.width||0===n.height)return null;var s=t.bitmapSize;if(0===s.width||0===s.height)return null;var e=t.canvasElement.getContext("2d",i);return null===e?null:new Sn(e,n,s)}const yn="undefined"!=typeof window;function kn(){return!!yn&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function Cn(){return!!yn&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function Tn(t){return t+t%2}function Pn(t,i){return t.Fc-i.Fc}function Rn(t,i,n){const s=(t.Fc-i.Fc)/(t.ct-i.ct);return Math.sign(s)*Math.min(Math.abs(s),n)}class Dn{constructor(t,i,n,s){this.Wc=null,this.jc=null,this.$c=null,this.Hc=null,this.Uc=null,this.qc=0,this.Yc=0,this.Xc=t,this.Zc=i,this.Kc=n,this.rs=s}Gc(t,i){if(null!==this.Wc){if(this.Wc.ct===i)return void(this.Wc.Fc=t);if(Math.abs(this.Wc.Fc-t)<this.rs)return}this.Hc=this.$c,this.$c=this.jc,this.jc=this.Wc,this.Wc={ct:i,Fc:t}}vr(t,i){if(null===this.Wc||null===this.jc)return;if(i-this.Wc.ct>50)return;let n=0;const s=Rn(this.Wc,this.jc,this.Zc),e=Pn(this.Wc,this.jc),r=[s],h=[e];if(n+=e,null!==this.$c){const t=Rn(this.jc,this.$c,this.Zc);if(Math.sign(t)===Math.sign(s)){const i=Pn(this.jc,this.$c);if(r.push(t),h.push(i),n+=i,null!==this.Hc){const t=Rn(this.$c,this.Hc,this.Zc);if(Math.sign(t)===Math.sign(s)){const i=Pn(this.$c,this.Hc);r.push(t),h.push(i),n+=i}}}}let l=0;for(let t=0;t<r.length;++t)l+=h[t]/n*r[t];Math.abs(l)<this.Xc||(this.Uc={Fc:t,ct:i},this.Yc=l,this.qc=function(t,i){const n=Math.log(i);return Math.log(1*n/-t)/n}(Math.abs(l),this.Kc))}xu(t){const i=h(this.Uc),n=t-i.ct;return i.Fc+this.Yc*(Math.pow(this.Kc,n)-1)/Math.log(this.Kc)}Su(t){return null===this.Uc||this.Jc(t)===this.qc}Jc(t){const i=t-h(this.Uc).ct;return Math.min(i,this.qc)}}function On(t,i){const n=h(t.ownerDocument).createElement("canvas");t.appendChild(n);const s=function(t,i){if("device-pixel-content-box"===i.type)return new wn(t,i.transform,i.options);throw new Error("Unsupported binding target")}(n,{type:"device-pixel-content-box",options:{allowResizeObserver:!1},transform:(t,i)=>({width:Math.max(t.width,i.width),height:Math.max(t.height,i.height)})});return s.resizeCanvasElement(i),s}function Bn(t){yn&&void 0!==window.chrome&&t.addEventListener("mousedown",(t=>{if(1===t.button)return t.preventDefault(),!1}))}class En{constructor(t,i,n){this.Qc=0,this.td=null,this.nd={rt:Number.NEGATIVE_INFINITY,ht:Number.POSITIVE_INFINITY},this.sd=0,this.ed=null,this.rd={rt:Number.NEGATIVE_INFINITY,ht:Number.POSITIVE_INFINITY},this.hd=null,this.ld=!1,this.ad=null,this.od=null,this._d=!1,this.ud=!1,this.dd=!1,this.fd=null,this.pd=null,this.vd=null,this.md=null,this.bd=null,this.gd=null,this.wd=null,this.Md=0,this.Sd=!1,this.xd=!1,this.yd=!1,this.kd=0,this.Cd=null,this.Td=!Cn(),this.Pd=t=>{this.Rd(t)},this.Dd=t=>{if(this.Od(t)){const i=this.Bd(t);if(++this.sd,this.ed&&this.sd>1){const{Ed:n}=this.Ad(zn(t),this.rd);n<30&&!this.dd&&this.Ld(i,this.Id.zd),this.Nd()}}else{const i=this.Bd(t);if(++this.Qc,this.td&&this.Qc>1){const{Ed:n}=this.Ad(zn(t),this.nd);n<5&&!this.ud&&this.Vd(i,this.Id.Fd),this.Wd()}}},this.jd=t,this.Id=i,this.cn=n,this.$d()}M(){null!==this.fd&&(this.fd(),this.fd=null),null!==this.pd&&(this.pd(),this.pd=null),null!==this.md&&(this.md(),this.md=null),null!==this.bd&&(this.bd(),this.bd=null),null!==this.gd&&(this.gd(),this.gd=null),null!==this.vd&&(this.vd(),this.vd=null),this.Hd(),this.Wd()}Ud(t){this.md&&this.md();const i=this.qd.bind(this);if(this.md=()=>{this.jd.removeEventListener("mousemove",i)},this.jd.addEventListener("mousemove",i),this.Od(t))return;const n=this.Bd(t);this.Vd(n,this.Id.Yd),this.Td=!0}Wd(){null!==this.td&&clearTimeout(this.td),this.Qc=0,this.td=null,this.nd={rt:Number.NEGATIVE_INFINITY,ht:Number.POSITIVE_INFINITY}}Nd(){null!==this.ed&&clearTimeout(this.ed),this.sd=0,this.ed=null,this.rd={rt:Number.NEGATIVE_INFINITY,ht:Number.POSITIVE_INFINITY}}qd(t){if(this.yd||null!==this.od)return;if(this.Od(t))return;const i=this.Bd(t);this.Vd(i,this.Id.Xd),this.Td=!0}Zd(t){const i=Nn(t.changedTouches,h(this.Cd));if(null===i)return;if(this.kd=In(t),null!==this.wd)return;if(this.xd)return;this.Sd=!0;const n=this.Ad(zn(i),h(this.od)),{Kd:s,Gd:e,Ed:r}=n;if(this._d||!(r<5)){if(!this._d){const t=.5*s,i=e>=t&&!this.cn.Jd(),n=t>e&&!this.cn.Qd();i||n||(this.xd=!0),this._d=!0,this.dd=!0,this.Hd(),this.Nd()}if(!this.xd){const n=this.Bd(t,i);this.Ld(n,this.Id.tf),Ln(t)}}}if(t){if(0!==t.button)return;const i=this.Ad(zn(t),h(this.ad)),{Ed:n}=i;if(n>=5&&(this.ud=!0,this.Wd()),this.ud){const i=this.Bd(t);this.Vd(i,this.Id.nf)}}Ad(t,i){const n=Math.abs(i.rt-t.rt),s=Math.abs(i.ht-t.ht);return{Kd:n,Gd:s,Ed:n+s}}sf(t){let i=Nn(t.changedTouches,h(this.Cd));if(null===i&&0===t.touches.length&&(i=t.changedTouches[0]),null===i)return;this.Cd=null,this.kd=In(t),this.Hd(),this.od=null,this.gd&&(this.gd(),this.gd=null);const n=this.Bd(t,i);if(this.Ld(n,this.Id.ef),++this.sd,this.ed&&this.sd>1){const{Ed:t}=this.Ad(zn(i),this.rd);t<30&&!this.dd&&this.Ld(n,this.Id.zd),this.Nd()}else this.dd||(this.Ld(n,this.Id.rf),this.Id.rf&&Ln(t));0===this.sd&&Ln(t),0===t.touches.length&&this.ld&&(this.ld=!1,Ln(t))}Rd(t){if(0!==t.button)return;const i=this.Bd(t);if(this.ad=null,this.yd=!1,this.bd&&(this.bd(),this.bd=null),kn()){this.jd.ownerDocument.documentElement.removeEventListener("mouseleave",this.Pd)}if(!this.Od(t))if(this.Vd(i,this.Id.hf),++this.Qc,this.td&&this.Qc>1){const{Ed:n}=this.Ad(zn(t),this.nd);n<5&&!this.ud&&this.Vd(i,this.Id.Fd),this.Wd()}else this.ud||this.Vd(i,this.Id.lf)}Hd(){null!==this.hd&&(clearTimeout(this.hd),this.hd=null)}af(t){if(null!==this.Cd)return;const i=t.changedTouches[0];this.Cd=i.identifier,this.kd=In(t);const n=this.jd.ownerDocument.documentElement;this.dd=!1,this._d=!1,this.xd=!1,this.od=zn(i),this.gd&&(this.gd(),this.gd=null);{const i=this.Zd.bind(this),s=this.sf.bind(this);this.gd=()=>{n.removeEventListener("touchmove",i),n.removeEventListener("touchend",s)},n.addEventListener("touchmove",i,{passive:!1}),n.addEventListener("touchend",s,{passive:!1}),this.Hd(),this.hd=setTimeout(this._f.bind(this,t),240)}const s=this.Bd(t,i);this.Ld(s,this.Id.uf),this.ed||(this.sd=0,this.ed=setTimeout(this.Nd.bind(this),500),this.rd=zn(i))}cf(t){if(0!==t.button)return;const i=this.jd.ownerDocument.documentElement;kn()&&i.addEventListener("mouseleave",this.Pd),this.ud=!1,this.ad=zn(t),this.bd&&(this.bd(),this.bd=null);{const t=this.if.bind(this),n=this.Rd.bind(this);this.bd=()=>{i.removeEventListener("mousemove",t),i.removeEventListener("mouseup",n)},i.addEventListener("mousemove",t),i.addEventListener("mouseup",n)}if(this.yd=!0,this.Od(t))return;const n=this.Bd(t);this.Vd(n,this.Id.df),this.td||(this.Qc=0,this.td=setTimeout(this.Wd.bind(this),500),this.nd=zn(t))}$d(){this.jd.addEventListener("mouseenter",this.Ud.bind(this)),this.jd.addEventListener("touchcancel",this.Hd.bind(this));{const t=this.jd.ownerDocument,i=t=>{this.Id.ff&&(t.composed&&this.jd.contains(t.composedPath()[0])||t.target&&this.jd.contains(t.target)||this.Id.ff())};this.pd=()=>{t.removeEventListener("touchstart",i)},this.fd=()=>{t.removeEventListener("mousedown",i)},t.addEventListener("mousedown",i),t.addEventListener("touchstart",i,{passive:!0})}Cn()&&(this.vd=()=>{this.jd.removeEventListener("dblclick",this.Dd)},this.jd.addEventListener("dblclick",this.Dd)),this.jd.addEventListener("mouseleave",this.pf.bind(this)),this.jd.addEventListener("touchstart",this.af.bind(this),{passive:!0}),Bn(this.jd),this.jd.addEventListener("mousedown",this.cf.bind(this)),this.vf(),this.jd.addEventListener("touchmove",(()=>{}),{passive:!1})}vf(){void 0===this.Id.mf&&void 0===this.Id.bf&&void 0===this.Id.gf||(this.jd.addEventListener("touchstart",(t=>this.wf(t.touches)),{passive:!0}),this.jd.addEventListener("touchmove",(t=>{if(2===t.touches.length&&null!==this.wd&&void 0!==this.Id.bf){const i=An(t.touches[0],t.touches[1])/this.Md;this.Id.bf(this.wd,i),Ln(t)}}),{passive:!1}),this.jd.addEventListener("touchend",(t=>{this.wf(t.touches)})))}wf(t){1===t.length&&(this.Sd=!1),2!==t.length||this.Sd||this.ld?this.Mf():this.Sf(t)}Sf(t){const i=this.jd.getBoundingClientRect()||{left:0,top:0};this.wd={rt:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,ht:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this.Md=An(t[0],t[1]),void 0!==this.Id.mf&&this.Id.mf(),this.Hd()}Mf(){null!==this.wd&&(this.wd=null,void 0!==this.Id.gf&&this.Id.gf())}pf(t){if(this.md&&this.md(),this.Od(t))return;if(!this.Td)return;const i=this.Bd(t);this.Vd(i,this.Id.xf),this.Td=!Cn()}_f(t){const i=Nn(t.touches,h(this.Cd));if(null===i)return;const n=this.Bd(t,i);this.Ld(n,this.Id.yf),this.dd=!0,this.ld=!0}Od(t){return t.sourceCapabilities&&void 0!==t.sourceCapabilities.firesTouchEvents?t.sourceCapabilities.firesTouchEvents:In(t)<this.kd+500}Ld(t,i){i&&i.call(this.Id,t)}Vd(t,i){i&&i.call(this.Id,t)}Bd(t,i){const n=i||t,s=this.jd.getBoundingClientRect()||{left:0,top:0};return{clientX:n.clientX,clientY:n.clientY,pageX:n.pageX,pageY:n.pageY,screenX:n.screenX,screenY:n.screenY,localX:n.clientX-s.left,localY:n.clientY-s.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,kf:!t.type.startsWith("mouse")&&"contextmenu"!==t.type&&"click"!==t.type,Cf:t.type,Tf:n.target,Pf:t.view,Rf:()=>{"touchstart"!==t.type&&Ln(t)}}}}function An(t,i){const n=t.clientX-i.clientX,s=t.clientY-i.clientY;return Math.sqrt(n*n+s*s)}function Ln(t){t.cancelable&&t.preventDefault()}function zn(t){return{rt:t.pageX,ht:t.pageY}}function In(t){return t.timeStamp||performance.now()}function Nn(t,i){for(let n=0;n<t.length;++n)if(t[n].identifier===i)return t[n];return null}class Vn{constructor(t,i,n,s){this.Vi=null,this.Df=null,this.Of=!1,this.Bf=new Wt(200),this.Nr=null,this.Ef=0,this.Af=!1,this.Lf=()=>{this.Af||this.nn.zf().Yt().Th()},this.If=()=>{this.Af||this.nn.zf().Yt().Th()},this.nn=t,this.cn=i,this.Ba=i.layout,this.Qu=n,this.Nf="left"===s,this.Vf=document.createElement("div"),this.Vf.style.height="100%",this.Vf.style.overflow="hidden",this.Vf.style.width="25px",this.Vf.style.left="0",this.Vf.style.position="relative",this.Ff=On(this.Vf,mn({width:16,height:16})),this.Ff.subscribeSuggestedBitmapSizeChanged(this.Lf);const e=this.Ff.canvasElement;e.style.position="absolute",e.style.zIndex="1",e.style.left="0",e.style.top="0",this.Wf=On(this.Vf,mn({width:16,height:16})),this.Wf.subscribeSuggestedBitmapSizeChanged(this.If);const r=this.Wf.canvasElement;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0";const h={df:this.jf.bind(this),uf:this.jf.bind(this),nf:this.$f.bind(this),tf:this.$f.bind(this),ff:this.Hf.bind(this),hf:this.Uf.bind(this),ef:this.Uf.bind(this),Fd:this.qf.bind(this),zd:this.qf.bind(this),Yd:this.Yf.bind(this),xf:this.Xf.bind(this)};this.Zf=new En(this.Wf.canvasElement,h,{Jd:()=>!1,Qd:()=>!0})}M(){this.Zf.M(),this.Wf.unsubscribeSuggestedBitmapSizeChanged(this.If),this.Wf.dispose(),this.Ff.unsubscribeSuggestedBitmapSizeChanged(this.Lf),this.Ff.dispose(),null!==this.Vi&&this.Vi.ro().v(this),this.Vi=null}Kf(){return this.Vf}T(){return this.Ba.fontSize}Gf(){const t=this.Qu.W();return this.Nr!==t.P&&(this.Bf.We(),this.Nr=t.P),t}Jf(){if(null===this.Vi)return 0;let t=0;const i=this.Gf(),n=h(this.Ff.canvasElement.getContext("2d"));n.save();const s=this.Vi.Ql();n.font=this.Qf(),s.length>0&&(t=Math.max(this.Bf.yi(n,s[0].ca),this.Bf.yi(n,s[s.length-1].ca)));const e=this.tp();for(let i=e.length;i--;){const s=this.Bf.yi(n,e[i].Qt());s>t&&(t=s)}t=Math.max(t,i.V),n.restore();const r=t||34;return Tn(Math.ceil(i.k+i.C+i.A+i.L+5+r))}ip(t){null!==this.Df&&bn(this.Df,t)||(this.Df=t,this.Af=!0,this.Ff.resizeCanvasElement(t),this.Wf.resizeCanvasElement(t),this.Af=!1,this.Vf.style.width=`${t.width}px`,this.Vf.style.height=`${t.height}px`)}np(){return h(this.Df).width}Ji(t){this.Vi!==t&&(null!==this.Vi&&this.Vi.ro().v(this),this.Vi=t,t.ro().l(this.xa.bind(this),this))}Et(){return this.Vi}We(){const t=this.nn.sp();this.nn.zf().Yt().Xo(t,h(this.Et()))}ep(t){if(null===this.Df)return;if(1!==t){this.rp(),this.Ff.applySuggestedBitmapSize();const t=xn(this.Ff);null!==t&&(t.useBitmapCoordinateSpace((t=>{this.hp(t),this.ke(t)})),this.lp(t),this.ap(t))}this.Wf.applySuggestedBitmapSize();const i=xn(this.Wf);null!==i&&(i.useBitmapCoordinateSpace((({context:t,bitmapSize:i})=>{t.clearRect(0,0,i.width,i.height)})),this.op(i))}_p(){return this.Ff.bitmapSize}up(t,i,n){const s=this._p();s.width>0&&s.height>0&&t.drawImage(this.Ff.canvasElement,i,n)}Mt(){var t;null===(t=this.Vi)||void 0===t||t.Ql()}jf(t){if(null===this.Vi||this.Vi.Wi()||!this.cn.handleScale.axisPressedMouseMove.price)return;const i=this.nn.zf().Yt(),n=this.nn.sp();this.Of=!0,i.Wo(n,this.Vi,t.localY)}$f(t){if(null===this.Vi||!this.cn.handleScale.axisPressedMouseMove.price)return;const i=this.nn.zf().Yt(),n=this.nn.sp(),s=this.Vi;i.jo(n,s,t.localY)}Hf(){if(null===this.Vi||!this.cn.handleScale.axisPressedMouseMove.price)return;const t=this.nn.zf().Yt(),i=this.nn.sp(),n=this.Vi;this.Of&&(this.Of=!1,t.$o(i,n))}Uf(t){if(null===this.Vi||!this.cn.handleScale.axisPressedMouseMove.price)return;const i=this.nn.zf().Yt(),n=this.nn.sp();this.Of=!1,i.$o(n,this.Vi)}qf(t){this.cn.handleScale.axisDoubleClickReset.price&&this.We()}Yf(t){if(null===this.Vi)return;!this.nn.zf().Yt().W().handleScale.axisPressedMouseMove.price||this.Vi.ih()||this.Vi.Fa()||this.cp(1)}Xf(t){this.cp(0)}tp(){const t=[],i=null===this.Vi?void 0:this.Vi;return(n=>{for(let s=0;s<n.length;++s){const e=n[s].Rn(this.nn.sp(),i);for(let i=0;i<e.length;i++)t.push(e[i])}})(this.nn.sp().Qa()),t}hp({context:t,bitmapSize:i}){const{width:n,height:s}=i,e=this.nn.sp().Yt(),r=e.Y(),h=e.Nc();r===h?V(t,0,0,n,s,r):$(t,0,0,n,s,r,h)}ke({context:t,bitmapSize:i,horizontalPixelRatio:n}){if(null===this.Df||null===this.Vi||!this.Vi.W().borderVisible)return;t.fillStyle=this.Vi.W().borderColor;const s=Math.max(1,Math.floor(this.Gf().k*n));let e;e=this.Nf?i.width-s:0,t.fillRect(e,0,s,i.height)}lp(t){if(null===this.Df||null===this.Vi)return;const i=this.Vi.Ql(),n=this.Vi.W(),s=this.Gf(),e=this.Nf?this.Df.width-s.C:0;n.borderVisible&&n.ticksVisible&&t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:r,verticalPixelRatio:h})=>{t.fillStyle=n.borderColor;const l=Math.max(1,Math.floor(h)),a=Math.floor(.5*h),o=Math.round(s.C*r);t.beginPath();for(const n of i)t.rect(Math.floor(e*r),Math.round(n.Xl*h)-a,o,l);t.fill()})),t.useMediaCoordinateSpace((({context:t})=>{var r;t.font=this.Qf(),t.fillStyle=null!==(r=n.textColor)&&void 0!==r?r:this.Ba.textColor,t.textAlign=this.Nf?"right":"left",t.textBaseline="middle";const h=this.Nf?Math.round(e-s.A):Math.round(e+s.C+s.A),l=i.map((i=>this.Bf.xi(t,i.ca)));for(let n=i.length;n--;){const s=i[n];t.fillText(s.ca,h,s.Xl+l[n])}}))}rp(){if(null===this.Df||null===this.Vi)return;let t=this.Df.height/2;const i=[],n=this.Vi.Qa().slice(),s=this.nn.sp(),e=this.Gf();this.Vi===s.Qe()&&this.nn.sp().Qa().forEach((t=>{s.Je(t)&&n.push(t)}));const r=this.Vi.$l()[0],h=this.Vi;n.forEach((n=>{const e=n.Rn(s,h);e.forEach((t=>{t.Ai(null),t.Li()&&i.push(t)})),r===n&&e.length>0&&(t=e[0].Ci())})),i.forEach((t=>t.Ai(t.Ci())));this.Vi.W().alignLabels&&this.dp(i,e,t)}dp(t,i,n){if(null===this.Df)return;const s=t.filter((t=>t.Ci()<=n)),e=t.filter((t=>t.Ci()>n));s.sort(((t,i)=>i.Ci()-t.Ci())),s.length&&e.length&&e.push(s[0]),e.sort(((t,i)=>t.Ci()-i.Ci()));for(const n of t){const t=Math.floor(n.It(i)/2),s=n.Ci();s>-t&&s<t&&n.Ai(t),s>this.Df.height-t&&s<this.Df.height+t&&n.Ai(this.Df.height-t)}for(let t=1;t<s.length;t++){const n=s[t],e=s[t-1],r=e.It(i,!1),h=n.Ci(),l=e.Ei();h>l-r&&n.Ai(l-r)}for(let t=1;t<e.length;t++){const n=e[t],s=e[t-1],r=s.It(i,!0),h=n.Ci(),l=s.Ei();h<l+r&&n.Ai(l+r)}}ap(t){if(null===this.Df)return;const i=this.tp(),n=this.Gf(),s=this.Nf?"right":"left";i.forEach((i=>{if(i.zi()){i.xt(h(this.Vi)).K(t,n,this.Bf,s)}}))}op(t){if(null===this.Df||null===this.Vi)return;const i=this.nn.zf().Yt(),n=[],s=this.nn.sp(),e=i.vc().Rn(s,this.Vi);e.length&&n.push(e);const r=this.Gf(),l=this.Nf?"right":"left";n.forEach((i=>{i.forEach((i=>{i.xt(h(this.Vi)).K(t,r,this.Bf,l)}))}))}cp(t){this.Vf.style.cursor=1===t?"ns-resize":"default"}xa(){const t=this.Jf();this.Ef<t&&this.nn.zf().Yt().fl(),this.Ef=t}Qf(){return T(this.Ba.fontSize,this.Ba.fontFamily)}}function Fn(t,i,n,s){t.J&&t.J(i,n,s)}function Wn(t,i,n,s){t.K(i,n,s)}function jn(t,i){return t.Pn(i)}function $n(t,i){return t.Qi(i)}function Hn(t,i){return void 0!==t.Cl?t.Cl(i):[]}class Un{constructor(t,i){this.Df=mn({width:0,height:0}),this.fp=null,this.pp=null,this.vp=null,this.mp=!1,this.bp=new m,this.gp=0,this.wp=!1,this.Mp=null,this.Sp=!1,this.xp=null,this.yp=null,this.Af=!1,this.Lf=()=>{this.Af||null===this.kp||this.Ui().Th()},this.If=()=>{this.Af||null===this.kp||this.Ui().Th()},this.Cp=t,this.kp=i,this.kp.Go().l(this.Tp.bind(this),this,!0),this.Pp=document.createElement("td"),this.Pp.style.padding="0",this.Pp.style.position="relative";const n=document.createElement("div");n.style.width="100%",n.style.height="100%",n.style.position="relative",n.style.overflow="hidden",this.Rp=document.createElement("td"),this.Rp.style.padding="0",this.Dp=document.createElement("td"),this.Dp.style.padding="0",this.Pp.appendChild(n),this.Ff=On(n,mn({width:16,height:16})),this.Ff.subscribeSuggestedBitmapSizeChanged(this.Lf);const s=this.Ff.canvasElement;s.style.position="absolute",s.style.zIndex="1",s.style.left="0",s.style.top="0",this.Wf=On(n,mn({width:16,height:16})),this.Wf.subscribeSuggestedBitmapSizeChanged(this.If);const e=this.Wf.canvasElement;e.style.position="absolute",e.style.zIndex="2",e.style.left="0",e.style.top="0",this.Op=document.createElement("tr"),this.Op.appendChild(this.Rp),this.Op.appendChild(this.Pp),this.Op.appendChild(this.Dp),this.Bp(),this.Zf=new En(this.Wf.canvasElement,this,{Jd:()=>null===this.Mp&&!this.Cp.W().handleScroll.vertTouchDrag,Qd:()=>null===this.Mp&&!this.Cp.W().handleScroll.horzTouchDrag})}M(){null!==this.fp&&this.fp.M(),null!==this.pp&&this.pp.M(),this.Wf.unsubscribeSuggestedBitmapSizeChanged(this.If),this.Wf.dispose(),this.Ff.unsubscribeSuggestedBitmapSizeChanged(this.Lf),this.Ff.dispose(),null!==this.kp&&this.kp.Go().v(this),this.Zf.M()}sp(){return h(this.kp)}Ep(t){null!==this.kp&&this.kp.Go().v(this),this.kp=t,null!==this.kp&&this.kp.Go().l(Un.prototype.Tp.bind(this),this,!0),this.Bp()}zf(){return this.Cp}Kf(){return this.Op}Bp(){if(null!==this.kp&&(this.Ap(),0!==this.Ui().St().length)){if(null!==this.fp){const t=this.kp.Vo();this.fp.Ji(h(t))}if(null!==this.pp){const t=this.kp.Fo();this.pp.Ji(h(t))}}}Lp(){null!==this.fp&&this.fp.Mt(),null!==this.pp&&this.pp.Mt()}Oo(){return null!==this.kp?this.kp.Oo():0}Bo(t){this.kp&&this.kp.Bo(t)}Yd(t){if(!this.kp)return;this.zp();const i=t.localX,n=t.localY;this.Ip(i,n,t)}df(t){this.zp(),this.Np(),this.Ip(t.localX,t.localY,t)}Xd(t){if(!this.kp)return;this.zp();const i=t.localX,n=t.localY;this.Ip(i,n,t);const s=this.nr(i,n);this.Ui().oc(s&&{_c:s._c,Vp:s.Vp})}lf(t){null!==this.kp&&(this.zp(),this.Fp(t))}nf(t){this.zp(),this.Wp(t),this.Ip(t.localX,t.localY,t)}hf(t){null!==this.kp&&(this.zp(),this.wp=!1,this.jp(t))}rf(t){null!==this.kp&&this.Fp(t)}yf(t){if(this.wp=!0,null===this.Mp){const i={x:t.localX,y:t.localY};this.$p(i,i,t)}}xf(t){null!==this.kp&&(this.zp(),this.kp.Yt().oc(null),this.Hp())}Up(){return this.bp}mf(){this.gp=1,this.Ui().Un()}bf(t,i){if(!this.Cp.W().handleScale.pinch)return;const n=5*(i-this.gp);this.gp=i,this.Ui().Mc(t.rt,n)}uf(t){if(this.wp=!1,this.Sp=null!==this.Mp,this.Np(),null!==this.Mp){const i=this.Ui().vc();this.xp={x:i.Kt(),y:i.Gt()},this.Mp={x:t.localX,y:t.localY}}}tf(t){if(null===this.kp)return;const i=t.localX,n=t.localY;if(null===this.Mp)this.Wp(t);else{this.Sp=!1;const s=h(this.xp),e=s.x+(i-this.Mp.x),r=s.y+(n-this.Mp.y);this.Ip(e,r,t)}}ef(t){0===this.zf().W().trackingMode.exitMode&&(this.Sp=!0),this.qp(),this.jp(t)}nr(t,i){const n=this.kp;if(null===n)return null;const s=n.Qa();for(const e of s){const s=this.Yp(e.Pn(n),t,i);if(null!==s)return{_c:e,Pf:s.Pf,Vp:s.Vp}}return null}Xp(t,i){h("left"===i?this.fp:this.pp).ip(mn({width:t,height:this.Df.height}))}Zp(){return this.Df}ip(t){bn(this.Df,t)||(this.Df=t,this.Af=!0,this.Ff.resizeCanvasElement(t),this.Wf.resizeCanvasElement(t),this.Af=!1,this.Pp.style.width=t.width+"px",this.Pp.style.height=t.height+"px")}Kp(){const t=h(this.kp);t.No(t.Vo()),t.No(t.Fo());for(const i of t.$l())if(t.Je(i)){const n=i.Et();null!==n&&t.No(n),i.On()}}_p(){return this.Ff.bitmapSize}up(t,i,n){const s=this._p();s.width>0&&s.height>0&&t.drawImage(this.Ff.canvasElement,i,n)}ep(t){if(0===t)return;if(null===this.kp)return;if(t>1&&this.Kp(),null!==this.fp&&this.fp.ep(t),null!==this.pp&&this.pp.ep(t),1!==t){this.Ff.applySuggestedBitmapSize();const t=xn(this.Ff);null!==t&&(t.useBitmapCoordinateSpace((t=>{this.hp(t)})),this.kp&&(this.Gp(t),this.Jp(t),this.Qp(t,jn),this.Qp(t,$n)))}this.Wf.applySuggestedBitmapSize();const i=xn(this.Wf);null!==i&&(i.useBitmapCoordinateSpace((({context:t,bitmapSize:i})=>{t.clearRect(0,0,i.width,i.height)})),this.Qp(i,Hn),this.tv(i))}iv(){return this.fp}nv(){return this.pp}sv(t,i,n){if(this.kp)if(n){const n=t,s=i;this.ev(n,s)}else this.kp.Yt().oc(null),this.Hp()}Tp(){null!==this.kp&&this.kp.Go().v(this),this.kp=null}Fp(t){const i=t.localX,n=t.localY;this.bp.g()&&this.bp.m(this.Ui().Ct().lu(i),{x:i,y:n},t)}hp({context:t,bitmapSize:i}){const{width:n,height:s}=i,e=this.Ui(),r=e.Y(),h=e.Nc();r===h?V(t,0,0,n,s,h):$(t,0,0,n,s,r,h)}Gp(t){const i=h(this.kp).Jo().Ph().xt();null!==i&&i.K(t,!1)}Jp(t){const i=this.Ui().fc();this.rv(t,jn,Fn,i),this.rv(t,jn,Wn,i)}tv(t){this.rv(t,jn,Wn,this.Ui().vc())}Qp(t,i){const n=h(this.kp).Qa();for(const s of n)this.rv(t,i,Fn,s);for(const s of n)this.rv(t,i,Wn,s)}rv(t,i,n,s){const e=h(this.kp),r=i(s,e),l=e.Yt().ac(),a=null!==l&&l._c===s,o=null!==l&&a&&void 0!==l.Vp?l.Vp.er:void 0;for(const i of r){const s=i.xt();null!==s&&n(s,t,a,o)}}Yp(t,i,n){for(const s of t){const t=s.xt();if(null!==t&&t.nr){const e=t.nr(i,n);if(null!==e)return{Pf:s,Vp:e}}}return null}Ap(){if(null===this.kp)return;const t=this.Cp,i=this.kp.Vo().W().visible,n=this.kp.Fo().W().visible;i||null===this.fp||(this.Rp.removeChild(this.fp.Kf()),this.fp.M(),this.fp=null),n||null===this.pp||(this.Dp.removeChild(this.pp.Kf()),this.pp.M(),this.pp=null);const s=t.Yt().Bc();i&&null===this.fp&&(this.fp=new Vn(this,t.W(),s,"left"),this.Rp.appendChild(this.fp.Kf())),n&&null===this.pp&&(this.pp=new Vn(this,t.W(),s,"right"),this.Dp.appendChild(this.pp.Kf()))}hv(t){return t.kf&&this.wp||null!==this.Mp}lv(t){return Math.max(0,Math.min(t,this.Df.width-1))}av(t){return Math.max(0,Math.min(t,this.Df.height-1))}Ip(t,i,n){this.Ui().Pc(this.lv(t),this.av(i),n,h(this.kp))}ev(t,i){this.Ui().Rc(this.lv(t),this.av(i),!1,h(this.kp))}Hp(){this.Ui().Dc()}qp(){this.Sp&&(this.Mp=null,this.Hp())}$p(t,i,n){this.Mp=t,this.Sp=!1,this.Ip(i.x,i.y,n);const s=this.Ui().vc();this.xp={x:s.Kt(),y:s.Gt()}}Ui(){return this.Cp.Yt()}jp(t){if(!this.mp)return;const i=this.Ui(),n=this.sp();if(i.qo(n,n.pn()),this.vp=null,this.mp=!1,i.kc(),null!==this.yp){const t=performance.now(),n=i.Ct();this.yp.vr(n.uu(),t),this.yp.Su(t)||i.Xn(this.yp)}}zp(){this.Mp=null}Np(){if(!this.kp)return;if(this.Ui().Un(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)h(document.activeElement).blur();else{const t=document.getSelection();null!==t&&t.removeAllRanges()}!this.kp.pn().Wi()&&this.Ui().Ct().Wi()}Wp(t){if(null===this.kp)return;const i=this.Ui(),n=i.Ct();if(n.Wi())return;const s=this.Cp.W(),e=s.handleScroll,r=s.kineticScroll;if((!e.pressedMouseMove||t.kf)&&(!e.horzTouchDrag&&!e.vertTouchDrag||!t.kf))return;const h=this.kp.pn(),l=performance.now();if(null!==this.vp||this.hv(t)||(this.vp={x:t.clientX,y:t.clientY,d_:l,ov:t.localX,_v:t.localY}),null!==this.vp&&!this.mp&&(this.vp.x!==t.clientX||this.vp.y!==t.clientY)){if(t.kf&&r.touch||!t.kf&&r.mouse){const t=n.Gs();this.yp=new Dn(.2/t,7/t,.997,15/t),this.yp.Gc(n.uu(),this.vp.d_)}else this.yp=null;h.Wi()||i.Ho(this.kp,h,t.localY),i.xc(t.localX),this.mp=!0}this.mp&&(h.Wi()||i.Uo(this.kp,h,t.localY),i.yc(t.localX),null!==this.yp&&this.yp.Gc(n.uu(),l))}}class qn{constructor(t,i,n,s,e){this.gt=!0,this.Df=mn({width:0,height:0}),this.Lf=()=>this.ep(3),this.Nf="left"===t,this.Qu=n.Bc,this.cn=i,this.uv=s,this.cv=e,this.Vf=document.createElement("div"),this.Vf.style.width="25px",this.Vf.style.height="100%",this.Vf.style.overflow="hidden",this.Ff=On(this.Vf,mn({width:16,height:16})),this.Ff.subscribeSuggestedBitmapSizeChanged(this.Lf)}M(){this.Ff.unsubscribeSuggestedBitmapSizeChanged(this.Lf),this.Ff.dispose()}Kf(){return this.Vf}Zp(){return this.Df}ip(t){bn(this.Df,t)||(this.Df=t,this.Ff.resizeCanvasElement(t),this.Vf.style.width=`${t.width}px`,this.Vf.style.height=`${t.height}px`,this.gt=!0)}ep(t){if(t<3&&!this.gt)return;if(0===this.Df.width||0===this.Df.height)return;this.gt=!1,this.Ff.applySuggestedBitmapSize();const i=xn(this.Ff);null!==i&&i.useBitmapCoordinateSpace((t=>{this.hp(t),this.ke(t)}))}_p(){return this.Ff.bitmapSize}up(t,i,n){const s=this._p();s.width>0&&s.height>0&&t.drawImage(this.Ff.canvasElement,i,n)}ke({context:t,bitmapSize:i,horizontalPixelRatio:n,verticalPixelRatio:s}){if(!this.uv())return;t.fillStyle=this.cn.timeScale.borderColor;const e=Math.floor(this.Qu.W().k*n),r=Math.floor(this.Qu.W().k*s),h=this.Nf?i.width-e:0;t.fillRect(h,0,e,r)}hp({context:t,bitmapSize:i}){V(t,0,0,i.width,i.height,this.cv())}}function Yn(t,i){return t.S_>i.S_?t:i}class Xn{constructor(t){this.dv=null,this.fv=null,this.S=null,this.pv=!1,this.Df=mn({width:0,height:0}),this.vv=new m,this.Bf=new Wt(5),this.Af=!1,this.Lf=()=>{this.Af||this.Cp.Yt().Th()},this.If=()=>{this.Af||this.Cp.Yt().Th()},this.Cp=t,this.cn=t.W().layout,this.mv=document.createElement("tr"),this.bv=document.createElement("td"),this.bv.style.padding="0",this.gv=document.createElement("td"),this.gv.style.padding="0",this.Vf=document.createElement("td"),this.Vf.style.height="25px",this.Vf.style.padding="0",this.wv=document.createElement("div"),this.wv.style.width="100%",this.wv.style.height="100%",this.wv.style.position="relative",this.wv.style.overflow="hidden",this.Vf.appendChild(this.wv),this.Ff=On(this.wv,mn({width:16,height:16})),this.Ff.subscribeSuggestedBitmapSizeChanged(this.Lf);const i=this.Ff.canvasElement;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this.Wf=On(this.wv,mn({width:16,height:16})),this.Wf.subscribeSuggestedBitmapSizeChanged(this.If);const n=this.Wf.canvasElement;n.style.position="absolute",n.style.zIndex="2",n.style.left="0",n.style.top="0",this.mv.appendChild(this.bv),this.mv.appendChild(this.Vf),this.mv.appendChild(this.gv),this.Mv(),this.Cp.Yt().Do().l(this.Mv.bind(this),this),this.Zf=new En(this.Wf.canvasElement,this,{Jd:()=>!0,Qd:()=>!1})}M(){this.Zf.M(),null!==this.dv&&this.dv.M(),null!==this.fv&&this.fv.M(),this.Wf.unsubscribeSuggestedBitmapSizeChanged(this.If),this.Wf.dispose(),this.Ff.unsubscribeSuggestedBitmapSizeChanged(this.Lf),this.Ff.dispose()}Kf(){return this.mv}Sv(){return this.dv}xv(){return this.fv}df(t){if(this.pv)return;this.pv=!0;const i=this.Cp.Yt();!i.Ct().Wi()&&this.Cp.W().handleScale.axisPressedMouseMove.time&&i.wc(t.localX)}uf(t){this.df(t)}ff(){const t=this.Cp.Yt();!t.Ct().Wi()&&this.pv&&(this.pv=!1,this.Cp.W().handleScale.axisPressedMouseMove.time&&t.Tc())}nf(t){const i=this.Cp.Yt();!i.Ct().Wi()&&this.Cp.W().handleScale.axisPressedMouseMove.time&&i.Cc(t.localX)}tf(t){this.nf(t)}hf(){this.pv=!1;const t=this.Cp.Yt();t.Ct().Wi()&&!this.Cp.W().handleScale.axisPressedMouseMove.time||t.Tc()}ef(){this.hf()}Fd(){this.Cp.W().handleScale.axisDoubleClickReset.time&&this.Cp.Yt().Kn()}zd(){this.Fd()}Yd(){this.Cp.Yt().W().handleScale.axisPressedMouseMove.time&&this.cp(1)}xf(){this.cp(0)}Zp(){return this.Df}yv(){return this.vv}kv(t,i,n){bn(this.Df,t)||(this.Df=t,this.Af=!0,this.Ff.resizeCanvasElement(t),this.Wf.resizeCanvasElement(t),this.Af=!1,this.Vf.style.width=`${t.width}px`,this.Vf.style.height=`${t.height}px`,this.vv.m(t)),null!==this.dv&&this.dv.ip(mn({width:i,height:t.height})),null!==this.fv&&this.fv.ip(mn({width:n,height:t.height}))}Cv(){const t=this.Tv();return Math.ceil(t.k+t.C+t.T+t.I+t.B+t.Pv)}Mt(){this.Cp.Yt().Ct().Ql()}_p(){return this.Ff.bitmapSize}up(t,i,n){const s=this._p();s.width>0&&s.height>0&&t.drawImage(this.Ff.canvasElement,i,n)}ep(t){if(0===t)return;if(1!==t){this.Ff.applySuggestedBitmapSize();const i=xn(this.Ff);null!==i&&(i.useBitmapCoordinateSpace((t=>{this.hp(t),this.ke(t)})),this.lp(i)),null!==this.dv&&this.dv.ep(t),null!==this.fv&&this.fv.ep(t)}this.Wf.applySuggestedBitmapSize();const i=xn(this.Wf);null!==i&&(i.useBitmapCoordinateSpace((({context:t,bitmapSize:i})=>{t.clearRect(0,0,i.width,i.height)})),this.Rv([this.Cp.Yt().vc()],i))}hp({context:t,bitmapSize:i}){V(t,0,0,i.width,i.height,this.Cp.Yt().Nc())}ke({context:t,bitmapSize:i,verticalPixelRatio:n}){if(this.Cp.W().timeScale.borderVisible){t.fillStyle=this.Dv();const s=Math.max(1,Math.floor(this.Tv().k*n));t.fillRect(0,0,i.width,s)}}lp(t){const i=this.Cp.Yt().Ct(),n=i.Ql();if(!n||0===n.length)return;let s=n.reduce(Yn,n[0]).S_;s>30&&s<50&&(s=30);const e=this.Tv(),r=i.W();r.borderVisible&&r.ticksVisible&&t.useBitmapCoordinateSpace((({context:t,horizontalPixelRatio:i,verticalPixelRatio:s})=>{t.strokeStyle=this.Dv(),t.fillStyle=this.Dv();const r=Math.max(1,Math.floor(i)),h=Math.floor(.5*i);t.beginPath();const l=Math.round(e.C*s);for(let s=n.length;s--;){const e=Math.round(n[s].Xl*i);t.rect(e-h,0,r,l)}t.fill()})),t.useMediaCoordinateSpace((({context:t})=>{const i=e.k+e.C+e.I+e.T/2;t.textAlign="center",t.textBaseline="middle",t.fillStyle=this.H(),t.font=this.Qf();for(const e of n)if(e.S_<s){const n=e.fu?this.Ov(t,e.Xl,e.ca):e.Xl;t.fillText(e.ca,n,i)}t.font=this.Bv();for(const e of n)if(e.S_>=s){const n=e.fu?this.Ov(t,e.Xl,e.ca):e.Xl;t.fillText(e.ca,n,i)}}))}Ov(t,i,n){const s=this.Bf.yi(t,n),e=s/2,r=Math.floor(i-e)+.5;return r<0?i+=Math.abs(0-r):r+s>this.Df.width&&(i-=Math.abs(this.Df.width-(r+s))),i}Rv(t,i){const n=this.Tv();for(const s of t)for(const t of s.tn())t.xt().K(i,n)}Dv(){return this.Cp.W().timeScale.borderColor}H(){return this.cn.textColor}j(){return this.cn.fontSize}Qf(){return T(this.j(),this.cn.fontFamily)}Bv(){return T(this.j(),this.cn.fontFamily,"bold")}Tv(){null===this.S&&(this.S={k:1,N:NaN,I:NaN,B:NaN,Hi:NaN,C:5,T:NaN,P:"",$i:new Wt,Pv:0});const t=this.S,i=this.Qf();if(t.P!==i){const n=this.j();t.T=n,t.P=i,t.I=3*n/12,t.B=3*n/12,t.Hi=9*n/12,t.N=0,t.Pv=4*n/12,t.$i.We()}return this.S}cp(t){this.Vf.style.cursor=1===t?"ew-resize":"default"}Mv(){const t=this.Cp.Yt(),i=t.W();i.leftPriceScale.visible||null===this.dv||(this.bv.removeChild(this.dv.Kf()),this.dv.M(),this.dv=null),i.rightPriceScale.visible||null===this.fv||(this.gv.removeChild(this.fv.Kf()),this.fv.M(),this.fv=null);const n={Bc:this.Cp.Yt().Bc()},s=()=>i.leftPriceScale.borderVisible&&t.Ct().W().borderVisible,e=()=>t.Nc();i.leftPriceScale.visible&&null===this.dv&&(this.dv=new qn("left",i,n,s,e),this.bv.appendChild(this.dv.Kf())),i.rightPriceScale.visible&&null===this.fv&&(this.fv=new qn("right",i,n,s,e),this.gv.appendChild(this.fv.Kf()))}}const Zn=!!yn&&!!navigator.userAgentData&&navigator.userAgentData.brands.some((t=>t.brand.includes("Chromium")))&&!!yn&&((null===(Kn=null===navigator||void 0===navigator?void 0:navigator.userAgentData)||void 0===Kn?void 0:Kn.platform)?"Windows"===navigator.userAgentData.platform:navigator.userAgent.toLowerCase().indexOf("win")>=0);var Kn;class Gn{constructor(t,i){var n;this.Ev=[],this.Av=0,this.pa=0,this.q=0,this.Lv=0,this.zv=0,this.Iv=null,this.Nv=!1,this.bp=new m,this.Ku=new m,this.Vv=null,this.Fv=t,this.cn=i,this.mv=document.createElement("div"),this.mv.classList.add("tv-lightweight-charts"),this.mv.style.overflow="hidden",this.mv.style.direction="ltr",this.mv.style.width="100%",this.mv.style.height="100%",(n=this.mv).style.userSelect="none",n.style.webkitUserSelect="none",n.style.msUserSelect="none",n.style.MozUserSelect="none",n.style.webkitTapHighlightColor="transparent",this.Wv=document.createElement("table"),this.Wv.setAttribute("cellspacing","0"),this.mv.appendChild(this.Wv),this.jv=this.$v.bind(this),Jn(this.cn)&&this.Hv(!0),this.Ui=new fn(this.Ju.bind(this),this.cn),this.Yt().mc().l(this.Uv.bind(this),this),this.qv=new Xn(this),this.Wv.appendChild(this.qv.Kf());const s=i.autoSize&&this.Yv();let e=this.cn.width,r=this.cn.height;if(s||0===e||0===r){const i=t.getBoundingClientRect();e=e||i.width,r=r||i.height}this.Xv(e,r),this.Zv(),t.appendChild(this.mv),this.Kv(),this.Ui.Ct().Cu().l(this.Ui.fl.bind(this.Ui),this),this.Ui.Do().l(this.Ui.fl.bind(this.Ui),this)}Yt(){return this.Ui}W(){return this.cn}Gv(){return this.Ev}Jv(){return this.qv}M(){this.Hv(!1),0!==this.Av&&window.cancelAnimationFrame(this.Av),this.Ui.mc().v(this),this.Ui.Ct().Cu().v(this),this.Ui.Do().v(this),this.Ui.M();for(const t of this.Ev)this.Wv.removeChild(t.Kf()),t.Up().v(this),t.M();this.Ev=[],h(this.qv).M(),null!==this.mv.parentElement&&this.mv.parentElement.removeChild(this.mv),this.Ku.M(),this.bp.M(),this.Qv()}Xv(t,i,n=!1){if(this.pa===i&&this.q===t)return;const s=function(t){const i=Math.floor(t.width),n=Math.floor(t.height);return mn({width:i-i%2,height:n-n%2})}(mn({width:t,height:i}));this.pa=s.height,this.q=s.width;const e=this.pa+"px",r=this.q+"px";h(this.mv).style.height=e,h(this.mv).style.width=r,this.Wv.style.height=e,this.Wv.style.width=r,n?this.tm(tt.es(),performance.now()):this.Ui.fl()}ep(t){void 0===t&&(t=tt.es());for(let i=0;i<this.Ev.length;i++)this.Ev[i].ep(t.$n(i).Fn);this.cn.timeScale.visible&&this.qv.ep(t.jn())}Ch(t){const i=Jn(this.cn);this.Ui.Ch(t);const n=Jn(this.cn);n!==i&&this.Hv(n),this.Kv(),this.im(t)}Up(){return this.bp}mc(){return this.Ku}nm(){null!==this.Iv&&(this.tm(this.Iv,performance.now()),this.Iv=null);const t=this.sm(null),i=document.createElement("canvas");i.width=t.width,i.height=t.height;const n=h(i.getContext("2d"));return this.sm(n),i}rm(t){if("left"===t&&!this.hm())return 0;if("right"===t&&!this.lm())return 0;if(0===this.Ev.length)return 0;return h("left"===t?this.Ev[0].iv():this.Ev[0].nv()).np()}am(){return this.cn.autoSize&&null!==this.Vv}om(t,i,n){return this._m(t,i,n)}im(t){(void 0!==t.autoSize||!this.Vv||void 0===t.width&&void 0===t.height)&&(t.autoSize&&!this.Vv&&this.Yv(),!1===t.autoSize&&null!==this.Vv&&this.Qv(),t.autoSize||void 0===t.width&&void 0===t.height||this.Xv(t.width||this.q,t.height||this.pa))}sm(t){let i=0,n=0;const s=this.Ev[0],e=(i,n)=>{let s=0;for(let e=0;e<this.Ev.length;e++){const r=this.Ev[e],l=h("left"===i?r.iv():r.nv()),a=l._p();null!==t&&l.up(t,n,s),s+=a.height}};if(this.hm()){e("left",0);i+=h(s.iv())._p().width}for(let s=0;s<this.Ev.length;s++){const e=this.Ev[s],r=e._p();null!==t&&e.up(t,i,n),n+=r.height}if(i+=s._p().width,this.lm()){e("right",i);i+=h(s.nv())._p().width}const r=(i,n,s)=>{h("left"===i?this.qv.Sv():this.qv.xv()).up(h(t),n,s)};if(this.cn.timeScale.visible){const i=this.qv._p();if(null!==t){let e=0;this.hm()&&(r("left",e,n),e=h(s.iv())._p().width),this.qv.up(t,e,n),e+=i.width,this.lm()&&r("right",e,n)}n+=i.height}return mn({width:i,height:n})}um(){let t=0,i=0,n=0;for(const s of this.Ev)this.hm()&&(i=Math.max(i,h(s.iv()).Jf())),this.lm()&&(n=Math.max(n,h(s.nv()).Jf())),t+=s.Oo();i=Tn(i),n=Tn(n);const s=this.q,e=this.pa,r=Math.max(s-i-n,0),l=this.cn.timeScale.visible;let a=l?this.qv.Cv():0;var o;a=(o=a)+o%2;const _=0+a,u=e<_?0:e-_,c=u/t;let d=0;for(let t=0;t<this.Ev.length;++t){const s=this.Ev[t];s.Ep(this.Ui.dc()[t]);let e=0,h=0;h=t===this.Ev.length-1?u-d:Math.round(s.Oo()*c),e=Math.max(h,2),d+=e,s.ip(mn({width:r,height:e})),this.hm()&&s.Xp(i,"left"),this.lm()&&s.Xp(n,"right"),s.sp()&&this.Ui.bc(s.sp(),e)}this.qv.kv(mn({width:l?r:0,height:a}),l?i:0,l?n:0),this.Ui.Eo(r),this.Lv!==i&&(this.Lv=i),this.zv!==n&&(this.zv=n)}Hv(t){t?this.mv.addEventListener("wheel",this.jv,{passive:!1}):this.mv.removeEventListener("wheel",this.jv)}dm(t){switch(t.deltaMode){case t.DOM_DELTA_PAGE:return 120;case t.DOM_DELTA_LINE:return 32}return Zn?1/window.devicePixelRatio:1}$v(t){if(!(0!==t.deltaX&&this.cn.handleScroll.mouseWheel||0!==t.deltaY&&this.cn.handleScale.mouseWheel))return;const i=this.dm(t),n=i*t.deltaX/100,s=-i*t.deltaY/100;if(t.cancelable&&t.preventDefault(),0!==s&&this.cn.handleScale.mouseWheel){const i=Math.sign(s)*Math.min(1,Math.abs(s)),n=t.clientX-this.mv.getBoundingClientRect().left;this.Yt().Mc(n,i)}0!==n&&this.cn.handleScroll.mouseWheel&&this.Yt().Sc(-80*n)}tm(t,i){var n;const s=t.jn();3===s&&this.fm(),3!==s&&2!==s||(this.pm(t),this.vm(t,i),this.qv.Mt(),this.Ev.forEach((t=>{t.Lp()})),3===(null===(n=this.Iv)||void 0===n?void 0:n.jn())&&(this.Iv.ts(t),this.fm(),this.pm(this.Iv),this.vm(this.Iv,i),t=this.Iv,this.Iv=null)),this.ep(t)}vm(t,i){for(const n of t.Qn())this.ns(n,i)}pm(t){const i=this.Ui.dc();for(let n=0;n<i.length;n++)t.$n(n).Wn&&i[n].Zo()}ns(t,i){const n=this.Ui.Ct();switch(t.qn){case 0:n.Pu();break;case 1:n.Ru(t.At);break;case 2:n.Gn(t.At);break;case 3:n.Jn(t.At);break;case 4:n.pu();break;case 5:t.At.Su(i)||n.Jn(t.At.xu(i))}}Ju(t){null!==this.Iv?this.Iv.ts(t):this.Iv=t,this.Nv||(this.Nv=!0,this.Av=window.requestAnimationFrame((t=>{if(this.Nv=!1,this.Av=0,null!==this.Iv){const i=this.Iv;this.Iv=null,this.tm(i,t);for(const n of i.Qn())if(5===n.qn&&!n.At.Su(t)){this.Yt().Xn(n.At);break}}})))}fm(){this.Zv()}Zv(){const t=this.Ui.dc(),i=t.length,n=this.Ev.length;for(let t=i;t<n;t++){const t=r(this.Ev.pop());this.Wv.removeChild(t.Kf()),t.Up().v(this),t.M()}for(let s=n;s<i;s++){const i=new Un(this,t[s]);i.Up().l(this.bm.bind(this),this),this.Ev.push(i),this.Wv.insertBefore(i.Kf(),this.qv.Kf())}for(let n=0;n<i;n++){const i=t[n],s=this.Ev[n];s.sp()!==i?s.Ep(i):s.Bp()}this.Kv(),this.um()}_m(t,i,n){var s;const e=new Map;if(null!==t){this.Ui.St().forEach((i=>{const n=i.Ln().$h(t);null!==n&&e.set(i,n)}))}let r;if(null!==t){const i=null===(s=this.Ui.Ct().qi(t))||void 0===s?void 0:s.x_;void 0!==i&&(r=i)}const h=this.Yt().ac(),l=null!==h&&h._c instanceof yi?h._c:void 0,a=null!==h&&void 0!==h.Vp?h.Vp.sr:void 0;return{ct:r,Xs:null!=t?t:void 0,gm:null!=i?i:void 0,wm:l,Mm:e,Sm:a,xm:null!=n?n:void 0}}bm(t,i,n){this.bp.m((()=>this._m(t,i,n)))}Uv(t,i,n){this.Ku.m((()=>this._m(t,i,n)))}Kv(){const t=this.cn.timeScale.visible?"":"none";this.qv.Kf().style.display=t}hm(){return this.Ev[0].sp().Vo().W().visible}lm(){return this.Ev[0].sp().Fo().W().visible}Yv(){return"ResizeObserver"in window&&(this.Vv=new ResizeObserver((t=>{const i=t.find((t=>t.target===this.Fv));i&&this.Xv(i.contentRect.width,i.contentRect.height)})),this.Vv.observe(this.Fv,{box:"border-box"}),!0)}Qv(){null!==this.Vv&&this.Vv.disconnect()}}function Jn(t){return Boolean(t.handleScroll.mouseWheel||t.handleScale.mouseWheel)}function Qn(t,i,n,s){const e=n.value,r={Xs:i,ct:t,At:[e,e,e,e],x_:s};return void 0!==n.color&&(r.D=n.color),r}function ts(t){return void 0!==t.At}function is(t){return(i,n,s,e)=>{return void 0===(r=s).open&&void 0===r.value?{ct:i,Xs:n,x_:e}:t(i,n,s,e);var r}}const ns={Candlestick:is((function(t,i,n,s){const e={Xs:i,ct:t,At:[n.open,n.high,n.low,n.close],x_:s};return void 0!==n.color&&(e.D=n.color),void 0!==n.borderColor&&(e.Lt=n.borderColor),void 0!==n.wickColor&&(e.Oh=n.wickColor),e})),Bar:is((function(t,i,n,s){const e={Xs:i,ct:t,At:[n.open,n.high,n.low,n.close],x_:s};return void 0!==n.color&&(e.D=n.color),e})),Area:is((function(t,i,n,s){const e=n.value,r={Xs:i,ct:t,At:[e,e,e,e],x_:s};return void 0!==n.lineColor&&(r.ut=n.lineColor),void 0!==n.topColor&&(r.gs=n.topColor),void 0!==n.bottomColor&&(r.ws=n.bottomColor),r})),Baseline:is((function(t,i,n,s){const e=n.value,r={Xs:i,ct:t,At:[e,e,e,e],x_:s};return void 0!==n.topLineColor&&(r.ge=n.topLineColor),void 0!==n.bottomLineColor&&(r.we=n.bottomLineColor),void 0!==n.topFillColor1&&(r.fe=n.topFillColor1),void 0!==n.topFillColor2&&(r.pe=n.topFillColor2),void 0!==n.bottomFillColor1&&(r.ve=n.bottomFillColor1),void 0!==n.bottomFillColor2&&(r.me=n.bottomFillColor2),r})),Histogram:is(Qn),Line:is(Qn)};function ss(t){return ns[t]}function es(t){return 60*t*60*1e3}function rs(t){return 60*t*1e3}const hs=[{ym:(ls=1,1e3*ls),S_:10},{ym:rs(1),S_:20},{ym:rs(5),S_:21},{ym:rs(30),S_:22},{ym:es(1),S_:30},{ym:es(3),S_:31},{ym:es(6),S_:32},{ym:es(12),S_:33}];var ls;function as(t,i){if(t.getUTCFullYear()!==i.getUTCFullYear())return 70;if(t.getUTCMonth()!==i.getUTCMonth())return 60;if(t.getUTCDate()!==i.getUTCDate())return 50;for(let n=hs.length-1;n>=0;--n)if(Math.floor(i.getTime()/hs[n].ym)!==Math.floor(t.getTime()/hs[n].ym))return hs[n].S_;return 0}function os(t,i=0){if(0===t.length)return;let n=0===i?null:t[i-1].ct.d_,s=null!==n?new Date(1e3*n):null,e=0;for(let r=i;r<t.length;++r){const i=t[r],h=new Date(1e3*i.ct.d_);null!==s&&(i.M_=as(h,s)),e+=i.ct.d_-(n||i.ct.d_),n=i.ct.d_,s=h}if(0===i&&t.length>1){const i=Math.ceil(e/(t.length-1)),n=new Date(1e3*(t[0].ct.d_-i));t[0].M_=as(new Date(1e3*t[0].ct.d_),n)}}function _s(t){if(!pn(t))throw new Error("time must be of type BusinessDay");const i=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{d_:Math.round(i.getTime()/1e3),c_:t}}function us(t){if(!vn(t))throw new Error("time must be of type isUTCTimestamp");return{d_:t}}function cs(t){return 0===t.length?null:pn(t[0].time)?_s:us}function ds(t){return vn(t)?us(t):pn(t)?_s(t):_s(fs(t))}function fs(t){const i=new Date(t);if(isNaN(i.getTime()))throw new Error(`Invalid date string=${t}, expected format=yyyy-mm-dd`);return{day:i.getUTCDate(),month:i.getUTCMonth()+1,year:i.getUTCFullYear()}}function ps(t){M(t.time)&&(t.time=fs(t.time))}function vs(t){return{Xs:0,km:new Map,kl:t}}function ms(t){if(void 0!==t&&0!==t.length)return{Cm:t[0].ct.d_,Tm:t[t.length-1].ct.d_}}function bs(t){let i;return t.forEach((t=>{void 0===i&&(i=t.x_)})),r(i)}function gs(t){void 0===t.x_&&(t.x_=t.time)}class ws{constructor(){this.Pm=new Map,this.Rm=new Map,this.Dm=new Map,this.Om=[]}M(){this.Pm.clear(),this.Rm.clear(),this.Dm.clear(),this.Om=[]}Bm(t,i){let n=0!==this.Pm.size,s=!1;const e=this.Rm.get(t);if(void 0!==e)if(1===this.Rm.size)n=!1,s=!0,this.Pm.clear();else for(const i of this.Om)i.pointData.km.delete(t)&&(s=!0);let r=[];if(0!==i.length){const n=i;n.forEach((t=>gs(t))),function(t){t.forEach(ps)}(i);const e=h(cs(i)),l=ss(t.Lh());r=n.map((i=>{const n=e(i.time);let r=this.Pm.get(n.d_);void 0===r&&(r=vs(n),this.Pm.set(n.d_,r),s=!0);const h=l(n,r.Xs,i,i.x_);return r.km.set(t,h),h}))}n&&this.Em(),this.Am(t,r);let l=-1;if(s){const t=[];this.Pm.forEach((i=>{t.push({M_:0,ct:i.kl,pointData:i,x_:bs(i.km)})})),t.sort(((t,i)=>t.ct.d_-i.ct.d_)),l=this.Lm(t)}return this.zm(t,l,function(t,i){const n=ms(t),s=ms(i);if(void 0!==n&&void 0!==s)return{bl:n.Tm>=s.Tm&&n.Cm>=s.Cm}}(this.Rm.get(t),e))}Lc(t){return this.Bm(t,[])}Im(t,i){const n=i;gs(n),ps(i);const s=h(cs([i]))(i.time),e=this.Dm.get(t);if(void 0!==e&&s.d_<e.d_)throw new Error(`Cannot update oldest data, last time=${e.d_}, new time=${s.d_}`);let r=this.Pm.get(s.d_);const l=void 0===r;void 0===r&&(r=vs(s),this.Pm.set(s.d_,r));const a=ss(t.Lh())(s,r.Xs,i,n.x_);r.km.set(t,a),this.Nm(t,a);const o={bl:ts(a)};if(!l)return this.zm(t,-1,o);const _={M_:0,ct:r.kl,pointData:r,x_:bs(r.km)},u=mt(this.Om,_.ct.d_,((t,i)=>t.ct.d_<i));this.Om.splice(u,0,_);for(let t=u;t<this.Om.length;++t)Ms(this.Om[t].pointData,t);return os(this.Om,u),this.zm(t,u,o)}Nm(t,i){let n=this.Rm.get(t);void 0===n&&(n=[],this.Rm.set(t,n));const s=0!==n.length?n[n.length-1]:null;null===s||i.ct.d_>s.ct.d_?ts(i)&&n.push(i):ts(i)?n[n.length-1]=i:n.splice(-1,1),this.Dm.set(t,i.ct)}Am(t,i){0!==i.length?(this.Rm.set(t,i.filter(ts)),this.Dm.set(t,i[i.length-1].ct)):(this.Rm.delete(t),this.Dm.delete(t))}Em(){for(const t of this.Om)0===t.pointData.km.size&&this.Pm.delete(t.ct.d_)}Lm(t){let i=-1;for(let n=0;n<this.Om.length&&n<t.length;++n){const s=this.Om[n],e=t[n];if(s.ct.d_!==e.ct.d_){i=n;break}e.M_=s.M_,Ms(e.pointData,n)}if(-1===i&&this.Om.length!==t.length&&(i=Math.min(this.Om.length,t.length)),-1===i)return-1;for(let n=i;n<t.length;++n)Ms(t[n].pointData,n);return os(t,i),this.Om=t,i}Vm(){if(0===this.Rm.size)return null;let t=0;return this.Rm.forEach((i=>{0!==i.length&&(t=Math.max(t,i[i.length-1].Xs))})),t}zm(t,i,n){const s={Fm:new Map,Ct:{hu:this.Vm()}};if(-1!==i)this.Rm.forEach(((i,e)=>{s.Fm.set(e,{_r:i,Wm:e===t?n:void 0})})),this.Rm.has(t)||s.Fm.set(t,{_r:[],Wm:n}),s.Ct.jm=this.Om,s.Ct.$m=i;else{const i=this.Rm.get(t);s.Fm.set(t,{_r:i||[],Wm:n})}return s}}function Ms(t,i){t.Xs=i,t.km.forEach((t=>{t.Xs=i}))}function Ss(t){return{value:t.At[3],time:t.x_}}function xs(t){const i=Ss(t);return void 0!==t.D&&(i.color=t.D),i}function ys(t){return{open:t.At[0],high:t.At[1],low:t.At[2],close:t.At[3],time:t.x_}}const ks={Area:function(t){const i=Ss(t);return void 0!==t.ut&&(i.lineColor=t.ut),void 0!==t.gs&&(i.topColor=t.gs),void 0!==t.ws&&(i.bottomColor=t.ws),i},Line:xs,Baseline:function(t){const i=Ss(t);return void 0!==t.ge&&(i.topLineColor=t.ge),void 0!==t.we&&(i.bottomLineColor=t.we),void 0!==t.fe&&(i.topFillColor1=t.fe),void 0!==t.pe&&(i.topFillColor2=t.pe),void 0!==t.ve&&(i.bottomFillColor1=t.ve),void 0!==t.me&&(i.bottomFillColor2=t.me),i},Histogram:xs,Bar:function(t){const i=ys(t);return void 0!==t.D&&(i.color=t.D),i},Candlestick:function(t){const i=ys(t),{D:n,Lt:s,Oh:e}=t;return void 0!==n&&(i.color=n),void 0!==s&&(i.borderColor=s),void 0!==e&&(i.wickColor=e),i}};function Cs(t){return ks[t]}const Ts={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2},width:0},Ps={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:C,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"},Rs={width:0,height:0,autoSize:!1,layout:{background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:C},crosshair:{vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},grid:{vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},overlayPriceScales:Object.assign({},Ts),leftPriceScale:Object.assign(Object.assign({},Ts),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},Ts),{visible:!0}),timeScale:{rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,ticksVisible:!1},watermark:Ps,localization:{locale:yn?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}},Ds={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},Os={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},Bs={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Es={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",invertFilledArea:!1,lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},As={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0},Ls={color:"#26a69a",base:0},zs={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}};class Is{constructor(t,i){this.Hm=t,this.Um=i}applyOptions(t){this.Hm.Yt().uc(this.Um,t)}options(){return this.Vi().W()}width(){return Q(this.Um)?this.Hm.rm(this.Um):0}Vi(){return h(this.Hm.Yt().cc(this.Um)).Et}}const Ns={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:"",axisLabelColor:"",axisLabelTextColor:""};class Vs{constructor(t){this.Mh=t}applyOptions(t){this.Mh.Ch(t)}options(){return this.Mh.W()}qm(){return this.Mh}}class Fs{constructor(t,i,n){this.Ps=t,this.Ym=i,this.Xm=n}priceFormatter(){return this.Ps.Bl()}priceToCoordinate(t){const i=this.Ps.Rt();return null===i?null:this.Ps.Et().Bt(t,i.At)}coordinateToPrice(t){const i=this.Ps.Rt();return null===i?null:this.Ps.Et().vn(t,i.At)}barsInLogicalRange(t){if(null===t)return null;const i=new en(new tn(t.from,t.to)).P_(),n=this.Ps.Ln();if(n.Wi())return null;const s=n.$h(i.Ss(),1),e=n.$h(i.fi(),-1),r=h(n.Fh()),l=h(n.An());if(null!==s&&null!==e&&s.Xs>e.Xs)return{barsBefore:t.from-r,barsAfter:l-t.to};const a={barsBefore:null===s||s.Xs===r?t.from-r:s.Xs-r,barsAfter:null===e||e.Xs===l?l-t.to:l-e.Xs};return null!==s&&null!==e&&(a.from=s.ct.c_||s.ct.d_,a.to=e.ct.c_||e.ct.d_),a}setData(t){this.Ps.Lh(),this.Ym.Zm(this.Ps,t)}update(t){this.Ps.Lh(),this.Ym.Km(this.Ps,t)}dataByIndex(t,i){const n=this.Ps.Ln().$h(t,i);return null===n?null:Cs(this.seriesType())(n)}setMarkers(t){const i=t.map((t=>Object.assign(Object.assign({},t),{originalTime:t.time,time:ds(t.time)})));this.Ps.wl(i)}markers(){return this.Ps.Ml().map((t=>{const{originalTime:i,time:n}=t,s=function(t,i){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&i.indexOf(s)<0&&(n[s]=t[s]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(s=Object.getOwnPropertySymbols(t);e<s.length;e++)i.indexOf(s[e])<0&&Object.prototype.propertyIsEnumerable.call(t,s[e])&&(n[s[e]]=t[s[e]])}return n}(t,["originalTime","time"]);return Object.assign({time:i},s)}))}applyOptions(t){this.Ps.Ch(t)}options(){return x(this.Ps.W())}priceScale(){return this.Xm.priceScale(this.Ps.Et().Nl())}createPriceLine(t){const i=b(x(Ns),t),n=this.Ps.Sl(i);return new Vs(n)}removePriceLine(t){this.Ps.xl(t.qm())}seriesType(){return this.Ps.Lh()}}class Ws{constructor(t,i){this.Gm=new m,this.N_=new m,this.vv=new m,this.Ui=t,this.So=t.Ct(),this.qv=i,this.So.yu().l(this.Jm.bind(this)),this.So.ku().l(this.Qm.bind(this)),this.qv.yv().l(this.tb.bind(this))}M(){this.So.yu().v(this),this.So.ku().v(this),this.qv.yv().v(this),this.Gm.M(),this.N_.M(),this.vv.M()}scrollPosition(){return this.So.uu()}scrollToPosition(t,i){i?this.So.Mu(t,1e3):this.Ui.Jn(t)}scrollToRealTime(){this.So.wu()}getVisibleRange(){var t,i;const n=this.So.Q_();return null===n?null:{from:null!==(t=n.from.c_)&&void 0!==t?t:n.from.d_,to:null!==(i=n.to.c_)&&void 0!==i?i:n.to.d_}}setVisibleRange(t){const i={from:ds(t.from),to:ds(t.to)},n=this.So.su(i);this.Ui.zc(n)}getVisibleLogicalRange(){const t=this.So.J_();return null===t?null:{from:t.Ss(),to:t.fi()}}setVisibleLogicalRange(t){e(t.from<=t.to,"The from index cannot be after the to index."),this.Ui.zc(t)}resetTimeScale(){this.Ui.Kn()}fitContent(){this.Ui.Pu()}logicalToCoordinate(t){const i=this.Ui.Ct();return i.Wi()?null:i.Nt(t)}coordinateToLogical(t){return this.So.Wi()?null:this.So.lu(t)}timeToCoordinate(t){const i=ds(t),n=this.So.Wl(i,!1);return null===n?null:this.So.Nt(n)}coordinateToTime(t){var i;const n=this.Ui.Ct(),s=n.lu(t),e=n.mn(s);return null===e?null:null!==(i=e.c_)&&void 0!==i?i:e.d_}width(){return this.qv.Zp().width}height(){return this.qv.Zp().height}subscribeVisibleTimeRangeChange(t){this.Gm.l(t)}unsubscribeVisibleTimeRangeChange(t){this.Gm.p(t)}subscribeVisibleLogicalRangeChange(t){this.N_.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.N_.p(t)}subscribeSizeChange(t){this.vv.l(t)}unsubscribeSizeChange(t){this.vv.p(t)}applyOptions(t){this.So.Ch(t)}options(){return x(this.So.W())}Jm(){this.Gm.g()&&this.Gm.m(this.getVisibleRange())}Qm(){this.N_.g()&&this.N_.m(this.getVisibleLogicalRange())}tb(t){this.vv.m(t.width,t.height)}}function js(t){if(void 0===t||"custom"===t.type)return;const i=t;void 0!==i.minMove&&void 0===i.precision&&(i.precision=function(t){if(t>=1)return 0;let i=0;for(;i<8;i++){const n=Math.round(t);if(Math.abs(n-t)<1e-8)return i;t*=10}return i}(i.minMove))}function $s(t){return function(t){if(S(t.handleScale)){const i=t.handleScale;t.handleScale={axisDoubleClickReset:{time:i,price:i},axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(void 0!==t.handleScale){const{axisPressedMouseMove:i,axisDoubleClickReset:n}=t.handleScale;S(i)&&(t.handleScale.axisPressedMouseMove={time:i,price:i}),S(n)&&(t.handleScale.axisDoubleClickReset={time:n,price:n})}const i=t.handleScroll;S(i)&&(t.handleScroll={horzTouchDrag:i,vertTouchDrag:i,mouseWheel:i,pressedMouseMove:i})}(t),t}class Hs{constructor(t,i){this.ib=new ws,this.nb=new Map,this.sb=new Map,this.eb=new m,this.rb=new m;const n=void 0===i?x(Rs):b(x(Rs),$s(i));this.Hm=new Gn(t,n),this.Hm.Up().l((t=>{this.eb.g()&&this.eb.m(this.hb(t()))}),this),this.Hm.mc().l((t=>{this.rb.g()&&this.rb.m(this.hb(t()))}),this);const s=this.Hm.Yt();this.lb=new Ws(s,this.Hm.Jv())}setCrosshairXY(t,i,n){this.Hm.Gv()[0].sv(t,i,n)}getMouseEventParams(t,i,n){return this.hb(this.Hm.om(t,i,n))}remove(){this.Hm.Up().v(this),this.Hm.mc().v(this),this.lb.M(),this.Hm.M(),this.nb.clear(),this.sb.clear(),this.eb.M(),this.rb.M(),this.ib.M()}resize(t,i,n){this.autoSizeActive()||this.Hm.Xv(t,i,n)}addAreaSeries(t){return this.ab("Area",Es,t)}addBaselineSeries(t){return this.ab("Baseline",As,t)}addBarSeries(t){return this.ab("Bar",Os,t)}addCandlestickSeries(t={}){return function(t){void 0!==t.borderColor&&(t.borderUpColor=t.borderColor,t.borderDownColor=t.borderColor),void 0!==t.wickColor&&(t.wickUpColor=t.wickColor,t.wickDownColor=t.wickColor)}(t),this.ab("Candlestick",Ds,t)}addHistogramSeries(t){return this.ab("Histogram",Ls,t)}addLineSeries(t){return this.ab("Line",Bs,t)}removeSeries(t){const i=r(this.nb.get(t)),n=this.ib.Lc(i);this.Hm.Yt().Lc(i),this.ob(n),this.nb.delete(t),this.sb.delete(i)}Zm(t,i){this.ob(this.ib.Bm(t,i))}Km(t,i){this.ob(this.ib.Im(t,i))}subscribeClick(t){this.eb.l(t)}unsubscribeClick(t){this.eb.p(t)}subscribeCrosshairMove(t){this.rb.l(t)}unsubscribeCrosshairMove(t){this.rb.p(t)}priceScale(t){return new Is(this.Hm,t)}timeScale(){return this.lb}applyOptions(t){this.Hm.Ch($s(t))}options(){return this.Hm.W()}takeScreenshot(){return this.Hm.nm()}autoSizeActive(){return this.Hm.am()}ab(t,i,n={}){js(n.priceFormat);const s=b(x(zs),x(i),n),e=this.Hm.Yt().Ec(t,s),r=new Fs(e,this,this);return this.nb.set(r,e),this.sb.set(e,r),r}ob(t){const i=this.Hm.Yt();i.Oc(t.Ct.hu,t.Ct.jm,t.Ct.$m),t.Fm.forEach(((t,i)=>i.nt(t._r,t.Wm))),i.ou()}_b(t){return r(this.sb.get(t))}hb(t){const i=new Map;t.Mm.forEach(((t,n)=>{const s=Cs(n.Lh())(t);e(function(t){return void 0!==t.open||void 0!==t.value}(s)),i.set(this._b(n),s)}));const n=void 0===t.wm?void 0:this._b(t.wm);return{time:t.ct,logical:t.Xs,point:t.gm,hoveredSeries:n,hoveredObjectId:t.Sm,seriesData:i,sourceEvent:t.xm}}}var Us=Object.freeze({__proto__:null,get ColorType(){return on},get CrosshairMode(){return G},get LastPriceAnimationMode(){return ln},get LineStyle(){return i},get LineType(){return t},get MismatchDirection(){return wi},get PriceLineSource(){return an},get PriceScaleMode(){return ji},get TickMarkType(){return rn},get TrackingModeExitMode(){return hn},createChart:function(t,i){let n;if(M(t)){const i=document.getElementById(t);e(null!==i,`Cannot find element in DOM with id=${t}`),n=i}else n=t;return new Hs(n,i)},isBusinessDay:pn,isUTCTimestamp:vn,version:function(){return"4.1.2-dev+202306082153"}});window.LightweightCharts=Us}();
